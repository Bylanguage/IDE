{function w(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function p(e){return"object"==typeof e&&null!==e&&(e instanceof Array||"[object Array]"==Object.prototype.toString.call(e)&&(null==typeof Symbol||null==Symbol.toStringTag||"Array"!=e[Symbol.toStringTag]))}function k(e){return e&&e[Symbol.iterator]?Array.from(e):[]}function N(e,t){return null!=e&&e[Symbol.iterator]?Array.prototype.map.call(e,t):[]}function _(e,t){var i,n,r=Object.create(null);for([i,n]of Object.entries(e||{}))r[i]=t(n,i);return r}function M(e){return null!=e?Object.entries(e):[]}function S(){return Object.create(null)}function B(e,t){return null==e?null==t?Object.create(null):t:null==t?e:Object.assign(e,t)}function j(e,t,i){Object.defineProperty(e,t,i)}function F(e,t,i){if("string"==typeof t||"symbol"==typeof t)Object.defineProperty(e,t,{value:i});else{for(var[n,r]of M(t))Object.defineProperty(e,n,{value:r});for(var s of Object.getOwnPropertySymbols(t))Object.defineProperty(e,s,{value:t[s]})}}function z(e){if(null==e)return[];var t,i,n=[];for(t of Object.getOwnPropertySymbols(e))n.push([t,Object.getOwnPropertyDescriptor(e,t)]);for(i of Object.getOwnPropertyNames(e))n.push([i,Object.getOwnPropertyDescriptor(e,i)]);return n}function K(e,t){return t<e?1:e==t?0:-1}const T=(()=>{const r={},s={};const i={_format(t,...i){if(null==t)return"";for(let e=0;e<i.length;e++){var n=i[e]||"",r=`{${e}}`;t=t.replaceAll(r,n)}return t}};function e(n,e,t){r[n]=e,s[n]=t,j(i,n,{get(){{var t=n,i=void 0;null==i&&(i=ze.language);let e;return e=null==(e="en"!=i&&"en-us"!=i&&"en-US"!=i?e:s[t])?r[t]:e}}})}return e("Browser_Version_Too_Low","当前浏览器版本过低, 推荐使用Chrome或Edge浏览器最新版","IE browser is not supported, please switch to using another browser!"),e("Enum_Parse_Invalid","Enum.parse: 指定的参数不能转换为当前枚举","Enum.parse: the specified argument cannot be converted to this enum type."),e("External_Not_Defined_Template","external 方法未正确定义: {0}","The specified external method is not defined: {0}"),e("Project_SettingsJson_NotFound","setting.json 加载失败，无法访问远程服务器","Cannot connect to remote server because 'settings.json' failed to load."),e("Stack_Empty","栈为空","The stack is empty."),e("Queue_Empty","队列为空","The queue is empty."),e("AutoID_Table_Cannot_Null","表参数不能为Null!","The argument 'table' cannot be null."),e("QueryData_Missing_Table","没有配置数据源, 获取数据失败","Getting QueryData failed, the target control missing a related table."),e("Control_Missing_Table","没有关联的数据表, 获取数据失败","Getting Row Data failed, the target control missing a related table."),e("Sql_From_Not_Valid","表源项不是正确的表身份或表对象","The 'from' part of a SQL expression must be a table-identity or table."),e("Dress_Member_Missing_Template","dress-html载入异常，成员{0}缺失","Missing member {0} while loading dress"),e("Dialog_Type_Not_Found_Template","{0}不存在指定dialog-type: {1}","The dialog type {1} cannot be found under new-identity {0}."),e("Row_Must_Bind_Table_Identity","行只能绑定表身份","Row instance must only bind a table-identity instance."),e("Row_Component_Not_Found_Template","指定的构成要件缺失, 构成要件名: {0}. (当前行:{1})","Cannot access component, the component name {0} is missed in this row: {2}."),e("Row_Cannot_ComponentAccess_Missing_Identity","当前行缺少身份, 不能进行构件访问","Cannot access component of this row because it does not have a binding identity."),e("Server_Returned_Row_Missing_Identity","服务器传回的行缺少$IDENTITY信息","The row returned from server missing ['$IDENTITY'] value (This might be a ByLanguage internal error, please contact us)."),e("Server_Returned_Orm_Identity_Not_Table","服务器传回的传回的orm表项不是表身份","The table-mappings of the orm instance returned from server must be table (This might be a ByLanguage internal error, please contact us)."),e("Server_Cannot_Send_Annoymous_Orm","禁止传递匿名orm","Cannot send a annoymous orm instance to the server."),e("Server_Cannot_Send_Null_Field","禁止传递null作为字段","Cannot send 'null' as a field to server."),e("Server_Returned_Field_Invalid_Template","指定的Field无法识别: {0}","The given transmit field {0} cannot be parsed (This might be a ByLanguage internal error, please contact us)."),e("Server_Exec_Error_Template","服务器执行出错：类型： {0}, 详细信息：{1}","An error happened in the server operation {0}, details: {1}."),e("Server_Format_Error_Template","服务器格式出错：类型： {0}, 详细信息：{1}","Server json package format invalid, kind: {0}, details: {1}."),e("Net_Connection_Error_Template","网络连接异常, url: {0}, 详细信息: {1}","Connecting target URL {0} Failed, details: {1}"),e("Verify_Field_Result_Template","违反了字段{0}的{1}约束：{2}","Verification failed, the {1} constraint of field {0} is violated, detail: {2}"),e("Verify_Message_Required","此项为必须项","This item is required."),e("Verify_Message_NotNull_Template","{0}值不能为空","type {0} cannot be null."),e("Verify_Message_MinLength_Template","{0}长度小于{1}","The length of type {0} must be larger than {1}."),e("Verify_Message_MaxLength_Template","{0}长度大于{1}","The length of type {0} must be smaller than {1}l."),e("Verify_Message_Pattern_Template","{0}格式必须符合正则{1}, 实际值：{2}","The value of type {0} must match the reg-exp {1}, but actually {2}."),e("Verify_Message_Min_Template","{0}值小于{1}","Value of type {0} must be larger than {1}."),e("Verify_Message_Max_Template","{0}值大于{1}","Value of type {0} must be smaller than {1}."),e("Verify_Message_Digits_Template","{0}小数位数必须不大于{1}, 实际值：{2}","Value of type {0} must not have digits more than {1}, but the actual value is {2}."),e("Argument_Cannot_Be_Null","the argument cannot be null","arg is null."),e("Cast_Failed_Template","{0}强制类型转换失败","Explict Conversion to type {0} failed."),e("Grid_Cannot_Modify_Restricted_GridRows","禁止修改已添加到网格中的网格行","Cannot modify cells in this grid row, it is already in a grid."),e("Index_Out_Of_Range_Template","索引访问越界，访问的索引{0}超出有效范围","The target index {0} is out of range."),e("Key_Not_Found_Template","给定的键不在字典里: {0}","The given key {0} is not in the dictionary."),e("Ku_NewIdentity_Not_Found_Template","指定的新身份实例{0}没有正确定义","The specified new identity {0} is not defined."),e("Ku_Not_Found_Template","指定的库{0}没有正确定义","The specified ku {0} is not defined."),e("Ku_Table_Not_Found_Template","指定的表{0}没有正确定义","The specified table {0} is not defined."),e("Ku_TableField_Not_Found_Template","指定的字段{0}没有正确定义","The specified field {0} is not defined."),e("Ku_Type_Not_Found_Template","指定的类型{0}没有正确定义","The specified type {0} is not defined."),e("Method_Call_Exception_Template","方法执行出错：{0}, 详细原因: {1}","Method {0} execution failed, reason: {1}."),e("Null_Reference_Error","成员访问或索引访问，被访问的对象不能为Null!","Null reference error, the left hand side of access expression cannot be null."),e("Numeric_Overflow_Error","数字类型计算溢出","Numeric operation overflowed."),e("Stack_Overflow_Error","堆栈溢出, 请检查是否死循环","Stack overflow."),i})(),h={isPrimitiveItem(e){return null!=e&&("object"!=typeof e||e instanceof r||e instanceof l||e instanceof c||e instanceof Se)},isPrimitiveWrapItem(e){return e instanceof r||e instanceof l||e instanceof c||e instanceof Se},primitiveCast(e,t){return R.isPrimitiveType(e)||R.isEnumType(e)?e(t):t},primitiveEquals(e,t){return e==t||null!=e&&null!=t&&"function"==typeof e.valueOf&&"function"==typeof t.valueOf&&e.valueOf()==t.valueOf()},primitiveContains(e,i){if(h.isPrimitiveWrapItem(i)){let t=i.valueOf();return Array.prototype.some.call(e,e=>null!=e&&e.valueOf()==t)}return Array.prototype.includes.call(e,i)},primitiveIndexOf(e,i){if(h.isPrimitiveWrapItem(i)){let t=i.valueOf();return Array.prototype.findIndex.call(e,e=>null!=e&&e.valueOf()==t)}return Array.prototype.indexOf.call(e,i)},primitiveLastIndexOf(t,e){if(h.isPrimitiveWrapItem(e)){var i=e.valueOf();for(let e=t.length-1;0<=e;e--){var n=t[e];if(null!=n&&n.valueOf()==i)return e}return-1}return Array.prototype.lastIndexOf.call(t,e)},primitiveCompare(e,t,i){if(t==i)return 0;if(null==t)return-1;if(null==i)return 1;switch(e){case r:return K("number"==typeof t?t:"string"==typeof t?t.charCodeAt(0):t.valueOf(),"number"==typeof i?i:"string"==typeof i?i.charCodeAt(0):i.valueOf());case c:return c.compare(c(t),c(i));case l:return l.compare(l(t),l(i));case Se:return K("number"==typeof t?t:"string"==typeof t?Date.parse(t):t.valueOf(),"number"==typeof i?i:"string"==typeof i?Date.parse(i):i.valueOf());default:return K(t,i)}}},ye="by",ve={name:ye,object:S(),identity:S(),enum:S()},P={enum:"enum",object:"object",identity:"identity",dialog:"dialog",orm:"orm",manager:"manager"},be={native:"native",primitive:"primitive",class:"class",struct:"struct",interface:"interface"},R=(()=>{const a=new Map,o={getType(e){if(null==e)return f;if("function"==typeof e)return e;if(p(e))return o.getType(e[0]);e="string"==typeof e?e:e.toString();if(a.has(e))return a.get(e);if(e.includes(".")){var[t,i,n]=e.split("."),r=L.$getKu(t);if(null==r)throw new De(t);t=r[i][n];if(null!=t)return a.set(e,t),t}throw new Ae(e)},getTypeID(e){return"string"==typeof e?e:null==e?null:e["#by#id"]},getTypeKu(e){return null==e?null:e["#by#ku"]},getTypeName(e){return null==e?null:e["#by#name"]},getTypeDefault(e){return null==e?null:"string"==typeof e?o.getType(e)["#by#default"]:"function"==typeof e?e["#by#default"]:p(e)?o.getTypeDefault(e[0]):null},getTypeFromHint(e){return p(e)?[o.getType(e[0]),e[1]]:[o.getType(e)]},isEnumType(e){return null!=e&&e["#by#domain"]==P.enum},isPrimitiveType(e){return null!=e&&e["#by#kind"]==be.primitive},isAnnoymousType(e){return null!=e&&e["#by#annoymousTag"]},declareType(t,i){if(null!=i){if(i.id&&(a.set(i.id,t),F(t,"#by#id",i.id)),!i.alias||a.has(i.alias)||a.set(i.alias,t),F(t,{"#by#name":i.name,"#by#kind":i.kind,"#by#domain":i.domain}),i.ku!=ye&&null!=i.ku||null==i.domain||(ve[i.domain][i.name]=t),j(t,"#by#ku",{get(){var e=L.$getKu(i.ku||ye);return F(t,"#by#ku",e),e},configurable:!0}),null!=i.default&&F(t,"#by#default",i.default),null!=i.extend&&g.extend(t,i.extend),i.static)for(var[e,n]of z(i.static))w(n,"get")||w(n,"set")?j(t,e,n):F(t,e,n.value);if(i.instance)for(var[r,s]of z(i.instance))w(s,"get")||w(s,"set")?j(t.prototype,r,s):F(t.prototype,r,s.value);var l;null!=i.transmit&&(((l=i.transmit).toJSON||l.fromJSON)&&we.defineJSONOperators(t,l),l.toExternal||l.fromExternal)&&xe.defineExternalOperators(t,l)}return t},declareNativeType(e,t){return null==t&&(t={id:e.name,kind:be.native}),o.declareType(e,t)},declareSystemType(e,t){return(t=null==t?{}:t).kind=t.kind||be.class,t.domain=t.domain||P.object,t.name=t.name||t.id||e.name,t.id=t.id||`by.${t.domain}.`+t.name,null!=t.systemtransmit&&d.registerTypeTransmitInfo(e,t.systemtransmit),o.declareType(e,t)},declareSystemPrimitiveType(t,i){if((i=null==i?{}:i).kind=be.primitive,i.primitive=!0,null==i.transmit&&(i.transmit={toJSON(e){return null==e?t==$||t==Se?null:t():"number"==typeof(e=e instanceof t?e:t(e))||"boolean"==typeof e?e:e.toString()},fromJSON(e){return t(e)},toExternal(e){return null==e?t():e.valueOf()},fromExternal(e){return t(e)}}),null!=i.numeric){let e=i.numeric;for(var[n,r]of M(e="default"==e?{"+":(e,t)=>e+t|0,"-":(e,t)=>e-t|0,"*":(e,t)=>e*t|0,"/":(e,t)=>e/t|0,"%":(e,t)=>e%t|0,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,">=":(e,t)=>t<=e,">":(e,t)=>t<e,"<=":(e,t)=>e<=t,"<":(e,t)=>e<t,"u!":e=>!e,"u~":e=>~e,"u+":e=>+e,"u-":e=>-e}:e))F(t,n,r)}return null==i.default&&(i.default=t()),o.declareSystemType(t,i)},declareSystemCollectionType(l,e){let t=e.collection;if(null!=(t="default"==t?{transmit:"ARRAY",checker:(e,t)=>0<=t&&t<e.length,getter:(e,t)=>e[t],setter:(e,t,i)=>e[t]=i}:t)){let{transmit:n,getter:r,setter:s,checker:i}=t;function a(e,t){if("function"==typeof i&&!i(e,t))throw new Ce(t,e)}null!=r&&F(l.prototype,"$get",function(e){return a(this,e),r(this,e)}),null!=s&&F(l.prototype,"$set",function(e,t,i){return a(this,e),"function"==typeof i&&(t=i(r(this,e),t)),s(this,e,t)}),null!=n&&("string"==typeof n?e.transmit={toJSON(e,t,i){t=t.serializeList(e,i);return{"#":n,$VALUES:t}},fromJSON(e,t,i){e=e.$VALUES;return null==e?null:(t=t.rebuildList(e,i),l==q?t:new l(t))},toExternal(e,t,i){return null==e?null:t.serializeList(e,i)},fromExternal(e,t,i){return null==e?null:(t=t.rebuildList(e,i),l==q?t:new l(t))}}:e.transmit=n)}return o.declareSystemType(l,e)},declareSystemVisualType(e,t){return null==t.visual&&(t.visual={}),null==t.visual.name&&(t.visual.name=t.name),null!=t&&null!=t.visual&&t.visual.inner&&(t.ku="$inner"),o.declareSystemType(e,t),C.registerUISettings(e,t.visual),e},declareBytEnumType(e,t,i){let n=[],r=new Map;function s(e){return"number"==typeof e?r.has(e)?r.get(e):n[0]:"string"==typeof e?n.includes(e)?e:n[0]:null!=e&&!1!==e&&""!==e&&(e=e.toString(),n.includes(e))?e:n[0]}for(var[l,a]of M(i))n.push(l),r.set(a,l),F(s,l,l);return F(s,Symbol.hasInstance,e=>n.includes(e)),o.declareType(s,{id:`${e.name}.${P.enum}.`+t,kind:be.struct,ku:e,domain:P.enum,name:t,base:W,default:n[0],static:{$values(){return Array.from(n)},$parse(e){if(n.includes(e))return e;throw new y(T.Enum_Parse_Invalid)},$valueOf(e){return n.includes(e)?e:n[0]}},transmit:{toJSON(e){return n.includes(e)?e:n[0]},fromJSON(e){return n.includes(e)?e:n[0]},toExternal(e){return n.includes(e)?e:n[0]},fromExternal(e){return n.includes(e)?e:n[0]}}}),s},declareBytOrmType(e,t,i){class n extends Te{constructor(e,t,i,n,r){super(e,t,i,n,r)}}return Te.$$fillOrmTypeMembers(n,i.tables,i.fields),o.declareType(n,{id:e.name+".orm."+t,ku:e,domain:P.orm,name:t}),n},declareAnnoymousOrmType(e){return"function"==typeof e?e:"string"==typeof e?o.getType(e):(F(e=o.declareBytOrmType("$annoymous","$annoymous",e),"#by#annoymousTag",!0),e)},declareBytExtendableType(r,e){var t=e.domain||P.object,i=e.kind==be.interface;if(e.kind=e.kind||be.class,i||t!=P.dialog&&t!=P.manager||(null!=(a=e.dialog)&&null!=a.props&&(m.$$registerDialogBindMembers(r,a.props),m.$$registerMemberHostInfo(r,a.managerHost)),a=e.id||(e.id=`${e.ku?e.ku.name:ye}.${t}.`+e.name),C.registerDialog(r,a),F(r,"$new",function(i,n){null==n&&"function"==typeof i&&(n=i,i=null),null==n&&(n=e=>e.$0());var e=C.createDialogDressVisual(r,m.$$retrieveDialogBindMembers(r),m.$$registerMemberHostInfo(r));return Promise.resolve(e).then(e=>{null!=i&&e.$bindIdentity(i);var t=n(e);return t instanceof Promise?t.then(()=>e):e})})),i?F(r,Symbol.hasInstance,function(e){return null!=e&&g.checkImplements(e,r)}):null!=e.base&&g.setBaseInfo(r,e.base),null!=e.transmit){t=e.transmit;if(p(t)){var n,s={},l=null!=e.instance&&e.instance.props||{};for(n of t)s[n]=l[n];d.registerTypeTransmitInfo(r,s),e.transmit=void 0}}if(null!=e.external){var a=e.external;let i=E.ProjectFilesUtil.accessExternalType(a);F(r,"#external",i),xe.registerExternalMap(r,i),c.defineExternalMembers(r,e),F(r,"$new",function(...e){var t=new r,e=xe.serializeArguments(e);return F(t,"#external",new i(...e)),t}),F(r.prototype,{toString(){return this["#external"].toString()},by$toString(){return this["#external"].toString==Object.prototype.toString?f.by$toString(this):this["#external"].toString()},valueOf(){return this["#external"].valueOf()},by$equals(e){return null!=e&&(this==e||this.valueOf()===e.valueOf())}})}else c.defineBytGeneralMembers(r,e);e.static=e.instance=void 0,o.declareType(r,e)}},c={defineBytEvent(e,t){j(e,t,{get(){var e=I.$create(t);return F(this,t,e),e}})},defineBytProperty(e,t,i){j(e,t,{enumerable:!0,configurable:!0,get(){var e=o.getTypeDefault(i);return j(this,t,{value:e,writable:!0,enumerable:!0,configurable:!0}),e},set(e){return j(this,t,{value:e,writable:!0,enumerable:!0,configurable:!0}),e}})},defineBytGeneralMembers(e,t){if(t.static){var{props:i,events:n}=t.static;if(i)for(var[r,s]of M(i))c.defineBytProperty(e,r,s);if(n)for(var l of n)c.defineBytEvent(e,l)}if("interface"!=e["#by#kind"]&&t.instance){var{props:i,events:n}=t.instance;if(i)for(var[a,o]of M(i))c.defineBytProperty(e.prototype,a,o);if(n)for(var u of n)c.defineBytEvent(e.prototype,u)}},defineExternalProp(e,t,i){let n=t.split("$")[0];j(e,t,{get(){return xe.rebuild(this["#external"][n],i)},set(e){this["#external"][n]=xe.serialize(e,i)}})},defineExternalMethod(e,t,i){let n=t.split("$")[0];F(e,t,function(...e){e=xe.serializeArguments(e);if("function"!=typeof this["#external"][n])throw new y(T._format(T.External_Not_Defined_Template,n));e=this["#external"][n].apply(this["#external"],e);if(null!=i&&i!=ie)return e instanceof Promise?e.then(e=>xe.rebuild(e,i)):xe.rebuild(e,i)})},defineExternalMembers(e,t){if(t.static){var i,n,r,s,{props:l,methods:a}=t.static;for([i,n]of M(l))c.defineExternalProp(e,i,n);for([r,s]of M(a))c.defineExternalMethod(e,r,s)}if(t.instance){var o,u,h,d,{props:l,methods:a}=t.instance;for([o,u]of M(l))c.defineExternalProp(e.prototype,o,u);for([h,d]of M(a))c.defineExternalMethod(e.prototype,h,d)}}},u=new WeakMap,h=new WeakMap,d={registerTypeTransmitInfo(a,e){h.set(a.prototype,e);let l=a["#by#name"].split("$")[0];we.defineJSONOperators(a,{toJSON(e,t){var i,n,r={"#":"USERDEFINED",$TYPE:a["#by#ku"].name+"."+l},s=O.$getBindIdentity(e),s=(r.$IDENTITY=t.serialize(s,O),d.retrieveTransmitInfo(a));for([i,n]of M(s))r[i.split("$")[0]]=t.serialize(e[i],n);return r},fromJSON(e,t){var i,n,r=e.$IDENTITY,r=null!=r?t.rebuild(r,O):null,s=new a,r=(t.addItem(e.$ID,s),O.$setBindIdentity(s,r),d.retrieveTransmitInfo(a));for([i,n]of M(r)){var l=i.split("$")[0];s[i]=t.rebuild(e[l],n)}return s}})},retrieveTransmitInfo(e){var e=e.prototype,t=u.get(e);if(null!=t)return t;var i={};let n=e;for(;null!=n;){var r=h.get(n);if(null!=r)for(var[s,l]of M(r))w(i,s)||(i[s]=l);n=Object.getPrototypeOf(n)}return u.set(e,i),i}},r=new Map,s=new WeakMap,i=new Map,m={$$registerDialogBindMembers(e,t){null!=t&&r.set(e.prototype,t)},$$registerMemberHostInfo(e,t){null!=t&&i.set(e.prototype,t)},$$retrieveDialogBindMembers(e){if(s.has(e.prototype))return s.get(e.prototype);var t={};let i=e.prototype;for(;null!=i;){var n=r.get(i);null!=n&&Object.assign(t,n),i=Object.getPrototypeOf(i)}return s.set(e.prototype,t),t},$$retrieveHostInfo(e){return"manager"!=e["#by#domain"]?null:i.get(e.prototype)}},l=new WeakMap,g=o.InheritImplementHelper={extend(e,t){Object.setPrototypeOf(e,t),e.prototype&&t.prototype&&Object.setPrototypeOf(e.prototype,t.prototype)},implement(e,t){let i,n;n=p(t)?(i=o.getType(t[0]),t[1]):(i=o.getType(t),Object.create(null));let r;l.has(i)?r=l.get(i):(r=new Map,l.set(i,r)),r.set(e.prototype,n)},setBaseInfo(e,t){if("function"==typeof t)g.extend(e,t);else if(null!=t){var i=t.inherit,t=t.implements;if(null!=i&&g.extend(e,o.getType(i)),null!=t)for(var n of t)g.implement(e,n)}},getImplementMapping(t,e){var i=l.get(e);if(null!=i){let e=Object.getPrototypeOf(t);for(;null!=e;){if(i.has(e))return i.get(e);e=Object.getPrototypeOf(e)}}return null},getImplementMemberName(e,t){var[t,i]=t,t=o.getType(t),e=g.getImplementMapping(e,t);return null==e||null==e[i]?i:e[i]},checkImplements(e,t){return null!=g.getImplementMapping(e,t)}};return o})(),xe=(R.declareNativeType(Function,{instance:{$check(e,t){var i;return null!=e&&(this["#by#kind"]==be.native?this==String?"string"==typeof e:this==Number?"number"==typeof e:this==Boolean?"boolean"==typeof e:e instanceof this:this==f||(this["#by#domain"]==P.identity?null!=(i=O.$getBindIdentity(e))&&i instanceof this:e instanceof this&&(null==t||O.$getBindIdentity(e)instanceof R.getType(t))))},$convert(e,t,i=!1){if(this["#by#kind"]==be.native)return this==String?String(e):this==Number?Number(e):this==Boolean?Boolean(e):e;if(this==f)return e;let n=!1,r=void 0;var s,l=this["#by#kind"]==be.struct||this["#by#kind"]==be.primitive;if(l?(n=e instanceof this)&&(r=e):r=null==e?(n=!0,null):this["#by#domain"]==P.identity?(s=O.$getBindIdentity(e),n=s instanceof this,s):(s=e instanceof this,t=null==(t=null==t?null:R.getType(t))||O.$getBindIdentity(e)instanceof t,(n=s&&t)?e:null),n)return r;if(i)throw new Ee(this["#by#id"]);return l?this(e):null},$new(e,t){return f.by$init(new this,e,t)}}}),R.declareNativeType(Number,{static:{by$toNumber(e){if(null==e)return 0;switch(typeof e){case"number":return e;case"string":return Number.parseFloat(e);default:return Number(e)}},by$toInt32(e){return null==e?0:"object"!=typeof e?0|Number.by$toNumber(e):e instanceof r?0|e.valueOf():e instanceof l?l.$toInt32(e):e instanceof c?c.$toInt32(e):0},by$toUtf16(e){return"\\u"+("0000"+(e&=65535).toString(16)).slice(-4)}},instance:{by$toString(){return this.toString()},by$equals(e){return"number"==typeof e?e==this.valueOf():!!h.isPrimitiveWrapItem(e)&&Number(e.valueOf())==this.valueOf()}}}),(()=>{let n=new WeakMap;class i{serialize(e,t){if(null!=t){var[i,n]=R.getTypeFromHint(t);if(null!=i&&"function"==typeof i.$toExternal)return i.$toExternal(e,this,n)}return null==e?null:"object"!=typeof e?e:p(e)?this.serializeList(e,t):e.$toExternal?e.$toExternal(this):e}serializeList(e,t){var i,n=[];for(i of e)n.push(this.serialize(i,t));return n}serializeArguments(e){if(null==e)return[];var t,i=[];for(t of e)i.push(this.serialize(t));return i}}class r{rebuild(e,t){var i;return null==e?null:(i=Object.getPrototypeOf(e),n.has(i.constructor)?n.get(i.constructor).$fromExternal(e,this):null!=t?([i,t]=R.getTypeFromHint(t),"function"!=typeof i||"function"!=typeof i.$fromExternal?e:i.$fromExternal(e,this,t)):p(e)?this.rebuildList(e):e instanceof Map?this.rebuild(e,Ue):e)}rebuildList(e,t){if(null==e)return null;var i,n=[];for(i of e)n.push(this.rebuild(i,t));return n}}return{serialize(e,t){return(new i).serialize(e,t)},serializeList(e,t){return(new i).serializeList(e,t)},serializeArguments(e){return(new i).serializeArguments(e)},rebuild(e,t){return(new r).rebuild(e,t)},rebuildList(e,t){return(new r).rebuildList(e,t)},defineExternalOperators(t,e){let{toExternal:i,fromExternal:n}=e;i&&(F(t,"$toExternal",i),F(t.prototype,"$toExternal",function(e){return i(this,e,t)})),n&&F(t,"$fromExternal",n)},registerExternalMap(e,t){F(e,"#external",t),n.set(t,e),F(e,"$toExternal",e=>null==e?null:e["#external"]),F(e.prototype,"$toExternal",function(){return this["#external"]})}}})()),we=(()=>{class i{constructor(){F(this,"#map",new Map),this.counter=0}hasItem(e){return this["#map"].has(e)}getRefNumber(e){return this["#map"].get(e)}addItem(e){var t=(this.counter++).toString();return this["#map"].set(e,t),t}serialize(e,t){if(null==e)return null;if(this.hasItem(e))return{$REF:this.getRefNumber(e)};let i,n;if(h.isPrimitiveItem(e)||e instanceof u||(i=this.addItem(e)),null!=t){var[t,r]=R.getTypeFromHint(t);n=t.$toJSON(e,this,r)}else{if("function"!=typeof e.$toJSON)throw new Fe("cannot convert to JSON: "+e);n=e.$toJSON(this)}return null!=i&&(n.$ID=i),n}serializeList(e,t){if(null==e)return[];var i,n=[];for(i of e)n.push(this.serialize(i,t));return n}serializeArguments(e,t){if(null==e)return[];let i=0,n=[];for(var r of e)n.push(this.serialize(r,t[i++]));return n}}class n{constructor(){F(this,"#map",S())}getItem(e){return this["#map"][e]}addItem(e,t){this["#map"][e]=t}hasItem(e){return null!=this["#map"][e]}rebuild(e,t){if(null==e)return null;var i="object"==typeof e?e.$REF:void 0;if(null!=i)return this.getItem(i);let n;if(null!=t){var[i,t]=R.getTypeFromHint(t);n=i.$fromJSON(e,this,t)}else{if("object"==typeof e)throw new Fe("cannot convert from JSON: "+e);n=e}return"object"==typeof e&&(i=e.$ID,this.hasItem(i)||this.addItem(i,n)),n}rebuildList(e,t){if(null==e)return null;var i,n=[];for(i of e)n.push(this.rebuild(i,t));return n}}return{createToJSONContext(){return new i},serialize(e,t){return(new i).serialize(e,t)},serializeList(e,t){return(new i).serializeList(e,t)},serializeArguments(e,t){return(new i).serializeArguments(e,t)},rebuild(e,t){return(new n).rebuild(e,t)},rebuildList(e,t){return(new n).rebuildList(e,t)},defineJSONOperators(n,e){if(e.toJSON){let i=e.toJSON;F(n,"$toJSON",i),F(n.prototype,"$toJSON",function(e,t){return i(this,e,t||n)})}e.fromJSON&&F(n,"$fromJSON",e.fromJSON)}}})(),E=(()=>{const n=(()=>{const t="_byt_cookie_storage",i="_byt_saasid_storage",n="_byt_session_storage",r="_byt_session_timeout";return{getBytCookie(){var e=d.localStorage.getItem(t);return null==e?null:e},setBytCookie(e){d.localStorage.setItem(t,$(e))},getBytSaaSID(){var e=d.localStorage.getItem(i);return null==e?null:e},setBytSaaSID(e){d.localStorage.setItem(i,$(e))},getBytServerSession(){let e=d.localStorage.getItem(n);var t,i;return null!=e&&""!=e&&(t=Date.now(),null==(i=d.localStorage.getItem(r))||t<Number(i)+1||(d.localStorage.setItem(n,null),d.localStorage.setItem(r,null),e=null),null!=e)&&d.localStorage.setItem(r,t+9e5),null==e?null:e},setBytServerSession(e){d.localStorage.setItem(n,$(e)),d.localStorage.setItem(r,Date.now()+9e5)}}})();let r;var e={setServerUrl(e){r=e},getServerUrl(){return r},sendServerPackage(i){if(null==r)throw new Be(serverUrl,T.Project_SettingsJson_NotFound);return Promise.resolve(r).then(t=>{var e=JSON.stringify({$SAASID:n.getBytSaaSID()||null,$SESSIONID:n.getBytServerSession(),$COOKIE:n.getBytCookie(),$REQUEST:i});return d.fetch(t,{method:"POST",mode:"cors",body:e}).then(e=>{if(e.ok)return e.json().then(e=>{if(null==e)return null;var t=e.$SESSIONID,t=(null!=t&&n.setBytServerSession(t),e.$E),e=e.$V;if(t)throw new Pe(i["#"],e);return e},e=>{throw new Fe(t,e?e.message:"")});throw new Be(t,JSON.stringify(e))},e=>{throw new Be(t,e?e.message:"")})})}};let t,i,s=new Map;const l={setProjectRootPath(e){t=e||"",(i=d.browser.getFullUrl(t)).endsWith("/")||(i+="/")},getProjectRootPath(){return i},getFileFullPathInProject(e){return new URL(e,i).toString()},getDress(e){var[e,t,i]=e.split("."),n=e+`/dress/${t}/${i}/${i}.html`,e=e+`/dress/${t}/${i}/${i}.css`,t=l.getFileFullPathInProject(n),i=l.getFileFullPathInProject(e);return d.loadStyleSheet(i),s.has(t)?s.get(t):(n=d.fetch(t).then(e=>e.text()),s.set(t,n),n)},getKuResource(e,t){return He.$fromUrl(l.getFileFullPathInProject(e+"/resources/"+t))},accessExternalType(t){if("string"!=typeof t)throw new Ae(t);{var i,n=t.split(".");let e=globalThis;for(i of n)e=e[i];if("function"!=typeof e)throw new Ae(t);return e}}},a=new Map,o=new Map,u=new Map,h={defineKu(e,t,i){if(e===ye||o.has(e))throw new m("cannot redefine ku: "+e);var n,i={name:e,builder:i};p(t)?i.ref=t:({ref:t,ext:n}=t,i.ref=t,i.ext=n),o.set(e,i)},getKuDefineInfo(e){var t;return o.has(e)?o.get(e):(a.has(e)?a.get(e):(t=l.getFileFullPathInProject(e+`/${e}.js`),t=d.loadScript(t),a.set(e,t),t)).then(()=>o.get(e))},requireExternalList(e,t){if(null==t)return[];var i,n=[];for(i of t){var r=l.getFileFullPathInProject(e+"/external/"+i);n.push(d.loadScript(r))}return Promise.all(n)},requireKuList(e){return null==e?[]:Promise.all(e.map(e=>h.requireKu(e)))},requireKu(s){var e;return s==ye?L.$getSystemKu():u.has(s)?u.get(s):(e=Promise.resolve(h.getKuDefineInfo(s)).then(e=>{if(null==e)throw new m("ku load error: "+s);let{ref:t,ext:i,builder:n}=e;var e=h.requireKuList(t),r=h.requireExternalList(s,i);return Promise.all([e,r]).then(([e])=>{let t=L.$getKu(s);e=Array.from(e),e.push(t),e=n.apply(null,e),L.$fillKu(t,e),e=L.$initKu(t);return e instanceof Promise?e.then(()=>(u.set(s,t),t)):(u.set(s,t),t)})}),u.set(s,e),e)}};return{CookieStorageUtil:n,ProjectFilesUtil:l,ProjectServerUtil:e,getSystemKu(){return L.$getSystemKu()},requireKu(e){return h.requireKu(e)},defineKu(e,t,i){return h.defineKu(e,t,i)},generateScriptHtml(e,t){var i=l.getFileFullPathInProject("../Byt.js");return`<link rel="stylesheet" type="text/css" href="${l.getFileFullPathInProject("../Byt.css")}"/><script src="${i}"></script><script>Byt.run({path:"${l.getProjectRootPath()}",ku:"${e["#ku"].name}",entry:"${e["#name"]}"});</script>`},run(e){var t=e.path,t=(l.setProjectRootPath(t),l.getFileFullPathInProject("settings.json")),t=(r=d.fetch(t).then(e=>e.json()).then(e=>r=e.serverUrl),e.ku);let i=e.entry;e=h.requireKu(t);Promise.resolve(e).then(e=>{let t=L.$getKuNewIdentity(i,e);if(!(t instanceof Ii))throw new Error("byt 内部错误, 启动点必须是 by.Identity.Page, 实际为: "+t);d.onDOMReady(()=>{t.$loadWithWindow(globalThis);let e=d.browser.location.search;return e.startsWith("?")&&(e=e.slice(1)),t.main(e)})})}}})(),C=(()=>{const f=new Map,$=new Map,y=new Map,v=new Map;function b(e){return e?e instanceof Array?e:[e]:[]}function x(e){for(;null!=e;){if(v.has(e))return v.get(e);e=Object.getPrototypeOf(e)}return{tags:[],classes:[]}}function h(e){if(null!=e.dataset.byType){var t=e.dataset.byType;if(t){t=f.get(t)||f.get(t.toLowerCase());if(t)return t}}return"input"==e.tagName?y.get(e.type||"text")||mt:$.get(e.tagName)||null}function r(e){var{tags:e,classes:t,uiType:i}=x(e),e=e[0]||"div",n=document.createElement(e);if(t)for(var r of t)n.classList.add(r);return i&&(n.dataset.byType=i),n}function d(e,t){var e=x(e),i=e.classes;if(i)for(var n of i)t.classList.add(n);i=e.uiType;return i&&!t.dataset.byType&&(t.dataset.byType=i),t}function w(t,i){var e,n=x(i).childrenInfo,r=[];for(e of t.children)r.push(function(e,t){if(e["#visualTag"])return e["#visualTag"];let i=h(e);return(i=null==i?t||g:i).$fromEl?i.$fromEl(e):w(e,i)}(e,n));{var s=t;t=r;let e=h(s);d(e=null!=e&&e!=g?e:i||g,s);var l,a,o,u=new e(s);u.$fillChildren&&u.$fillChildren(t||[]);for([l,a]of M((i=x(e)).attrs))s.hasAttribute(l)&&(o=s.getAttribute(l),u[a]=o||!0);return u}}return{getElement(e){return e instanceof HTMLElement?e:e instanceof D||e instanceof g?e["#element"]:null},hasVisual(e){return null!=e&&null!=e["#visualTag"]},getVisual(e){return e instanceof g?e:e instanceof D?C.getVisual(e["#element"]):e instanceof HTMLElement?e["#visualTag"]||w(e,h(e)):void 0},registerUISettings(t,e={}){var i,n={},r=x(Object.getPrototypeOf(t)),s=e.name||R.getTypeName(t),l=(f.set(s,t),n.byType=n.uiType=s,[]),a=b(e.tags);if(0<a.length)for(var o of a)$.has(o)||$.set(o,t),l.push(o);for(i of r.tags)l.includes(i)||l.push(i);n.tags=l;var u,h,d=[],a=b(e.classes);0==a.length&&a.push("by-"+s.toLowerCase());for(u of a)d.push(u);for(h of r.classes||[])d.push(h);if(n.classes=Array.from(new Set(d)),null!=e.inputTypes)for(var c of b(e.inputTypes))y.set(c,t);var m,g,p=B(S(),r.attrs);for([m,g]of M(e.attrs))null==g?delete p[m]:p[m]=g;n.attrs=p,n.childInfo=e.childInfo||r.childInfo,v.set(t,n),F(t,"$fromEl",e=>w(e,t))},registerDialog(t,e){f.set(e,t),F(t,"$fromEl",e=>w(e,t))},createVisualElement(e,t){if(null==t)return r(e);if(t instanceof HTMLElement)return d(e,t);var i=r(e);if(t.classes)for(var n of b(t.classes))i.classList.add(n);return i},createDialogDressVisual(c,m,g){return E.ProjectFilesUtil.getDress(R.getTypeID(c)).then(e=>{var e=(new DOMParser).parseFromString(e,"text/html").body.children[0],t=(e.remove(),e),i=w(t,c);if(i["##dialog_props"]=Object.create(null),c!=A){if(null!=m){var n,r,s,l,a=S();for([n,r]of M(m)){var o=n.split("$")[0],u=t.querySelector(`[data-by-prop="${o}"]`)||t.querySelector(`[data-by-member="${o}"]`)||null;u?(u=C.getVisual(u),a[n]=u):("undefined"!=typeof console&&console.warn(T._format(T.Dress_Member_Missing_Template,o)),u=new(r=R.getType(r)),a[n]=u)}for([s,l]of M(a))i["##dialog_props"][s]=l,(i[s]=l)["#dialog"]=i}if(null!=g)for(var[h,d]of M(g))null!=d&&(i[h]["#host"]=i[d])}return i})},registerDOMEvent(e,i,n,r){null==n&&(n=i),null==r&&(r=a),j(e.prototype,i,{get(){let t=I.$create(i);var e=this["#element"]||this["#window"]||this["#document"];return e&&e.addEventListener(n,e=>I.$invoke(t,[this,new(r||a)(e)])),F(this,i,t),t}})}}})();var e;if((e=window.navigator.userAgent).includes("MSIE ")||e.includes("Trident/"))throw new m(T.Browser_Version_Too_Low);const d=(()=>{"undefined"==typeof globalThis&&(window.globalThis=window);var e=(()=>{let e=0;const t=new Set;return{getAutoID(){return"by-auto-"+e++},getUniqueName(e){for(;t.has(e);)e+="$";return t.add(e),e},getElementById(e,t){return null==t?document.getElementById(e):"function"==typeof t.getElementById?t.getElementById(e):t.querySelector("#"+e)},createElement(e,t){var i=document.createElement(e||"div");if("object"==typeof t&&null!=t)if(t instanceof Map)for(var[n,r]of t.entries())i.setAttribute(n,r);else for(var[s,l]of M(t))i.setAttribute(s,l);return i}}})(),t=(()=>{let r=-1;let e=null;function t(){r=-1,function e(t,i){if("return"==i(t))return;for(var n of t.children)e(n,i)}(document.body,e=>{if(null==e||e.dataset.bytIgnoreZindex)return"return";e=window.getComputedStyle(e).zIndex;"auto"!=e&&(e=Number(e))>r&&(r=e)})}function s(){null!=e&&window.clearInterval(e),e=window.setInterval(()=>t(),1e4)}function l(){return-1==r&&(t(),s()),r}function a(e){return e instanceof HTMLElement?e.style.zIndex:e instanceof g?e.zIndex:-1}return s(),{getIsTopMost(e){return a(e)==l()},setToTopMost(e,t=!1){var i=a(e),n=l();!t&&i==n||(t=Math.max(i,n)+1,i=t,(n=e)instanceof HTMLElement?n.style.zIndex=i:n instanceof g&&(n.zIndex=i),e=t,r=e,s())}}})(),i={pixelToLength(e){return null==e?0:(e.endsWith("px")&&(e=e.slice(0,-2)),0|Number.parseInt(e))},lengthToPixel(e){return""==e||0==e?"0":e+"px"}};function r(e){e=(255&e).toString(16);return 1==e.length?"0"+e:e}function s(e){var t=-1<e.indexOf(",")?",":" ",i=e.indexOf("(");let n=e.indexOf(")");-1==n&&(n=void 0);var r=(e=-1<(e=e.slice(i+1,n)).indexOf("/")?e.replace("/",t):e).split(t),s=[];for(let e=0;e<3;e++)s[e]=0|Number.parseInt(r[e]);return null!=r[3]&&(i=r[3],s[3]=-1<i.indexOf("%")?Math.trunc(i.slice(0,-1)/100*255):255*Number(i)),s}var n={cssColorToRGBA(e,t=!1){var i,n;return null==e?[0,0,0]:e.startsWith("#")?([t,n=!1]=[e,t],9<=t.length?[t.slice(1,3),t.slice(3,5),t.slice(5,7),t.slice(7,9)].map(e=>0|Number.parseInt("0x"+e)):7<=t.length?(i=[t.slice(1,3),t.slice(3,5),t.slice(5,7)].map(e=>0|Number.parseInt("0x"+e)),n||i.push(255),i):4<=t.length?[t[1],t[2],t[3],t[4]].map(e=>0|Number.parseInt("0x"+e+e)):(i=[t[1],t[2],t[3]].map(e=>0|Number.parseInt("0x"+e+e)),n||i.push(255),i)):e.startsWith("rgb")?s(e):((t=document.createElement("div")).style.color=e,document.body.append(t),n=window.getComputedStyle(t).color,t.remove(),s(n))},RGBAToCssColor(e,t,i,n){return null==n||255==n||"100%"==n?"#"+r(e)+r(t)+r(i):"#"+r(e)+r(t)+r(i)+r(n)}};const l=new Map,a=new Map,o={loadScript(o){var e;return l.has(o)?l.get(o):(e=new Promise((t,i)=>{let e=document.createElement("script");e.async=!0;let n;function r(){null!=n&&(clearTimeout(n),n=void 0),null!=e&&(e.removeEventListener("load",s),e.removeEventListener("error",l),e.remove(),a=s=l=e=null)}function s(e){t(e),r()}function l(e){i(e),r()}function a(){r(),i("timeout")}n=window.setTimeout(a,5e3),e.addEventListener("load",s),e.addEventListener("error",l),e.src=o,(document.head||document.body).appendChild(e)}),l.set(o,e),e)},loadStyleSheet(o){var e;return a.has(o)?a.get(o):(e=new Promise((t,i)=>{let e=document.createElement("link");e.rel="stylesheet";let n;function r(){null!=n&&(clearTimeout(n),n=void 0),null!=e&&(e.removeEventListener("load",s),e.removeEventListener("error",l),a=s=l=e=null)}function s(e){t(e),r()}function l(e){i(e),r()}function a(){r(),i("timeout")}n=window.setTimeout(a,5e3),e.addEventListener("load",s),e.addEventListener("error",l),e.href=o,(document.head||document.body).appendChild(e)}),a.set(o,e),e)}};return{ElementHelper:e,ZIndexHelper:t,ColorHelper:n,PixelUnitHelper:i,onDOMReady(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",()=>e())},fetch(e,t){return fetch(e,t)},loadScript(e){return o.loadScript(e)},loadStyleSheet(e){return o.loadStyleSheet(e)},setTimeout(e,t,i){return globalThis.setTimeout(e,t,i)},clearTimeout(e){return globalThis.clearTimeout(e)},setInterval(e,t,i){return globalThis.setInterval(e,t,i)},clearInterval(e){return globalThis.clearInterval(e)},get globalThis(){return globalThis},get document(){return globalThis.document},get localStorage(){return globalThis.localStorage},browser:{location:document.location,getFullUrl(e){return new URL(e||"",document.location).toString()}}}})();function f(e){if(null==new.target)return e}function q(e,t){if(null==new.target)return null!=t||p(e)?e:[e]}function O(e){if(null==new.target)return null==e?null:e instanceof O?e:"function"==typeof e.$identity?e.$identity():null}function W(e){return e}R.declareNativeType(Object,{id:"EsObject",instance:{by$toString(){return this.toString()},by$equals(e){return f.by$equals(this,e)}}}),R.declareSystemType(f,{id:"Object",name:"Object",alias:"object",extend:Object,transmit:{toJSON(e,t){if("function"==typeof e.$toJSON)return e.$toJSON(t);if("object"!=typeof e)return e;throw new Fe("serialize","cannot find toJSON")},fromJSON(e,t){if(null==e)return null;if("object"!=typeof e)return e;if("USERDEFINED"==e["#"]){var[i,n]=e.$TYPE.split("."),i=L.$getKu(i).object[n];if(null!=i&&i.$fromJSON!=f.$fromJSON)return t.rebuild(e,i)}throw new Fe("rebuild","cannot find fromJSON")},toExternal(e){return null==e?null:"object"==typeof e&&null!=e["#external"]?e["#external"]:e},fromExternal(e){return null==e?null:"object"!=typeof e?e:xe.rebuild(e)}},instance:{$0(){},$access(e){return f.by$access(this,e)},$assign(e,t,i){return f.by$assign(this,e,t,i)},i$access(e){var t=this.$identity();return null==t?null:t.$access(e)},i$assign(e,t,i){var n=this.$identity();return null==n?null:n.$assign(e,t,i)},$identity(){return this["#identity"]},$bindIdentity(e){return null!=(e=e instanceof O?e:O.$getBindIdentity(e))&&F(this,"#identity",e),this},$init(e,t){return f.by$init(this,e,t)},by$toString(){return f.by$toString(this)},toString(){return this.by$toString()},by$equals(e){return f.by$equals(this,e)}},static:{equals(e,t){return f.by$equals(e,t)},by$equals(e,t){return h.isPrimitiveItem(e)?h.primitiveEquals(e,t):e==t},toString(e){return f.by$toString(e)},by$toString(e){if(null==e)return"";var t=Object.getPrototypeOf(e);if(null!=t){t=t.constructor;if(null!=t)return R.getTypeID(t)||t.name}return Object.prototype.toString.call(e)},$new(e,t){var i=new this;return Object.by$init(i,e,t)},by$init(e,t,i){null==i&&"function"==typeof t&&(i=t,t=void 0),null!=t&&"function"==typeof e.$bindIdentity&&e.$bindIdentity(t);let n;return"function"==typeof i?n=i(e):"function"==typeof e.$0&&(n=e.$0()),n instanceof Promise?n.then(()=>e):e},by$access(e,t){let i;t=e[i="string"==typeof t?t:R.InheritImplementHelper.getImplementMemberName(e,t)];return"function"==typeof t?(null==e["##method_cache"]&&(e["##method_cache"]=S()),null!=e["##method_cache"][i]?e["##method_cache"][i]:e["##method_cache"][i]=t.bind(e)):t},by$assign(e,t,i,n){let r;return r="string"==typeof t?t:R.InheritImplementHelper.getImplementMemberName(e,t),null==n?e[r]=i:(t=n(e[r],i),e[r]=t)}}}),R.declareSystemCollectionType(Array,{id:"EsArray",collection:"default"}),R.declareSystemCollectionType(q,{id:"Array",alias:"array",extend:Array,collection:"default",static:{[Symbol.hasInstance](e){return p(e)},$arrayFindIndex(e,t){return Array.prototype.findIndex.call(e,t)},$arrayAddItems(e,t){if(t&&t[Symbol.iterator])for(var i of t)e.push(i)},$sortArray(e,t){return Array.prototype.sort.call(e,t)},$create(e,t,i){return q.$newArray(e,t,i)},$newArray(t,i,e){null==t&&(t=f),null==i&&(i=0);var n=[];if(0<(e=null==e?[]:e).length){var r=e[0],s=e.slice(1);for(let e=0;e<r;e++)1<i?n.push(q.$newArray(t,i-1,s)):1==i&&n.push(R.getTypeDefault(t))}return n}}}),R.declareSystemType(O,{id:"Identity",name:"Identity",alias:"identity",domain:P.identity,transmit:{toJSON(e){var t=e["#inner"];let i;return{"#":"IDENTITY",$INSTANCE:{$INNER:!!t,$VALUE:i=t?V.$getTransmitData(e["#to"]):e["new#id"]}}},fromJSON(e){var t=e.$INSTANCE.$INNER,e=e.$INSTANCE.$VALUE;return t?L.$getKuField(e)["#identity"]:L.$getKuNewIdentity(e)}},instance:{$0(){},$identity(){return this},$to(){return this["#to"]},$bindTo(e){F(this,"#to",e)},$access(e){return f.by$access(this,e)},$assign(e,t,i){return f.by$assign(this,e,t,i)},i$access(e){return this.$access(e)},i$assign(e,t,i){return this.$assign(e,t,i)},$init(e){return f.by$init(this,null,e)},toString(){return this.by$toString()},by$toString(){return f.by$toString(this)},by$equals(e){return f.by$equals(this,e)}},static:{$new(e){return f.by$init(new this,null,e)},$getBindIdentity(e){return null!=e&&"function"==typeof e.$identity?e.$identity():null},$setBindIdentity(e,t){return null==e?null:"function"==typeof e.$bindIdentity?e.$bindIdentity(t):void 0},$getBindTo(e){return null==e?null:e["#to"]},$setBindTo(e,t){null!=e&&e.$bindTo(t)},$$createNewIdentity(e,t,i){i=new(i=R.getType(i));return F(i,{"#name":t,"#ku":e,"#inner":!1,"new#id":e.name+"."+t}),i},$$createFieldInnerIdentity(e,t,i){i=new(i=null!=i?R.getType(i):Di);return F(i,{"#name":t,"#ku":e,"#inner":!0,"new#id":e.name+"."+t}),i},$$setNewIdentityComponentInfo(e,t){for(var[i,n]of M(t))"string"==typeof n?F(e,i,L.$getKuNewIdentity(n,e["#ku"])):n.inner&&(n=n.value,n=L.$getKuField(n),n=O.$getBindIdentity(n),F(e,i,n))},$$setNewPageElements(e,t){var{src:t,elements:i}=t;Ii.$$setPagePathAndElements(e,t,i),e["#to"]||O.$setBindTo(e,t)},$$setNewIdentityConfigs(e,t){let n=e["#to"];F(e,"#configMap",_(t,e=>{var t,i;return e.includes(":")?([t,i]=e.split(":"),L.$getKuTable(t).$getFlow(i)):n.$getFlow(e)}))},$$setNewIdentityDialogs(e,t){let l=e["#to"];F(e,"#dialogMap",_(t,e=>{var i,n,r,s=S();for([i,n]of M(e)){let e,t;t=n.includes(":")?(r=n.split(":"),e=L.$getKuTable(r[0]),r[1]):(e=l,n),s[i]=e.$getControl(t)}return s}))},$getIdentityDialogControl(e,t){var i=e["#dialogMap"];let n=null;if(null!=i){let e=t;for(;null!=e;){var r=R.getTypeID(e);if(w(i,r)){n=i[r];break}e=Object.getPrototypeOf(e)}}return n}}}),R.declareSystemType(W,{id:"Enum",alias:"enum",kind:be.struct});class I{constructor(e){F(this,"#delegates",[]),F(this,"#eventname",e)}$add(e){if(e instanceof I)for(var t of e["#delegates"])this["#delegates"].push(t);else"function"==typeof e&&this["#delegates"].push(e);return this}$remove(e){var t=this["#delegates"];if(e instanceof I)for(var i of e["#delegates"]){i=t.indexOf(i);0<=i&&t.splice(i,1)}else"function"==typeof e&&0<=(e=t.indexOf(e))&&t.splice(e,1);return this}by$equals(e){if(null==e)return 0==this["#delegates"].length;if(e instanceof I){var t=this["#delegates"],i=e["#delegates"];if(t.length!=i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!1;return!0}return"function"==typeof e&&1==this["#delegates"].length&&this["#delegates"][0]==e}$invoke(...e){return I.$invoke(this,e)}static $create(e){return new I(e)}static $add(e,t){return null!=e?e.$add(t):t}static $remove(e,t){if(null!=e)return e.$remove(t)}static async $invoke(e,t){for(var i of e["#delegates"])"function"==typeof i&&await i.apply(null,t)}}class a extends f{}function Y(e){return null!=new.target?new Boolean(e):"string"==typeof e?"true"==e.toLowerCase():!!e}R.declareSystemType(a,{id:"EventArgs"}),R.declareNativeType(Boolean,{instance:{by$toString(){return!0===this.valueOf()?"True":"False"},by$equals(e){return this.valueOf()==e}}}),R.declareSystemPrimitiveType(Y,{id:"Bool",alias:"bool",extend:Boolean,numeric:{"|":(e,t)=>Boolean(e||t),"||":(e,t)=>Boolean(e||t),"&":(e,t)=>Boolean(e&&t),"&&":(e,t)=>Boolean(e&&t),"^":(e,t)=>Boolean(e^t)},static:{[Symbol.hasInstance]:e=>"boolean"==typeof e||e instanceof Boolean,$parse(e){return null==e?null:"true"==(e=e.toLowerCase())||"false"!=e&&null},parse(e){e=Y.$parse(e);return null!=e&&e}}});const r=(()=>{const i=Symbol("value");function n(e){if(null==new.target)return new n(e);if(e instanceof n)return e;switch(typeof e){case"string":e=e.charCodeAt(0);break;case"number":e&=65535;break;default:e=65535&Number.by$toInt32(e)}F(this,i,e)}function t(e,t){return e==t||(e=e instanceof n?e:"string"==typeof e||"number"==typeof e?n(e):null,t=t instanceof n?t:"string"==typeof t||"number"==typeof t?n(t):null,null!=e&&null!=t&&e[i]==t[i])}return R.declareSystemPrimitiveType(n,{id:"Char",alias:"char",numeric:"default",instance:{[Symbol.toPrimitive](e){return"string"==e?String.fromCharCode(this[i]):this[i]},valueOf(){return this[i]},toString(){return String.fromCharCode(this[i])},by$toString(){return String.fromCharCode(this[i])},by$equals(e){return t(this,e)},toJSON(){return this.toString()}},static:{MAX:new n(65535),MIN:new n(0),equals:t,by$equals:t,parse:e=>new n(null==e?0:e.charCodeAt(0)),toLower(e){return new n(e.toString().toLowerCase().charCodeAt(0))},toUpper(e){return new n(e.toString().toUpperCase().charCodeAt(0))}}}),n})();function J(e){return null!=new.target?new Number(J(e)):128<=(e=255&Number.by$toInt32(e))?e-256:e}function G(e){return null!=new.target?new Number(G(e)):32768<=(e=65535&Number.by$toInt32(e))?e-65536:e}function X(e){return null!=new.target?new Number(X(e)):Number.by$toInt32(e)}R.declareSystemPrimitiveType(J,{id:"Byte",alias:"byte",extend:Number,numeric:"default",static:{[Symbol.hasInstance]:e=>"number"==typeof e&&Number.isInteger(e)&&J.MIN<=e&&e<=J.MAX,MIN:-128,MAX:127,parse(e,t){return J(Number.parseInt(e,t))}}}),R.declareSystemPrimitiveType(G,{id:"Short",alias:"short",extend:Number,numeric:"default",static:{[Symbol.hasInstance]:e=>"number"==typeof e&&Number.isInteger(e)&&G.MIN<=e&&e<=G.MAX,MIN:-32768,MAX:32767,parse(e,t){return G(Number.parseInt(e,t))}}}),R.declareSystemPrimitiveType(X,{id:"Int",alias:"int",extend:Number,numeric:"default",static:{[Symbol.hasInstance]:e=>"number"==typeof e&&Number.isInteger(e)&&X.MIN<=e&&e<=X.MAX,MIN:-2147483648,MAX:2147483647,parse(e,t){return X(Number.parseInt(e,t))},toString(e,t){return e|=0,null==t||2<=!t?e.toString():e.toString(t)},toUnsignedString(e,t){return(e|=0)<0&&(e+=4294967296),null==t||2<=!t?e.toString():e.toString(t)}}});const l=(()=>{const n=Symbol("longBuf"),d=1,c=0,m=0x8000000000000000,g=4294967296,p=4294967295,t=2147483647;function r(e){return null==new.target?new r(e):e instanceof r?e:void i(function t(i){switch(typeof i){case"number":return f(i);case"string":return s(i);case"bigint":return s(i.toString());default:if(null!=i){if(i instanceof r)return i[n];if(i instanceof Uint32Array)return i;if(i[Symbol.iterator])return $(...i);if(i.valueOf){let e=i.valueOf();if(e!==i)return t(e)}}return $()}}(e),this)}function i(e,t){return F(t=null==t?Object.create(r.prototype):t,n,e),t}function s(e,t){var i=Number.parseInt(e,t);if(Number.isNaN(i))return $();var n=Math.abs(i);if(n>m)throw new Oe;if(n<Number.MAX_SAFE_INTEGER)return f(i);var r=null!=t&&0|t||10,s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"].slice(0,r);let l=!1,a=("-"==(e=e.trim().toLowerCase())[0]?(l=!0,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1)),0);for(;a<e.length&&s.includes(e[a]);a++);n=(e=e.slice(0,a)).slice(0,13),i=e.slice(13);let o=i.length,u=1;for(;0<o;o--)u*=r;var[t,n]=D(Number.parseInt(n,r));let h=t*u+Number.parseInt(i,r),d=n*u;return h>g&&([t,i]=D(h),d+=i,h=t),y(h,d,l)}function f(e){if(Number.isNaN(e))return $();let t,i;var n=Math.abs(Math.trunc(e)),e=e<0;if(n>m)throw new Oe;return n<g?(t=n,i=0):[t,i]=D(n),y(t,i,e)}function $(e=0,t=0){var i=new Uint32Array(2);return i[c]=e,i[d]=t,i}function y(e,t,i=!1){return i&&([e,t]=l(e,t)),$(e,t)}function v(e){return $(e[c],e[d])}function l(e,t){return 0!=e?[g-e,p-t]:0!=t?[0,p-t+1]:[0,0]}function b(e){var[e,t]=l(e[c],e[d]);return $(e,t)}function x(e){return e[d]*g+e[c]}function w(e){return e[d]>t}function a(e){return 0==e[d]&&0==e[c]}function S(e,t){var i=e[c],e=e[d],n=t[c],t=t[d];return t<e?1:e<t?-1:n<i?1:i<n?-1:0}function o(e,t){var i=65535&e,e=e>>>16,n=65535&t,t=t>>>16;let r=i*n,s=i*t+e*n,l=e*t;for(;s>=g;)s-=g,l+=65536;return l+=s>>>16,(r+=65536*(65535&s))>=g&&(r-=g,l++),[r,l]}function T(e,t){var i=e[c],e=e[d],n=t[c],t=t[d],[r,s]=o(i,n),[i]=o(i,t),[t]=o(e,n);return $(r,s+i+t)}function E(e,t){var i=e%t;return[(e-i)/t,i]}function u(t,i){var e,n,r,s=t[c],l=t[d],a=i[c],o=i[d];if(l<o||l==o&&s<a)return[$(),t];if(l==o)return[e,r]=0==l?E(s,a):[1,s-a],[$(e,0),$(r,0)];if(0==o&&a<1048576)return[e,r]=E(s,a),[o,s]=E(l,a),[l,n]=E(g,a),[n,r]=E(s*n+r,a),[a,s]=E(s*l+e+n,g),[$(s,o+a),$(r,0)];{var u=D(Math.trunc(x(t)/x(i))),h=b(i);let e=C(t,T(u,h));if(w(e))for(;e=C(e,i),0==u[c]?(u[c]=p,u[d]--):u[c]--,w(e););else if(0<=S(e,i))for(;e=C(e,h),u[c]++,u[c]==g&&(u[c]=0,u[d]++),0<=S(e,i););return[v(u),e]}}function C(e,t){let i=e[c]+t[c],n=0;i>=g&&(i-=g,n=1);e=e[d]+t[d]+n;return $(i,e)}function h(e){return i(e)}function I(e){return null==e?null:e[n]}function A(e,t){return h($(e,t))}function D(e){var t=e%g;return[t,(e-t)/g]}function k(e,t){var i;return e==t?0:(e=I(e),t=I(t),null==e?-1:null==t?1:(t=t,(i=w(e=e))==w(t)?S(e,t):i?-1:1))}function N(e,t,i=!1){e=I(e),t=I(t);if(null==e||null==t)return null;var n=C(e,t);if(i&&((e[d]^n[d])&(t[d]^n[d]))>>>31==1)throw new Oe;return h(n)}function e(e,t){e=I(e),t=I(t);return null==e||null==t?null:h(T(e,t))}function P(e,t){var e=I(e),t=I(t);return null==e||null==t?[null,null]:([e,t]=function(e,t){if(a(t))throw new Oe;var i=w(e),n=w(t),[e,t]=u(i?b(e):e,n?b(t):t);return[i!=n?b(e):e,i?b(t):t]}(e,t),[h(e),h(t)])}function _(e,t,i){e=I(e),t=I(t);return null==e||null==t?null:A(i(e[c],t[c]),i(e[d],t[d]))}function B(e){e=I(e);return null==e?r(0):h(v(e))}function M(e){e=I(e);return null==e?r(0):h(b(e))}function O(n){n=I(n);if(null==n)return"0";{var e=w(n=n),n=e?b(n):n;let i;if((r=x(n))<Number.MAX_SAFE_INTEGER)i=r.toString();else{var[r,n]=u(n,$(1e5,0)),r=x(r),n=x(n);let e=r.toString(),t=n.toString();for(;t.length<5;)t="0"+t;i=e+t}return e?"-"+i:i}}return R.declareSystemPrimitiveType(r,{id:"Long",alias:"long",numeric:{"u-":M,"u+":B,"u~"(e){e=I(e);return null==e?r(0):A(~e[c],~e[d])},"+":(e,t)=>N(e,t,!1),"-":(e,t)=>N(e,M(t),!1),"*":e,"/":(e,t)=>{var[e,,]=P(e,t);return e},"%":(e,t)=>{var[,e]=P(e,t);return e},"^":(e,t)=>_(e,t,(e,t)=>e^t),"&":(e,t)=>_(e,t,(e,t)=>e&t),"|":(e,t)=>_(e,t,(e,t)=>e|t),"<<"(e,t){var i;return 0==(t&=63)?B(e):null==(e=I(e))?null:31<t?A(0,e[c]<<t-32):A((i=e[c])<<t,(e[d]<<t)+(i>>>32-t))},">>"(e,t){var i;return 0==(t&=63)?B(e):null==(e=I(e))?null:31<t?(i=w(e),A(e[d]>>t-32,i?p:0)):A((e[c]>>>t)+((i=e[d])<<32-t),i>>t)},"==":(e,t)=>0==k(e,t),"!=":(e,t)=>0!=k(e,t),">":(e,t)=>0<k(e,t),">=":(e,t)=>0<=k(e,t),"<":(e,t)=>k(e,t)<0,"<=":(e,t)=>k(e,t)<=0},instance:{by$equals(e){return e instanceof r?0==k(this,e):"number"==typeof e&&0==k(this,r(e))},toString(){return O(this)},by$toString(){return O(this)},valueOf(){return O(this)}},static:{MIN:A(0,-2147483648),MAX:A(p,t),parse:function(e){return i(s(e))},by$equals(e,t){return e==t||e instanceof r&&t instanceof r&&0==k(e,t)},abs(e){e=I(e);return null==e?r(0):h((w(e)?b:v)(e))},sign(e){e=I(e);return null==e?0:w(e)?-1:a(e)?0:1},neg:M,clone:B,add:N,multi:e,compare:k,$toInt32(e){e=I(e);return null==e?0:0|e[c]}}}),r})();function Q(e){return null!=new.target?new Number(Q(e)):Math.fround(Number.by$toNumber(e))}function Z(e){return null!=new.target?new Number(Z(e)):Number.by$toNumber(e)}R.declareSystemPrimitiveType(Q,{id:"Float",alias:"float",extend:Number,numeric:"default",static:{[Symbol.hasInstance]:e=>"number"==typeof e,MIN:-(2**128-2**104),MAX:2**128-2**104,Infinity:Number.POSITIVE_INFINITY,EPSILON:Number.EPSILON,NaN:Number.NaN,parse(e){return Math.fround(Number.parseFloat(e))},isFinite(e){return Number.isFinite(e)},isInfinity(e){return!Number.isFinite(e)},isNaN(e){return Number.isNaN(e)}}}),R.declareSystemPrimitiveType(Z,{id:"Double",alias:"double",extend:Number,numeric:"default",static:{[Symbol.hasInstance]:e=>"number"==typeof e,MIN:-Number.MAX_VALUE,MAX:Number.MAX_VALUE,Infinity:Number.POSITIVE_INFINITY,EPSILON:Number.EPSILON,NaN:Number.NaN,parse(e){return Number.parseFloat(e)},isFinite(e){return Number.isFinite(e)},isInfinity(e){return!Number.isFinite(e)},isNaN(e){return Number.isNaN(e)}}});const c=(()=>{const i=Symbol("buffer"),c=28,m=57,h=61,g=62,r=63;function n(e){return null==new.target?new n(e):e instanceof n?e:void l(function t(i){switch(typeof i){case"string":return E(i);case"number":case"bigint":return E(i.toString());default:if(null!=i&&i.valueOf){let e=i.valueOf();if(e!==i)return t(e)}return p()}}(e),this)}function l(e,t){return F(t=null==t?Object.create(n.prototype):t,i,e),t}function a(e){return null==e?null:e[i]}function p(t,e){var i=new Int8Array(64);if(null!=t)if(t instanceof Int8Array)i.set(t);else for(let e=0;e<64;e++){var n=t[e];n&&(i[e]=n)}else i[r]=-1;return i[h]=1|e,i}function d(e){if(-1!=e[r])return e[r];let t=m-1;for(;0<=t&&!(0<e[t]);t--);return e[r]=t}function u(e){let t;for(t=0;t<=c&&!(0<e[t]);t++);return t}function o(t){for(let e=0;e<=m;e++)if(0!=t[e])return;return 1}function f(t,i){for(let e=m-1;0<=e;e--){var n=K(t[e],i[e]);if(0!=n)return n}return 0}function $(e){if(0!=e[m])throw new Oe}function s(t,i){var n=p();for(let e=0;e<m;e++)n[e]=t[e]+i[e];return $(function(t){for(let e=0;e<m;e++)for(;10<=t[e];)t[e]-=10,t[e+1]+=1;return t}(n)),n[g]=Math.max(t[g],i[g]),n}function y(t,i){var e=f(t,i);if(0==e)return[0,p()];var n=p();if(0<e)for(let e=0;e<m;e++)n[e]=t[e]-i[e];else for(let e=0;e<m;e++)n[e]=i[e]-t[e];var r=n;for(let e=0;e<m;e++)for(;r[e]<0;)r[e]+=10,--r[e+1];return n[h]=1|e,n[g]=Math.max(t[g],i[g]),[e,n]}function v(t,i=1){if(0==i)return t;var n=p();for(let e=i;e<m;e++)n[e]=t[e-i];return n}function b(){var t=new Array(96).fill(0);for(let e=-1;-30<e;e--)t[e]=0;return t}function x(t,e){var i=p();for(let e=-29;e<-1;e++){var n=t[e];10<=n&&(t[e+1]+=n/10|0)}var r=0|t[-1],s=r%10;let l=(r-s)/10;5<=s&&l++,t[0]+=l;for(let e=0;e<m;e++){var a,o=t[e]+i[e];10<=o?(a=i[e]=o%10,i[e+1]=(o-a)/10):i[e]=o}return $(i),i[g]=null==e?c-u(i):e,i}function w(e,t){return p(function(t,i){var n=b(),r=[];for(let e=0;e<m;e++){var s=i[e];0!=s&&r.push([e,s])}for(let e=0;e<m;e++){var l=t[e];if(0!=l)for(var[a,o]of r)n[e+a-c]+=l*o}return x(n,t[g]+i[g])}(e,t),e[h]*t[h])}function S(e,i){var n=d(e),r=d(i);let s=e;var l=p();if(29<n-r)throw new Oe;for(let t=n-r;0<=t;t--){var a=v(i,t);let e=0;for(;0<s[h];){var[o,u]=y(s,a);if(!(0<o)){if(0!=o)break;e++,s=u;break}e++,s=u}l[c+t]=e}return[l,s]}function T(e,t){var[i,n]=function(e,t){var i=b();let n=0,r=e;for(;n<=30&&!o(r);)if(f(r,t)<0)r=v(r,1),n++;else{var[s,l]=S(r,t);for(let e=c;e<=m;e++)i[e-n]+=s[e];r=l}return[x(i),r]}(e,t);return i[h]=e[h]*t[h],n[h]=e[h],[i,n]}function E(e){if(null==e||""==e)return p();let t=1,i=[],n,r,s=0,l=e.length;for("-"==e[0]?(t=-1,s=1):"+"==e[0]&&(s=1);s<l&&"0"==e[s];s++);for(;s<l;s++){var a=e[s];if("0"<=a&&a<="9")i.push(a);else{if("."!=a){if("e"!=a&&"E"!=a)break;r=0|Number.parseInt(e.slice(s+1));break}n=i.length}}if(0==i.length)return p();var o=i.length,u=(null==n&&(n=o),null==r&&(r=0),n+r),h=p(null,t);for(let e=o-1,t=u-o+c;0<=e&&t<m;e--,t++)t<0||(h[t]=i[e]);let d=u<o?o-u:0;return 28<d&&(d=28),h[g]=d,h}function e(e,t=!1){let i=t||e[g]<0?u(e):c-e[g],n=d(e),r=(n<c&&(n=c),-1==e[h]?"-":"");return r+=Array.prototype.reverse.call(e.slice(c,n+1)).join(""),i<c&&(i<0&&(i=0),r=(r+=".")+Array.prototype.reverse.call(e.slice(i,c)).join("")),r}function C(e){e=a(e)||p();return l(p(e,-e[h]))}function I(e,t){var i,n;return e==t||(e=a(e),t=a(t),e==t)?0:null==e?-1:null==t?1:(t=t,i=(e=e)[h],n=t[h],i!=n?K(i,n):i*f(e,t))}function A(e,t){var i,n,e=a(e)||p(),t=a(t)||p();return l((t=t,i=(e=e)[h],n=t[h],i==n?p(s(e,t),i):([e,t]=y(e,t),p(t,0<e?i:n))))}function t(t,i=0,e=null){var n=a(t)||p(),t=n[g];let r=!1;if(i<t)for(let e=t;e>i;e--)if(0!=n[c-e]){r=!0;break}var s=p(n,n[h]);if(r){for(let e=c-i;e<m;e++)s[e]=n[e];if(null!=e&&e(n)){s[c-i]++;for(let e=c-i;e<m&&10<=s[e];e++)s[e]-=10,s[e+1]+=1}}s[g]=i;for(let e=0;e<c-i;e++)s[e]=0;return l(s)}return R.declareSystemPrimitiveType(n,{id:"Decimal",alias:"decimal",numeric:{"+":A,"-":(e,t)=>A(e,C(t)),"*":function(e,t){return l(w(a(e)||p(),a(t)||p()))},"/":function(e,t){var e=a(e),t=a(t);return null==e||null==t?null:([e]=T(e,t),l(e))},"%":function(e,t){var i,e=a(e),t=a(t);return null==e||null==t?null:([i,e]=function(e,t){var[i,n]=S(e,t);return i[h]=e[h]*t[h],n[h]=e[h],[i,n]}(e,t),l(e))},"==":(e,t)=>0==I(e,t),"!=":(e,t)=>0!=I(e,t),">":(e,t)=>0<I(e,t),">=":(e,t)=>0<=I(e,t),"<=":(e,t)=>I(e,t)<=0,"<":(e,t)=>I(e,t)<0,"u-":C,"u+":function(e){return e=a(e)||p(),l(p(e))}},instance:{[Symbol.toPrimitive](e){switch(e){case"number":return Number(this.toString());case"string":return this.toString();default:return this.valueOf()}},toString(){return e(this[i])},by$toString(){return e(this[i])},valueOf(){return e(this[i],!0)},toJSON(){return e(this[i])},by$equals(e){return null!=e&&(e instanceof n?0==I(this,e):"number"==typeof e&&0==I(this,n(e)))}},static:{MIN:n("-79228162514264337593543950335"),MAX:n("79228162514264337593543950335"),parse(e){return l(E(e||""))},compare:I,getDigits(e){e=a(e);return null==e?0:e[g]},sign(e){e=a(e);return null==e||o(e)?0:e[h]},abs(e){e=a(e)||p();return l(p(e,1))},truncate(e){return t(e)},ceil(e){return t(e,0,e=>0<e[h])},floor(e){return t(e,0,e=>e[h]<0)},roundTo(e,n=0){return 0<=n?28<n&&(n=28):n=0,t(e,n,t=>{var i=c-n-1,e=t[i];if(5<e)return!0;if(5!=e)return!1;for(let e=i-1;0<=e;e--)if(0!=t[e])return!0;return t[1+i]%2==1})},$toInt32(e){e=t(e).toString();return 10<e.length?2147483647:0|e}}}),n})();{const Ni={none:"g",multiline:"gm",ignorecase:"gi",multiignorecase:"gmi"};function ee(e,t){return t=$(t).toLowerCase(),new RegExp(e,Ni[t]||"g")}void 0===String.prototype.trimStart&&(String.prototype.trimStart=String.prototype.trimLeft),void 0===String.prototype.trimEnd&&(String.prototype.trimEnd=String.prototype.trimRight),void 0===String.prototype.replaceAll&&(String.prototype.replaceAll=function(e,t){return String.prototype.replace.call(this,new RegExp(e,"g"),t)}),R.declareNativeType(String,{id:"EsString",instance:{by$charAt(e){if(0<=e&&e<this.length)return new r(this[e]);throw new Ce(this,e)},by$compareTo(e){return this.localeCompare(e)},by$contains(e){return this.includes(e)},by$insert(e,t=""){return this.substring(0,e)+t+this.substring(e)},by$indexOf(e){return null==e?-1:"string"==typeof e?this.indexOf(e):this.indexOf(e.toString())},by$remove(e,t){return null==t?this.substring(0,e):this.substring(0,e)+this.substring(t)},by$toCharArray(){return N(this,e=>new r(e.charCodeAt()))},by$findMatches(e,t){return!e||null==(e=String.prototype.match.call(this,ee(e,t)))?[]:e},by$matches(e,t){return this.by$findMatches(e,t)},by$isMatch(e,t){return!e||ee(e,t).test(this)},by$replace(e,t){return this.replaceAll(e,t)},by$replaceFirst(e,t){return this.replace(e,t)},by$replaceReg(e,t,i){return e?this.replace(ee(e,i),t||""):this.toString()},by$split(e){return this.split($(e))},by$equals(e){return this.valueOf()==e},by$toString(){return this.valueOf()},by$lTrim(){return this.trimStart()},by$rTrim(){return this.trimEnd()},by$subString(e,t){return this.substring(e,t)},by$toLower(){return this.toLowerCase()},by$toUpper(){return this.toUpperCase()}}})}function $(e){return null!=new.target?new String(e):null==e?"":"string"==typeof e?e:e.toString()}function te(e,t){return null==e?null==t?0:-1:null==t?1:e.localeCompare(t)}function i(e,t,i,n=0,r=0){return te(null==e?null:e.substring(t,t+r),null==i?null:i.substring(n,n+r))}R.declareSystemPrimitiveType($,{id:"String",alias:"string",extend:String,hasInstance:e=>"string"==typeof e,numeric:{"+":(e,t)=>$(e)+$(t)},static:{EMPTY:"",$parse(e){return null==e?"":e},compare(...e){return(e.length<=2?te:i).apply(null,e)},compareSubString:i,parse(e){return null==e?"":e},concat:e=>p(e)?e.join(""):$(e),join:(e,t=[])=>t.join(e),isNullOrEmpty(e){return null==e||""==e}}});const Se=(()=>{const t="yyyy-MM-dd HH:mm:ss.fff",n={0:"SUNDAY",1:"MONDAY",2:"TUESDAY",3:"WEDNESDAY",4:"THURSDAY",5:"FRIDAY",6:"SATURDAY"},r=new Date("0001-01-01T00:00:00.000"),s=Symbol("dt"),l=Symbol("value");function a(...e){if(null==new.target)return new a(...e);let t=1<e.length&&"number"==typeof e[0]?u(...e):function(e){if(null==e||""==e)return r;if(e instanceof Date)return e;switch(typeof e){case"string":var t=o(e);return t||r;case"number":return Number.isFinite(e)?new Date(e):r;case"bigint":return new Date(Number(e));default:t=new Date(e);return Number.isNaN(t.valueOf())?r:t}}(e[0]),i=t.valueOf();Number.isNaN(i)&&(i=0,t=r),F(this,{[s]:t,[l]:i,year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),weekNumber:t.getDay(),dayOfWeek:n[t.getDay()],dayOfWeekValue:t.getDate(),hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),milliSecond:t.getMilliseconds(),millisecond:t.getMilliseconds()})}function o(e){if(null==e)return null;/^\d{4}-\d{2}-\d{2} /.test(e)&&(e=e.replace(" ","T"));e=Date.parse(e);return Number.isFinite(e)?new Date(e):null}function u(e=1,t=1,i=1,n=0,r=0,s=0,l=0){t=new Date(e,t-1,i,n,r,s,l);return 100<=e?t:new Date(t.setFullYear(e))}const i=(()=>{const i={D:"toLocaleDateString",d:"toLocaleDateString",u:"toString",F:"toLocaleString",f:"toLocaleString",s:"toISOString",R:"toUTCString",r:"toUTCString",T:"toLocaleTimeString",t:"toLocaleTimeString"},n={y(e){return(e.year%100).toString()},yy(e){return("0"+e.year).slice(-2)},yyy(e){return("00"+e.year).slice(-3)},yyyy(e){return("000"+e.year).slice(-4)},yyyyy(e){return("0000"+e.year).slice(-5)},M(e){return e.month.toString()},MM(e){return("0"+e.month).slice(-2)},d(e){return e.day.toString()},dd(e){return("0"+e.day).slice(-2)},h(e){let t=e.hour%12;return(t=0==t?12:t).toString()},hh(e){let t=e.hour%12;return("0"+(t=0==t?12:t)).slice(-2)},H(e){return e.hour.toString()},HH(e){return("0"+e.hour).slice(-2)},m(e){return e.minute.toString()},mm(e){return("0"+e.minute).slice(-2)},s(e){return e.second.toString()},ss(e){return("0"+e.second).slice(-2)},f(e){return(e.milliSecond/100|0).toString()},ff(e){return("00"+e.milliSecond).slice(-3).substring(0,2)},fff(e){return("00"+e.milliSecond).slice(-3)}};return function(t,e){return 1==(e=$(e)).length&&w(i,e)?t[s][i[e]]():e.replace(/y{1,5}|M{1,2}|d{1,2}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|f{1,3}/g,e=>n[e](t))}})();function h(e,t){return e==t?0:null==e?-1:null==t?1:K(e.valueOf(),t.valueOf())}function d(e){e=o(e);return null==e?null:new a(e)}return R.declareSystemPrimitiveType(a,{id:"DateTime",alias:"datetime",instance:{toString(){return i(this,t)},by$toString(){return i(this,t)},format(e){return i(this,e||t)},valueOf(){return this[l]},by$equals(e){return e instanceof a&&e.valueOf()==this.valueOf()},compareTo(e){return h(this,e)},diffDays(e){return(this.valueOf()-(e||0))/864e5},diffHours(e){return(this.valueOf()-(e||0))/36e5},diffMinutes(e){return(this.valueOf()-(e||0))/6e4},diffSeconds(e){return(this.valueOf()-(e||0))/1e3},diffMilliseconds(e){return this.valueOf()-(e||0)},addYears(e){var t=this[s];return new a(new Date(t).setFullYear(t.getFullYear()+e|0))},addMonths(e){var t=this[s];return new a(new Date(t).setMonth(t.getMonth()+e|0))},addDays(e){return new a(this[l]+864e5*(e||0))},addHours(e){return new a(this[l]+36e5*(e||0))},addMinutes(e){return new a(this[l]+6e4*(e||0))},addSeconds(e){return new a(this[l]+1e3*(e||0))},addMilliseconds(e){return new a(this[l]+(e||0))}},static:{compare:h,by$equals(e,t){return 0==h(e,t)},create(e=1,t=1,i=1,n=0,r=0,s=0,l=0){return new a(u(e,t,i,n,r,s,l))},$parse:d,parse:e=>{var t=d(e);if(null!=t)return t;throw new y("DateTime.parse",e)},getNow(){return new a(Date.now())}}}),a})();function ie(){}R.declareSystemPrimitiveType(ie,{id:"Void",alias:"void",static:{[Symbol.hasInstance]:()=>!1}});class L extends f{constructor(e,t={}){super(),F(this,"#name",e),F(this,{"#enum":t[P.enum]||S(),"#object":t[P.object]||S(),"#identity":t[P.identity]||S(),"#dialog":t[P.dialog]||S(),"#manager":t[P.manager]||S(),"#orm":t[P.orm]||S(),"#tables":S(),"#newIdentitys":S()})}get name(){return this["#name"]}get enum(){return this["#enum"]}get object(){return this["#object"]}get identity(){return this["#identity"]}get dialog(){return this["#dialog"]}get manager(){return this["#manager"]}get orm(){return this["#orm"]}get tables(){return this["#tables"]}get newidentitys(){return this["#newIdentitys"]}$sql(e){return u.$sql(this,e)}$tran(e){return u.$tran(this,e)}$exec(e){return u.$exec(this,e)}$remote(e){let{kind:t,NO:i,target:n,args:r,argTypes:s,return:l}=e;e=we.createToJSONContext(),e=E.ProjectServerUtil.sendServerPackage({"#":t,$KU:this["#name"],$NO:i.toString(),$TARGET:e.serialize(n,O),$PA:e.serializeArguments(r,s)});return null==l?e:e.then(e=>we.rebuild(e,l))}$0(){if(this["#inited"])return this["#inited"];var e,t,i,n,r=[];for(e of[this.object,this.identity,this.dialog])for(var[s,l]of M(e))l.$0&&(l=l.$0())instanceof Promise&&r.push(l);for([t,i]of M(this.newidentitys))"function"==typeof i.$0&&(n=i.$0())instanceof Promise&&r.push(n);return this["#inited"]=Promise.all(r).then(()=>this["#inited"]=!0)}getResource(e){return E.ProjectFilesUtil.getKuResource(this.name,e)}createManager(e){var t=this["#manager"][e];if(null!=t)return t.$new();throw new Ae(`${this.name}.${P.manager}.`+e)}createDialog(e,t){if(null==e||null==t)throw new y("by.object.ku.createDialog",T.Argument_Cannot_Be_Null);let i,n=(i="string"==typeof e?L.$getKuNewIdentity(e,this):e,Object.getPrototypeOf(i)),r;for(;null==r&&null!=n;){var s=n.constructor,l=R.getTypeName(s),s=R.getTypeKu(s);if(null!=l&&null!=s){s=s.name+`.dialog.${l}$`+t;try{r=R.getType(s)}catch(e){}}n=Object.getPrototypeOf(n)}if(null==r)throw new y("Ku.createDialog",T._format(T.Dialog_Type_Not_Found_Template,e,t));return r.$new(i,e=>e.$0())}static getKu(e){return L.$getKu(e)}}{const _i=new Map,Bi=new L(ye,ve);R.declareSystemType(L,{id:"Ku",alias:"ku",static:{$getSystemKu(){return Bi},$getKu(e){var t;return e instanceof L?e:e==ye?Bi:(null==(t=_i.get(e))&&(t=new L(e),_i.set(e,t)),t)},$fillKu(e,t){for(var[i,n]of M(t.enum)){n=R.declareBytEnumType(e,i,n);e["#enum"][i]=n}for(var[r,s]of M(t.orm)){s=R.declareBytOrmType(e,r,s);e["#orm"][r]=s}var l,a,o,u,h,d,c,m,g,p,f,$,y,v,b,x,w,S=[],T=[],E=[],C=[];for(l of[P.object,P.identity,P.dialog,P.manager])for([a,o]of M(t[l])){null==e[l][a]&&(e[l][a]=o.type);var I=e[l][a];o.id=`${e.name}.${l}.`+a,o.name=a,o.domain=l,o.ku=e,S.push([I,o])}for([u,h]of S)R.declareBytExtendableType(u,h);for([d,c]of M(t.tables)){var A=V.$$createTable(e,d,c.tableType,c.summary);if(e["#tables"][d]=A,E.push([A,c]),null!=c.fields)for(var[D,k]of M(c.fields)){var N=U.$$createTableField(e,A,D,k.type,k.summary),D=(A["#fieldMap"][D]=N,A["#fields"].push(N),C.push([N,k]),`$.${d}.`+D),k=O.$$createFieldInnerIdentity(e,D,k.identity);O.$setBindIdentity(N,k),O.$setBindTo(k,N),e["#newIdentitys"][D]=k}if(null!=c.rows)for(var _ of c.rows)A["#rows"].push(new H(A,A["#fields"],_))}for([m,g]of M(t.newidentitys)){var B=O.$$createNewIdentity(e,m,g.type);e["#newIdentitys"][m]=B,T.push([B,g])}for([p,f]of E)null!=f.identity&&($=L.$getKuNewIdentity(f.identity,e),O.$setBindIdentity(p,$)),null!=f.marks&&($=f.marks.primary)&&V.$$setTablePrimary(p,$),null!=f.sources&&V.$$setTableSources(p,f.sources),null!=f.flows&&V.$$setTableFlows(p,f.flows),null!=f.controls&&V.$$setTableControls(p,f.controls);for([y,v]of C)v.marks&&U.$$setFieldMarks(y,v.marks);for([b,x]of T)null!=x.to?(w=x.to,w=L.$getKuTable(w,e),O.$setBindTo(b,w)):null!=x.page&&O.$$setNewPageElements(b,x.page),null!=x.components&&O.$$setNewIdentityComponentInfo(b,x.components),null!=x.configs&&O.$$setNewIdentityConfigs(b,x.configs),null!=x.dialogs&&O.$$setNewIdentityDialogs(b,x.dialogs);return e},$initKu(e){if(e instanceof L)return e.$0()},$getKuNewIdentity(e,t){let i,n;e.includes(".")?[i,n]=e.split("."):(i=t,n=e);t=L.$getKu(i)["#newIdentitys"][n];if(null==t)throw new _e(i,n);return t},$getKuTable(e,t){let i,n;e.includes(".")?[i,n]=e.split("."):(i=t,n=e);t=L.$getKu(i)["#tables"][n];if(null==t)throw new Ne(kuName,n);return t},$getKuField(e,t){if(e.includes(".")){var[i,n,r]=e.split("."),s=L.$getKu(i)["#tables"][n].$getField(r);if(null==s)throw new ke(i,n,r);return s}return t.$getField(e)}}})}class V extends f{constructor(e,t){super(),F(this,"#name",t),F(this,"#ku",e),F(this,"#table#id",e.name+"."+t),F(this,{"#rows":[],"#fields":[],"#fieldMap":S()})}get name(){return this["#name"]}get summary(){return this["#summary"]}get tableType(){return this["#tableType"]}get kuName(){return this["#ku"]["#name"]}get rows(){return new n(this["#rows"])}get fields(){return new n(this["#fields"])}}{class Mi{constructor(e,t,i){if(F(this,"#name",t),F(this,"#table",e),F(this,"#mode",i.mode),F(this,"#actions",i.actions||[]),F(this,"#settings",i.settings||S()),null!=i.access){t=i.access;if("string"==typeof t)F(this,"#field",L.$getKuField(t,e));else if(null!=t.field)F(this,"#field",L.$getKuField(t.field,e)),null!=t.relation&&F(this,"#relationField",L.$getKuField(t.relation,e));else if(null!=t.orm){var{orm:i,name:e}=t,i=R.getType(i);F(this,"#field",U.$createOrmField(i,e))}else if(null!=t.func&&null!=t.arg)F(this,"#field",U.$createFunctionField(t.func,L.$getKuField(t.arg)));else{i=null==t.type?f:R.getType(t.type);let e=t.name||t.func||e;F(this,"#field",U.$createExpressionField(e,i))}F(this,"#type",this["#field"]["#type"])}else F(this,"#type",f)}get relationField(){return this["#relationField"]}get name(){return this["#name"]}get type(){return this["#type"]}get table(){return this["#table"]}get accessfield(){return this["#field"]}$checkCanEdit(e){return this["#actions"].includes(e)&&("user"==this["#mode"]||null==this["#mode"]||this["#settings"].isArray)}$checkCanCall(e){return this["#actions"].includes(e)&&["client","server"].includes(this["#mode"])}$call(){switch(this["#mode"]){case"client":var e=this["#settings"].value;return"function"==typeof e?e.call():e||null;case"server":{let t=this["#type"];return E.ProjectServerUtil.sendServerPackage({"#":"SOURCE",$SH:V.$getTransmitData(this["#table"]),$SO:this["#name"]}).then(e=>p(e)?we.rebuildList(e,t):we.rebuild(e,t))}}}$verify(e){return this["#field"]&&this["#field"].$verify?this["#field"].$verify(e):null}}class Oi{constructor(t,e,i){F(this,{"#table":t,"#name":e,"#sources":N(i,e=>t.$getSource(e))})}get name(){return this["#name"]}get sources(){return this["#sources"]}get accessfields(){return this["#sources"].map(e=>e.accessfield)}}R.declareSystemType(V,{name:"Table",instance:{getField(e){return this["#fieldMap"][e]||null},$getField(e){return this["#fieldMap"][e]||null},$getSource(e){return null!=this["#sourceMap"]?this["#sourceMap"][e]:null},$getFlow(e){return null!=this["#flowMap"]?this["#flowMap"][e]:null},$getControl(e){return null!=this["#ctrlMap"]?this["#ctrlMap"][e]:null}},static:{$$createTable(e,t,i,n){e=new V(e,t);return F(e,{"#tableType":i||"data","#summary":n||t}),e},$getTransmitData(e){return e["#ku"]["#name"]+"."+e["#name"]},$parseTransmitData(e){var[e,t]=e.split(".");return L.$getKuTable(t,e)},$$setTablePrimary(t,e){t["#primary"]=N(e,e=>t["#fieldMap"][e])},$getTablePrimaryFields(e){return null==e?null:e["#primary"]},$$setTableSources(i,e){F(i,"#sourceMap",_(e,(e,t)=>new Mi(i,t,e)))},$$setTableFlows(i,e){F(i,"#flowMap",_(e,(e,t)=>new Oi(i,t,e)))},$$setTableControls(i,e){F(i,"#ctrlMap",_(e,(e,t)=>new Oi(i,t,e)))},*$findSourceRelationAssignPairs(e,t,i,n,r=!0){if(null!=e&&null!=t&&n instanceof H){var s=t[i];if(null!=s&&s["#table"]==e){var l=s.accessfield;if(l["#table"]==e){s=l["#ref"];if(null!=s&&(yield[i,n.$getCellByField(s)],r)){let e=0;for(var a of t){var o=a.relationField;null!=o&&U.$equals(o,l)&&(yield[e,n.$getCellBySource(a)]),e++}}}}}}}})}class U extends f{constructor(e,t,i){super(),F(this,"#table",e),F(this,"#name",t),F(this,"#type",R.getType(i)),F(this,"field#id",e["#table#id"]+"."+t)}get name(){return this["#name"]}get summary(){return this["#summary"]}get table(){return this["#table"]}get refField(){return this["#ref"]||null}get refTable(){var e=this.refField;return null==e?null:e.table}get isChar(){return this["#type"]==r}get isByte(){return this["#type"]==J}get isShort(){return this["#type"]==G}get isInt(){return this["#type"]==X}get isLong(){return this["#type"]==l}get isFloat(){return this["#type"]==Q}get isDouble(){return this["#type"]==Z||this["#type"]==Number}get isDecimal(){return this["#type"]==c}get isString(){return this["#type"]===$||this["#type"]===String}get isBool(){return this["#type"]==Y||this["#type"]==Boolean}get isDatetime(){return this["#type"]==Se}get isEnum(){return null!=this["#type"]&&R.isEnumType(this["#type"])}$verify(e){return U.$verify(this,e)}verify(e){return this.$verify(e)}$internalEquals(e){return e instanceof U&&this["#table"]==e["#table"]&&this["#name"]==e["#name"]}}{const Pi=Symbol("field_id");class Fi{constructor(e,t,i){F(this,{"#name":e||"","#type":R.getType(t),[Pi]:i||`[${R.getTypeID(t)}]`+(e||"")})}get name(){return this["#name"]}get type(){return this["#type"]}$verify(){}$internalEquals(e){return null!=e&&e[Pi]==this[Pi]}}class Ri extends Fi{constructor(e,t,i){super(t,i||Te.$$getOrmFieldType(e,t)),F(this,"#orm",R.getType(e,Te))}$internalEquals(e){return e instanceof Ri&&e["#orm"]!=this["#orm"]&&e["#name"]==this["#name"]}}class Li extends Fi{constructor(e,t){var i="count"==e?X:null==t?f:t["#type"],n=`${e.toUpperCase()}(${t[Pi]})`;super(n,i,n),F(this,"#func",e),F(this,"#arg",t)}$internalEquals(e){return e instanceof Li&&e["#func"]==this["#func"]&&e["#arg"]==this["#arg"]}}function ne(e,t,i){return new je(!1,T._format(T.Verify_Field_Result_Template,U.$getTransmitData(e),t,i))}R.declareSystemType(U,{name:"Field",static:{$$createTableField(e,t,i,n,r){n=new U(t,i,n);return F(n,{[Pi]:`${e.name}.${t.name}.`+i,"#summary":r||i}),n},$$setFieldMarks(t,i){if(null!=i){var n=i.ref||i.reference;n&&F(t,"#ref",L.$getKuField(n,t["#table"]));let e;i.verify&&(e=i.verify),null!=(e=i.notNull?B(e,{notNull:!0}):e)&&F(t,"#verify",e),null!=i.default&&F(t,"#default",i.default)}},$createOrmField(e,t,i){return new Ri(e,t,i)},$createExpressionField(e,t){return new Fi(e,t)},$createFunctionField(e,t){return new Li(e,t)},$getFieldDisplayString(e){return e?e[Pi]:""},$getTransmitData(e){if(null==e)throw new Fe("field",T.Server_Cannot_Send_Null_Field);return e[Pi]},$parseTransmitData(e,t){if(null==e)throw new Fe("field",T.Server_Cannot_Send_Null_Field);var i=e.indexOf("(");if(0<=i)return n=e.indexOf(")"),r=e.slice(0,i).toLowerCase(),i=e.slice(i+1,n),n=L.$getKuField(i),new Li(r,n);var n,i=e.indexOf("[");if(0<=i)return r=e.indexOf("]"),n=e.slice(i+1,r),i=R.getType(n),n=e.slice(r+1),null!=t?new Ri(t,n,i):new Fi(n,i);var r=L.$getKuField(e);if(null==r)throw new Fe("Field",T._format(T.Server_Returned_Field_Invalid_Template,e));return r},$verify(e,t){if(null!=e){var i=e["#verify"];if(i){var n=e["#type"];if(n){var r=R.getTypeID(n);if(null==t||""===t)return i.notNull?ne(e,"notNull",T._format(T.Verify_Message_NotNull_Template,r)):null;if(n===$||n===String){if(i.minLength=i.minLength||i.min,i.maxLength=i.maxLength||i.max,null!=i.minLength&&t.length<i.minLength)return ne(e,"min",T._format(T.Verify_Message_MinLength_Template,r,i.minLength));if(null!=i.maxLength&&t.length>i.maxLength)return ne(e,"max",T._format(T.Verify_Message_MaxLength_Template,r,i.maxLength));if(i.pattern&&!new RegExp(i.pattern).test(t))return ne(e,"pattern",T._format(T.Verify_Message_Pattern_Template,r,i.pattern,t))}else{if(null!=i.min&&h.primitiveCompare(n,t,i.min)<0)return ne(e,"min",T._format(T.Verify_Message_Min_Template,r,i.min));if(null!=i.max&&0<h.primitiveCompare(n,t,i.max))return ne(e,"max",T._format(T.Verify_Message_Max_Template,r,i.max));if(n==c&&null!=i.digit&&c.getDigits(t)>i.digit)return ne(e,"digit",T._format(T.Verify_Message_Digits_Template,r,i.digit,t))}return null}}}},$getDefault(e){var t;return null==e?null:(t=e["#type"],void 0===(e=e["#default"])?R.getTypeDefault(t):"function"==typeof e?e():e)},$equals(e,t){return e==t||null!=e&&null!=t&&"function"==typeof e.$internalEquals&&e.$internalEquals(t)},$relationEquals(e,t){return null!=e&&null!=t&&(e==t||e["#ref"]==t||e==t["#ref"])}}})}class H extends f{constructor(e,t,i){super(),F(this,{"#fields":[],"#cells":[]}),null!=e&&F(this,"#table",e),null==t&&(t=null!=e?e["#fields"]:[]),null==i&&(i=[]);for(let e=0;e<t.length;e++){var n=t[e],r=(this["#fields"].push(n),i[e]);r instanceof o?(this["#cells"].push(r),null==r["#row"]&&(r["#row"]=this)):this["#cells"].push(new o(this,n,r))}}get["#identity"](){var e;return null!=this["#table"]?(F(this,"#identity",e=this["#table"]["#identity"]),e):null}$bindIdentity(e){if(null!=(e=e instanceof O?e:O.$getBindIdentity(e))&&null==this["#identity"]){F(this,"#identity",e);var t,e=O.$getBindTo(e);if(!(e instanceof V))throw new m(T.Row_Must_Bind_Table_Identity);F(this,"#table",e);for(t of e["#fields"])this["#fields"].push(t),this["#cells"].push(new o(this,t))}return this}$$i$access$cell(e){var t=this["#identity"];if(null==t)throw new m(T.Row_Cannot_ComponentAccess_Missing_Identity);t=null==t?null:t.$access(e),t=null==t?null:t["#to"],t=this.$getCellByField(t);if(null==t)throw new m(T._format(T.Row_Component_Not_Found_Template,e,this));return t}i$access(e){return this.$$i$access$cell(e).value}i$assign(e,t,i){e=this.$$i$access$cell(e),i=null==i?t:i(e.value,t);return e.value=i}get cells(){return new n(this["#cells"])}get table(){return this["#table"]}toString(){return H.$toString(this)}by$toString(){return H.$toString(this)}clone(){return H.$clone(this)}by$equals(e){return null!=e&&H.$equals(this,e)}$verify(){for(let e=0;e<this["#fields"].length;e++){var t=this["#fields"][e],i=this["#cells"][e];if(null!=i){t=U.$verify(t,i.value);if(null!=t&&!t.isOk)return t}}return new je(!0)}verify(){return this.$verify()}["~="](e){return H["~="](this,e)}["~=="](e){return H["~=="](this,e)}$getCellByField(e){return this["#cells"][this["#fields"].indexOf(e)]||null}$getCellBySource(t){return this["#cells"][q.$arrayFindIndex(this["#fields"],e=>U.$equals(e,t.accessfield))]}$getIndexBySource(t){return q.$arrayFindIndex(this["#fields"],e=>U.$equals(e,t.accessfield))}}function re(e){var t;return e instanceof H?{row:e,table:e["#table"],cells:e["#cells"]}:!p(e)||([e,t]=e,null==e)?null:{row:e,table:e["#table"],cells:[e.$$i$access$cell(t)]}}function se(e,t,i=()=>!0){var n,r=new Set;for(n of t){var s=n["#field"];if(null!=s&&!r.has(s)&&null!=s["#table"]){r.add(s);for(var l of e)if(U.$relationEquals(l["#field"],s)&&i(l,n))return}}}R.declareSystemType(H,{id:"Row",transmit:{toJSON(e,t){var i,n=t.serialize(O.$getBindIdentity(e),O),r=[],s=[],l=e["#fields"],a=e["#cells"];let o=0;for(i of l){var u=U.$getTransmitData(i),h=t.serialize(a[o].value,i["#type"]);r.push(u),s.push(h),o++}return{"#":"ROW",$FIELDS:r,$VALUES:s,$IDENTITY:n}},fromJSON(e,t){var i=e.$FIELDS||[],n=e.$VALUES||[],e=e.$IDENTITY;if(null==e)throw new Fe("IDENTITY",T.Server_Returned_Row_Missing_Identity);t=t.rebuild(e,O),e=O.$getBindTo(t),t=i.map(e=>U.$parseTransmitData(e));return new H(e,t,n)}},static:{$equals(e,t){if(e!=t){if(null==e||null==t||e["#table"]!==t["#table"])return!1;var i=e["#cells"],n=t["#cells"];if(null==i||null==n||i.length!=n.length)return!1;for(let e=0;e<i.length;e++)if(!o.$equals(i[e],n[e]))return!1}return!0},$toString(e){let t=e["#fields"],i=e["#cells"];return t.map((e,t)=>U.$getFieldDisplayString(e)+" : "+i[t].value).join("\t")},$clone(e){return new H(e["#table"],e["#fields"],e["#cells"].map(e=>e.value))},$copyFieldAndCells(e,t){if(null!=e&&null!=t)for(var i of e["#cells"]){var n=i["#field"],n=t.$getCellByField(n);null!=n&&(i.value=n.value)}},"~="(e,t){var i=re(e),n=re(t);if(null!=i&&null!=n){if(i.table!=n.table)return se(i.cells,n.cells,(e,t)=>{e.value=t.value});var r,s,l=new Map;for(r of n.cells){var a=r["#field"];a["#table"]!=n.table||l.has(a)||l.set(a,r.value)}for(s of i.cells){var o=s["#field"];o["#table"]==i.table&&l.has(o)&&(o=l.get(o),s.value=o)}l.clear()}},"~=="(e,t){e=re(e),t=re(t);if(null==e||null==t)return!1;if(e.table==t.table){var i=V.$getTablePrimaryFields(e.table);if(0==i.length)return!1;var n,r=e.row,s=t.row;for(n of i)if(!o.$equals(r.$getCellByField(n),s.$getCellByField(n)))return!1;return!0}let l=!1;return se(e.cells,t.cells,(e,t)=>{if(!h.primitiveEquals(e.value,t.value))return l=!0}),!l}}});class o extends f{constructor(e,t,i){super(),null!=e&&F(this,"#row",e),F(this,"#field",t),F(this,"#identity",O.$getBindIdentity(t)),i instanceof Promise?(this.value=null,i.then(e=>this.value=e)):i instanceof o?this.value=i.value:this.value=i}get["#syncEvent"](){var e=I.$create("cell-sync");return F(this,"#syncEvent",e),e}get["#type"](){return this["#field"]["#type"]}get field(){return this["#field"]instanceof U?this["#field"]:null}get row(){return this["#row"]}get value(){return this["#value"]}set value(e){var t=this["#type"];if(null==e)this["#value"]=R.getTypeDefault(t);else{if(e===this["#value"])return;this["#value"]=e instanceof t?e:h.primitiveCast(t,e)}w(this,"#syncEvent")&&I.$invoke(this["#syncEvent"],[this,this["#value"]])}}R.declareSystemType(o,{name:"Cell",static:{$equals(e,t){return null!=e&&null!=t&&U.$equals(e["#field"],t["#field"])&&h.primitiveEquals(e.value,t.value)},$listenCellSync(e,t){e&&I.$add(e["#syncEvent"],t)},$removeCellSync(e,t){e&&I.$remove(e["#syncEvent"],t)},$fromOrm(e,t,i){t=new o(null,t,i);return t["#orm"]=e,t}}});class Te extends f{constructor(e,t,i,n,r){super(),F(this,{"#tables":e,"#fields":t,"#cells":N(t,(e,t)=>o.$fromOrm(this,e,i[t])),"#tableMapping":n,"#fieldMapping":r,"#rowMapping":S()})}get cells(){return new n(this["#cells"])}toString(){return Te.$toString(this)}by$toString(){return Te.$toString(this)}clone(){return new this.constructor(this["#tables"],this["#fields"],this["#cells"].map(e=>e.value),this["#tableMapping"],this["#fieldMapping"])}by$equals(e){return Te.$equals(this,e)}}function u(t,i){if(null==new.target)return new u(t,i);if((i=null==i&&null!=t?t:i)instanceof u)return i;F(this,{"#sql":i["#sql"],"#number":i.number,"#args":i.args,"#argTypes":i.argTypes,"#from":[],"#tables":[],"#tableAliasMapping":S()}),F(this,"isSelect","select"==i["#sql"]),null!=i.orm&&F(this,"#orm",R.declareAnnoymousOrmType(i.orm));var n,r,t=i.from;if(this.isSelect)for(var[s,l]of M(t)){let e;if(l instanceof O||l instanceof V?(n=l instanceof O?O.$getBindTo(l):l)instanceof V&&(this["#from"].push(n),this["#tables"].push(n),this["#tableAliasMapping"][s]=n,e=!0):(l instanceof u||l["#sql"])&&(r=(n=new u(l)).mainTable,this["#from"].push(n),this["#tables"].push(r),this["#tableAliasMapping"][s]=r,e=!0),!e)throw new y(`sql from error, type:${sqlItem["#sql"]}, raw:`+l)}else if("row"==this["#sql"]){var i=null==i.args?null:i.args[0];let e;i instanceof H?e=i["#table"]:null!=i&&i[Symbol.iterator]&&null!=(i=k(i))&&0<i.length&&null!=i[0]&&(e=i[0]["#table"]),null!=e&&this["#tables"].push(e)}else{let e;if(t instanceof V?e=t:t instanceof O&&(i=O.$getBindTo(t))instanceof V&&(e=i),null==e)throw new m(T.Sql_From_Not_Valid);this["#from"].push(e),this["#tables"].push(e)}}R.declareSystemType(Te,{name:"Orm",alias:"orm",transmit:{toJSON(e,t){if(!(e instanceof Te))return null;var i=Object.getPrototypeOf(e).constructor;if(R.isAnnoymousType(i))throw new Fe("Orm",T.Server_Cannot_Send_Annoymous_Orm);var[i,,n]=R.getTypeID(i).split("."),[n,r]=n.split("$");return{"#":"ORM",$TYPE:i+`.${n}.`+r,$FIELDS:e["#fields"].map(e=>U.$getTransmitData(e)),$VALUES:e["#cells"].map(e=>t.serialize(e.value,e["#type"])),$IDENTITYS:e["#tables"].map(e=>t.serialize(O.$getBindIdentity(e),O)),$FIELDSMAP:e["#fieldMapping"],$TABLESMAP:e["#tableMapping"]}},fromJSON(e,t){var i,n,[r,s,l]=e.$TYPE.split("."),a=R.getType(`${r}.${P.orm}.${s}$`+l),o=[],u=[],r=e.$TABLESMAP,s=e.$FIELDSMAP;for(i of e.$IDENTITYS){var h=t.rebuild(i,O),h=O.$getBindTo(h);if(!(h instanceof V))throw new Fe("orm",T.Server_Returned_Orm_Identity_Not_Table);o.push(h)}for(n of e.$FIELDS)u.push(U.$parseTransmitData(n,a));return new a(o,u,e.$VALUES,r,s)}},static:{$toString(e){let t=e["#fields"],i=e["#cells"];return t.map((e,t)=>U.$getFieldDisplayString(e)+" : "+i[t].value).join("\t")},$equals(e,t){if(e!=t){if(null==e||null==t)return!1;var i=e["#cells"],n=t["#cells"];if(null==i||null==n||i.length!=n.length)return!1;for(let e=0;e<i.length;e++)if(!o.$equals(i[e],n[e]))return!1}return!0},$buildOrmInstance(e,t,i,n,r,s){return new e(t,i,n,r,s)},$$getOrmTableNames(e){return null==e?[]:e["#tableNames"]},$$getOrmFieldType(e,t){return null!=e&&null!=(e=e["#fieldNameMapping"])&&w(e,t)?e[t]:f},$$fillOrmTypeMembers(f,$,y){$=$||[],y=y||S(),F(f,{"#tableNames":$,"#fieldNameMapping":y});for(let o=0;o<$.length;o++){let a=$[o];j(f.prototype,a,{get(){let e=this["#rowMapping"];if(null!=(e=null==e?this["#rowMapping"]=Object.create(null):e)[a])return e[a];var t,i=this["#tables"],n=this["#tableMapping"],i=i[o],r=[],s=[];for(t of n[a]||[]){r.push(this["#fields"][t]);var l=this["#cells"][t];s.push(l)}n=new H(i,r,s);return e[a]=n}})}for(let[i,e]of M(y))i.includes("*")||j(f.prototype,i,{get(){var e=this["#fieldMapping"][i];return this["#cells"][e].value},set(e){var t=this["#fieldMapping"][i];this["#cells"][t].value=e}});F(f,"$create",function(...t){var e,i,n=[],r=[],s=[],l=Object.create(null),a=Object.create(null);for(let e=0;e<$.length;e++){var o=$[e],u=t[e];if(null==u)throw new Me;var h,d=u["#table"],c=(n.push(d),[]),o=(l[o]=c,d["#fields"]);for(h of o){c.push(r.length),r.push(h);var m=u.$getCellByField(h);let e;e=null!=m?m.value:null!=h["#type"]?R.getTypeDefault(h["#type"]):null,s.push(e)}}for([e,i]of M(y)){var g=R.getType(i),p=R.getTypeDefault(g),g=U.$createOrmField(f,e,g);a[e]=r.length,r.push(g),s.push(p)}return Te.$buildOrmInstance(f,n,r,s,l,a)})}}}),j(u.prototype,"mainTable",{get(){return this["#tables"][0]}}),R.declareSystemType(u,{id:"Sql",transmit:{toJSON(e,t){var i,n=[];for(i of(e=e instanceof u?e:new u(null,e))["#from"])i instanceof u?n.push({$SQL:t.serialize(i,u)}):n.push({$TABLE:V.$getTransmitData(i)});return{$NO:e["#number"].toString(),$FR:n,$PA:t.serializeArguments(e["#args"],e["#argTypes"])}}},static:{$sql(e,t){let i=new u(e,t);t=we.serialize(i,u);return E.ProjectServerUtil.sendServerPackage({"#":"SQL",$KU:e["#name"],$VALUE:t}).then(e=>u.$rebuildSqlResult(e,i))},$tran(e,t){var{NO:t,args:i,argTypes:n,sqls:r}=t,s=we.createToJSONContext(),i=s.serializeArguments(i,n),n=s.serializeList(r,u);return E.ProjectServerUtil.sendServerPackage({"#":"TRAN",$KU:e["#name"],$NO:t.toString(),$VA:i,$PS:n})},$exec(e,t){var{NO:t,sqls:i,select:n}=t;let r=S();var s,l,a,o=[];for(s of i)o.push(new u(e,s));for([l,a]of M(n))r[l]=o[a];return E.ProjectServerUtil.sendServerPackage({"#":"EXEC",$KU:e["#name"],$NO:t.toString(),$PS:we.serializeList(o,u)}).then(e=>{u.$rebuildExecResult(e,r)})},$rebuildSqlResult(e,r){if(!r.isSelect)return 0|e;var s,t=e.$FIELDS,l=e.$VALUES;let a=r["#orm"],o=t.map(e=>U.$parseTransmitData(e,a));if(null==a)return{rows:l.map(e=>new H(r.mainTable,o,e))};{let t=e.$FIELDSMAP,i=e.$TABLESMAP,n=[];for(s of Te.$$getOrmTableNames(a))n.push(r["#tableAliasMapping"][s]);return{rows:l.map(e=>Te.$buildOrmInstance(a,n,o,e,i,t))}}},$rebuildExecResult(e,t){var i,n,r={};for([i,n]of M(t))F(r,i,u.$rebuildSqlResult(e[i],n));return r}}});class m extends Error{constructor(e,t){null==t&&"string"!=typeof e&&(e instanceof Error&&(e=(t=e).message),e=null!=typeof DOMException&&item instanceof DOMException?(t=e).message:$(e)),super(e,{cause:t})}get name(){return"Exception"}get innerException(){return m.$convert(this.cause)}}R.declareSystemType(m,{id:"Exception",instance:{$0(){},toString(){return this.by$toString()},by$toString(){return this.message},by$equals(e){return null!=e&&e.valueOf()==this},$init(e,t){return f.by$init(this,e,t)},$access(e){return f.by$access(this,e)},$assign(e,t,i){return f.by$assign(this,e,t,i)},i$access(e){var t=this.$identity();return null==t?null:t.$access(e)},i$assign(e,t,i){var n=this.$identity();return null==n?null:n.$assign(e,t,i)},$identity(){return this["#identity"]},$bindIdentity(e){F(this,"#identity",e)}},static:{$check(e){return"string"==typeof e||e instanceof Error||null!=typeof DOMException&&e instanceof DOMException},$convert(e){return null==e?null:"string"==typeof e?new m(e):e instanceof Error||null!=typeof DOMException&&e instanceof DOMException?e instanceof m?e:new m(e.message,e.cause):new m($(e))}}});class Ee extends m{constructor(e){super(T._format(T.Cast_Failed_Template,R.getTypeID(e)))}get name(){return"CastException"}}R.declareSystemType(Ee,{name:"CastException"});class Ce extends m{constructor(e,t){super(T._format(T.Index_Out_Of_Range_Template,e))}get name(){return"IndexOutOfRangeException"}}R.declareSystemType(Ce,{name:"IndexOutOfRangeException"});class Ie extends m{constructor(e){super(T._format(T.Key_Not_Found_Template,e))}get name(){return"KeyNotFoundException"}}R.declareSystemType(Ie,{name:"KeyNotFoundException"});class Ae extends m{constructor(e){super(T._format(T.Ku_Type_Not_Found_Template,e))}get name(){return"TypeNotFoundException"}}R.declareSystemType(Ae,{name:"TypeNotFoundException"});class De extends m{constructor(e){super(T._format(T.Ku_Not_Found_Template,e))}get name(){return"KuNotFoundException"}}R.declareSystemType(De,{name:"KuNotFoundException"});class ke extends m{constructor(e,t,i){super(T._format(T.Ku_TableField_Not_Found_Template,e+`.${t}.`+i))}get name(){return"KuTableFieldNotFoundException"}}R.declareSystemType(ke,{name:"KuTableFieldNotFoundException"});class Ne extends m{constructor(e,t){super(T._format(T.Ku_Table_Not_Found_Template,e+"."+t))}get name(){return"KuTableNotFoundException"}}R.declareSystemType(Ne,{name:"KuTableNotFoundException"});class _e extends m{constructor(e,t){super(T._format(T.Ku_NewIdentity_Not_Found_Template,e+"."+t))}get name(){return"KuNewIdentityNotFoundException"}}R.declareSystemType(_e,{name:"KuNewIdentityNotFoundException"});class y extends m{constructor(e,t){super(T._format(T.Method_Call_Exception_Template,e,t))}get name(){return"MethodCallException"}}R.declareSystemType(y,{name:"MethodCallException"});class Be extends m{constructor(e,t){super(T._format(T.Net_Connection_Error_Template,e,t))}get name(){return"NetConnectException"}}R.declareSystemType(Be,{name:"NetConnectException"});class Me extends m{constructor(){super(T.Null_Reference_Error)}get name(){return"NullReferenceException"}}R.declareSystemType(Me,{name:"NullReferenceException",static:{$check(e){if(e instanceof Me)return!0;let t;return e instanceof Error&&(t=e.message),null!=(t="string"==typeof e?e:t)&&(t.includes("Cannot read properties of")||t.includes("has no properties"))},$convert(e){return Me.$check(e)?new Me:null}}});class Oe extends m{constructor(){super(T.Numeric_Overflow_Error)}get name(){return"NumericOverflowException"}}R.declareSystemType(Oe,{name:"NumericOverflowException"});class Pe extends m{constructor(e,t){super(T._format(T.Server_Exec_Error_Template,e,t))}get name(){return"ServerExecutionException"}}R.declareSystemType(Pe,{name:"ServerExecutionException"});class Fe extends m{constructor(e,t){super(T._format(T.Server_Format_Error_Template,e,t))}get name(){return"ServerFormatException"}}R.declareSystemType(Fe,{name:"ServerFormatException"});class Re extends m{constructor(){super(T.Stack_Overflow_Error)}get name(){return"StackOverflowException"}}R.declareSystemType(Re,{name:"StackOverflowException",static:{$check(e){return e instanceof Re||!!(e instanceof TypeError&&e.message.includes("Maximum call stack size exceeded"))||!!("undefined"!=typeof InternalError&&e instanceof InternalError&&e.message.includes("too much recursion"))},$convert(e){return Re.$check(e)?new Re:null}}});const Le=(()=>{const n=Symbol("buffer");class e extends f{constructor(e){super(),this[n]=null!=e&&e[Symbol.iterator]?Array.from(e):[]}get count(){return this[n].length}add(e){this[n].push(e)}addRange(e){q.$arrayAddItems(this[n],e)}insert(e,t){this[n].splice(0|e,0,t)}clear(){this[n].splice(0)}contains(e){return h.primitiveContains(this[n],e)}indexOf(e){return h.primitiveIndexOf(this[n],e)}lastIndexOf(e){return h.primitiveLastIndexOf(this[n],e)}remove(e){e=h.primitiveIndexOf(this[n],e);0<=e&&this[n].splice(e,1)}removeAt(e){null!=e&&0<=e&&this[n].splice(e,1)}toArray(){return k(this[n])}*[Symbol.iterator](){for(var e of this[n])yield e}}return R.declareSystemCollectionType(e,{name:"List",collection:{transmit:"LIST",checker:(e,t)=>0<=t&&t<e[n].length,getter:(e,t)=>e[n][t],setter:(e,t,i)=>e[n][t]=i}}),e})(),n=(()=>{const i=Symbol("buffer");class e extends f{constructor(e){super(),this[i]=null==e?[]:e instanceof Array?e:e[Symbol.iterator]?k(e):[]}get count(){return this[i].length}*[Symbol.iterator](){for(var e of this[i])yield e}toArray(){return k(this[i])}toList(){return new Le(k(this[i]))}indexOf(e){return h.primitiveIndexOf(this[i],e)}lastIndexOf(e){return h.primitiveLastIndexOf(this[i],e)}contains(e){return h.primitiveContains(this[i],e)}}return R.declareSystemCollectionType(e,{name:"ReadOnlyList",collection:{transmit:"READONLYLIST",checker:(e,t)=>0<=t&&t<e[i].length,getter:(e,t)=>e[i][t]}}),e})();{const Vi=Symbol("set"),Ui=Symbol("map");class Hi extends f{constructor(e){if(super(),this[Vi]=new Set,this[Ui]=new Map,null!=e&&"function"==typeof e[Symbol.iterator])for(var t of e)this.add(t)}add(e){var t;return h.isPrimitiveWrapItem(e)?(t=e.valueOf(),!this[Vi].has(t)&&(this[Vi].add(t),this[Ui].set(t,e),!0)):!this[Vi].has(e)&&(this[Vi].add(e),!0)}clear(){this[Vi].clear(),this[Ui].clear()}contains(e){e=h.isPrimitiveWrapItem(e)?e.valueOf():e;return this[Vi].has(e)}remove(e){e=h.isPrimitiveWrapItem(e)?e.valueOf():e;return this[Ui].delete(e),this[Vi].delete(e)}toArray(){return Array.from(this)}*[Symbol.iterator](){for(var e of this[Vi])this[Ui].has(e)?yield this[Ui].get(e):yield e}}R.declareSystemCollectionType(Hi,{name:"HashSet"})}var le,ae,e=(()=>{const s=Symbol("buffer"),l=Symbol("length"),a=Symbol("header");return class extends f{constructor(e){if(super(),this[s]=new Array(16),this[l]=0,this[a]=0,null!=e&&e[Symbol.iterator])for(var t of e)this.enqueue(t)}get count(){return this[l]}enqueue(e){var t=this[s],i=this[a],n=this[l];if(t[(i+n++)%t.length]=e,n==t.length){t.length*=2;for(let e=0;e<i;e++)t[e+n]=t[e],t[e]=void 0}this[l]=n}dequeue(){if(0==this[l])throw new y("by.object.Queue.dequeue",T.Queue_Empty);var e=this[a],t=this[s],i=t[e];return t[e++]=void 0,--this[l],this[a]=e%t.length,i}clear(){this[s].fill(void 0),this[a]=this[l]=0}peek(){if(0==this[l])throw new y("by.object.Queue.dequeue",T.Queue_Empty);var e=this[s][this[a]];return null==e?null:e}contains(e){return h.primitiveContains(this[s],e)}toArray(){return k(this)}*[Symbol.iterator](){var t=this[s],i=t.length,n=this[a],r=this[l];for(let e=0;e<r;e++)yield t[(n+e)%i]}}})(),e=(R.declareSystemCollectionType(e,{name:"Queue"}),(()=>{const i=Symbol("buf");return class extends f{constructor(e){super(),this[i]=e?k(e):[]}get count(){return this[i].length}clear(){this[i].splice(0)}contains(e){return h.primitiveContains(this[i],e)}push(e){this[i].push(e)}pop(){if(0==this[i].length)throw new y("by.object.Stack.pop",T.Stack_Empty);var e=this[i].pop();return null==e?null:e}peek(){if(0==this[i].length)throw new y("by.object.Stack.pop",T.Stack_Empty);var e=this[i][this[i].length-1];return null==e?null:e}toArray(){return k(this)}*[Symbol.iterator](){var t=this[i];for(let e=t.length-1;0<=e;e--)yield t[e]}}})());R.declareSystemCollectionType(e,{name:"Stack"});{const x=Symbol("buffer"),ji=Symbol("length");function oe(e,t){t=new Uint16Array(t);t.set(e[x]),e[x]=t}function ue(t,e,i=null){let n=t[ji],r=e.length;var s=(n=null!=i&&(i=i<0?0:i)>n?i:n)+r;if(s>t[x].length){let e=2*t[x].length;for(;e<=s;)e*=2;oe(t,e)}null==i?t[x].set(e,n):(t[x].copyWithin(i+r,i,n),t[x].set(e,i)),t[ji]=s}function he(t){var i=[];for(let e=0;e<t.length;e++)i.push(t.charCodeAt(e));return i}function de(e){return"string"==typeof e?e.charCodeAt(0):"number"!=typeof e&&e instanceof r?e.valueOf():65535&e}function ce(e){var t,i=[];for(t of e)i.push(de(t));return i}function me(t){if("function"==typeof TextDecoder)return new TextDecoder("utf-16").decode(t);var i=t.length;if(i<65536)return String.fromCharCode.apply(null,t);var n=[];for(let e=0;e<i;e+=65536)n.push(String.fromCharCode.apply(null,t.slice(e,e+65536)));return n.join("")}class zi extends f{constructor(e){super();let t,i;null==e?t=16:"string"==typeof e?(t=2*e.length,i=e):"number"==typeof e&&(t=0|e),null==t&&(t=16),this[ji]=0,this[x]=new Uint16Array(t),null!=i&&ue(this,he(i))}get length(){return this[ji]}set length(e){(e|=0)>=this[x].length&&oe(this,e),this[ji]=e}append(t,i,n){if(null!=t){let e;ue(this,e="string"==typeof t?he(t=null!=i?t.slice(i,i+n|0):t):"boolean"==typeof t?he(t?"True":"False"):t[Symbol.iterator]?ce(t=t instanceof Array&&null!=i?t.slice(i,i+n|0):t):he($(t)))}return this}insert(t,i){if(null!=i){let e;ue(this,e="string"==typeof i?he(i):i[Symbol.iterator]?ce(i):he($(i)),t)}return this}charAt(e){return new r(this[x][e])}setCharAt(e,t){return this[x][e]=de(t),this[ji]<e&&(this[ji]=e),t}clear(){this[ji]=0,this[x].fill(0)}remove(e,t){return t|=0,0<=(e|=0)&&e<=t&&t<=this[ji]&&(this[x].copyWithin(e,t),this[ji]=this[ji]-(t-e)),this}toCharArray(){return Array.from(this)}toString(){return me(this[x].slice(0,this[ji]))}by$toString(){return this.toString()}subString(e,t){return me(this[x].slice(e,t))}*[Symbol.iterator](){for(let e=0;e<this[ji];e++)yield new r(this[x][e])}}R.declareSystemCollectionType(zi,{name:"StringBuilder",collection:{checker:(e,t)=>0<=t&&t<e[ji],getter:(e,t)=>new r(e[x][t]),setter:(e,t,i)=>(e[x][t]=de(i),i)}})}class Ve extends f{constructor(e,t){super(),F(this,"#key",e),F(this,"#value",t)}get key(){return this["#key"]}get value(){return this["#value"]}}R.declareSystemType(Ve,{name:"KeyValue"});const Ue=(()=>{const a=Symbol("map"),o=Symbol("primitiveMap");function r(e,t,i){var n;return h.isPrimitiveWrapItem(t)?(n=t.valueOf(),e[a].set(n,i),e[o].set(n,t)):e[a].set(t,i),i}class d extends f{constructor(e){var t,i;if(super(),this[a]=new Map,this[o]=new Map,null!=e)for([t,i]of d.$toEntries(e))r(this,t,i)}get count(){return this[a].size}get keys(){var e,t=[],i=this[o];for(e of this[a].keys())t.push(i.has(e)?i.get(e):e);return new n(t)}get values(){return new n(this[a].values())}add(e,t){return r(this,e,t)}clear(){this[a].clear(),this[o].clear()}containsKey(e){return h.isPrimitiveWrapItem(e)&&(e=e.valueOf()),this[a].has(e)}containsValue(e){return h.primitiveContains(k(this[a].values()),e)}remove(e){return h.isPrimitiveWrapItem(e)&&(e=e.valueOf()),this[o].delete(e),this[a].delete(e)}*[Symbol.iterator](){var e,t,i=this[o];for([e,t]of this[a].entries()){var n=i.has(e)?i.get(e):e;yield new Ve(n,t)}}}return R.declareSystemCollectionType(d,{name:"Dictionary",collection:{transmit:{toJSON(e,t,i){var n=null==i?f:i[0],r=null==i?f:i[1];if(null==e)return null;var s,l,a=[],o=[];for([s,l]of d.$toEntries(e))a.push(t.serialize(s,n)),o.push(t.serialize(l,r));return{"#":"DICTIONARY",$KEYS:a,$VALUES:o}},fromJSON(e,t,i){var n=null==i?f:i[0],r=null==i?f:i[1],s=[],l=e.$KEYS,a=e.$VALUES;for(let e=0;e<l.length;e++){var o=t.rebuild(l[e],n),u=t.rebuild(a[e],r);s.push([o,u])}return d.$fromEntries(s)},toExternal(e,t,i){var n,r,s=null==i?null:i[0],l=null==i?null:i[1],a=new Map;for([n,r]of d.$toEntries(e)){var o=t.serialize(n,s),u=t.serialize(r,l);a.set(o,u)}return a},fromExternal(e,t,i){var n=null==i?null:i[0],r=null==i?null:i[1];let s=[];e instanceof Map?s=e.entries():"object"==typeof e&&(s=M(e));var l,a,o=[];for([l,a]of s){var u=t.rebuild(l,n),h=t.rebuild(a,r);o.push([u,h])}return d.$fromEntries(o)}},checker(e,t){return!0},getter(e,t){if(h.isPrimitiveWrapItem(t)&&(t=t.valueOf()),e[a].has(t))return e[a].get(t);throw new Ie(t)},setter(e,t,i){return r(e,t,i)}},static:{$isMapable(e){return null!=e&&(e instanceof Map||e instanceof d||Object.getPrototypeOf(e)==Object.prototype||null==Object.getPrototypeOf(e))},$toEntries(e){if(!e)return[];if(e instanceof d){var t,i,n=[],r=e[a],s=e[o];for([t,i]of r.entries()){var l=s.has(t)?s.get(t):t;n.push([l,i])}return n}return e instanceof Map?Array.from(e.entries()):M(e)},$fromEntries(e){var t,i,n=new d;for([t,i]of e)r(n,t,i);return n}}}),d})();function ge(){}R.declareSystemType(ge,{name:"Math",extend:Math,static:{DOUBLE_PI:2*Math.PI,DEGREE_CIRCLE:360,abs(e){return"number"==typeof e?Math.abs(e):e instanceof r?Math.abs(e.valueOf()):e instanceof l?l.abs(e):e instanceof c?c.abs(e):Math.abs(0|e.valueOf())},addExact(e,t){if("number"!=typeof e||"number"!=typeof t)return l.add(l(e),l(t),!0);e=Number(e)+Number(t);if((0|e)!=e)throw new Oe("addExact overflow");return e},bigMul:(e,t)=>l.multi(l(e),l(t)),ceiling(e){return"number"==typeof e?Math.ceil(e):e instanceof c?c.ceil(e):0},floor(e){return"number"==typeof e?Math.floor(e):e instanceof c?c.floor(e):0},truncate(e){return"number"==typeof e?Math.trunc(e):e instanceof c?c.truncate(e):0},round(e,t){var i;return"number"==typeof e?null==t||0==t?(i=Math.round(e),e<0&&e%1==-.5&&i%2==-1?i-1:i):Number.parseFloat(e.toFixed(t)):e instanceof c?c.roundTo(e,t):0},ieeeRemainder:(e,t)=>e-Math.round(e/t)*t,log(e,t=null){return null==t?Math.log(e):2==t?Math.log2(e):10==t?Math.log10(e):Math.log(e)/Math.log(t)},max(e,t){return"number"==typeof e&&"number"==typeof t?Math.max(e,t):e instanceof c||t instanceof c?0<c.compare(e,t)?e:t:e instanceof l||t instanceof l?0<l.compare(e,t)?e:t:t<e?0|e:0|t},min(e,t){return"number"==typeof e&&"number"==typeof t?Math.min(e,t):e instanceof c||t instanceof c?c.compare(e,t)<0?e:t:e instanceof l||t instanceof l?l.compare(e,t)<0?e:t:e<t?0|e:0|t},sign(e){return"number"==typeof e?Math.sign(e):e instanceof c?c.sign(e):e instanceof l?l.sign(e):0<e?1:e<0?-1:0},toDegrees:e=>e/ge.DOUBLE_PI*ge.DEGREE_CIRCLE,toRadians:e=>e/ge.DEGREE_CIRCLE*ge.DOUBLE_PI}});class He extends f{get path(){return null==this["#url"]&&(null==this["#blob"]&&(this["#blob"]=new Blob(this["#data"]||[])),this["#url"]=URL.createObjectURL(this["#blob"])),this["#url"]}getBytes(){return null==this["#blob"]&&(this["#blob"]=d.fetch(this["#url"]).then(e=>e.blob())),this["#blob"]instanceof Promise?this["#blob"].then(e=>e.arrayBuffer()).then(e=>Array.from(e)):this["#blob"].arrayBuffer().then(e=>Array.from(e))}dispose(){this["#data"]=null,this["#blob"]=null,this["#isBlob"]&&URL.revokeObjectURL(this["#url"])}toImage(){return s.$fromBlobAndUrl(this["#blob"],this["#url"])}static $fromUrl(e){var t;return null==He["##cache"]&&F(He,"##cache",S()),null!=He["##cache"][e]?He["##cache"][e]:((t=new He)["#url"]=e,He["##cache"][e]=t)}}R.declareSystemType(He,{name:"Resource"});class je extends f{constructor(e,t){super(),this.isOk=e||!1,this.info=t||null}}R.declareSystemType(je,{name:"Result",systemtransmit:{info:$,isOk:Y}});class ze extends f{static get language(){var e=d.document.documentElement;return e.hasAttribute("lang")?e.getAttribute("lang"):"zh-cn"}static set language(e){var t=d.document.documentElement;e?t.setAttribute("lang",e):t.removeAttribute("lang")}static set byCookie(e){return E.CookieStorageUtil.setBytCookie(e)}static get byCookie(){return E.CookieStorageUtil.getBytCookie()}static set bySaaSID(e){return E.CookieStorageUtil.setBytSaaSID(e)}static get bySaaSID(){return E.CookieStorageUtil.getBytSaaSID()}static get currentScene(){return"web"}static get currentWindow(){return null==this["#window"]&&(this["#window"]=new Ei(globalThis)),this["#window"]}static get currentDocument(){return null==this["#document"]&&(this["#document"]=new Ti(globalThis.document)),this["#document"]}static get serverURL(){return E.ProjectServerUtil.getServerUrl()}static get webRootPath(){return E.ProjectFilesUtil.getProjectRootPath()}static autoID(e,t,i){if(null==i&&(null==t?(i=!1,t=1):"boolean"==typeof t?(i=t,t=1):(i=!1,t|=0)),e instanceof V)return E.ProjectServerUtil.sendServerPackage({"#":"AUTOID",$SH:V.$getTransmitData(e),$VA:0|t,$Refresh:!!i}).then(e=>0|e);throw new y("System.autoID",T.AutoID_Table_Cannot_Null)}}R.declareSystemType(ze,{name:"System"});class Ke extends f{constructor(e,t,i,n){super(),p(e)&&([e,t,i,n]=e),F(this,{"#r":0|e,"#g":0|t,"#b":0|i,"#a":null==n?255:0|n})}get r(){return this["#r"]}get g(){return this["#g"]}get b(){return this["#b"]}get a(){return this["#a"]}$toHex(e=!0){return d.ColorHelper.RGBAToCssColor(this["#r"],this["#g"],this["#b"],e?this["#a"]:void 0)}toString(){return this.$toHex(!0)}by$toString(){return this.toString()}static $fromString(e){e=d.ColorHelper.cssColorToRGBA(e);return new Ke(...e)}static $toHexString(e,t=!0){return null==e?"":(e="string"==typeof e?Ke.$fromString(e):e).$toHex(t)}}for([le,ae]of[["RED","#ff0000"],["YELLOW","#ffff00"],["GREEN","#00ff00"],["BLUE","#0000ff"],["BLACK","#000000"],["WHITE","#ffffff"]])F(Ke,le,new Ke(d.ColorHelper.cssColorToRGBA(ae,!0)));R.declareSystemType(Ke,{name:"Color"}),e=(()=>{const i=Symbol("timerInd"),n=Symbol("interval"),r=Symbol("isRunning"),s=Symbol("isLoop"),l=Symbol("timeout_event");function a(e){e[s]?d.clearInterval(e[i]):d.clearTimeout(e[i]),e[i]=void 0,e[r]=!1}function t(e){var t=e[n];e[s]?e[i]=d.setInterval(()=>{I.$invoke(e[l],[e,new it])},t):e[i]=d.setTimeout(()=>{I.$invoke(e[l],[e,new it]),a(e)},t),e[r]=!0}return class extends f{constructor(e=100){super(),this[l]=I.$create("timeout"),this[n]=0|e,this[s]=!0,this[r]=!1}get timeout(){return this[l]}get autoReset(){return this[s]}set autoReset(e){this[s]!=e&&(this[r]?(a(this),this[s]=!!e,t(this)):this[s]=!!e)}get interval(){return this[n]}set interval(e){e!=this[n]&&(this[n]=0|e,this[r])&&(a(this),t(this))}get isEnabled(){return this[r]}set isEnabled(e){e!=this.isEnabled&&(e?t:a)(this)}start(){this[r]||t(this)}stop(){this[r]&&a(this)}}})(),R.declareSystemType(e,{name:"Timer"});class s{getBytes(){return null==this["#blob"]&&(this["#blob"]=d.fetch(this["#url"]).then(e=>e.blob())),this["#blob"]instanceof Promise?this["#blob"].then(e=>e.arrayBuffer()).then(e=>Array.from(e)):this["#blob"].arrayBuffer().then(e=>Array.from(e))}$toUrl(){return null!=this["#url"]?this["#url"]:this["#url"]=URL.createObjectURL(this["#blob"])}static fromBytes(e){return s.$fromBlobAndUrl(new Blob(e),null)}static fromResource(e){return null==e?null:s.$fromBlobAndUrl(e["#blob"],e["#url"])}static fromUrl(e){return s.$fromBlobAndUrl(null,e)}static $fromBlobAndUrl(e,t){var i=new s;return i["#blob"]=e,i["#url"]=t,i}static $toUrl(e){return"string"==typeof e?e:e instanceof s?e.$toUrl():e instanceof Blob?s.$fromBlobAndUrl(e).$toUrl():null}static $from(e){return null==e||""===e?null:e instanceof s?e:"string"==typeof e?s.$fromBlobAndUrl(null,e):e instanceof Blob?s.$fromBlobAndUrl(e):s.$fromBlobAndUrl(null,e.toString())}}R.declareSystemType(s,{name:"Image"});class qe extends f{constructor(e){super(),F(this,"#dataTransfer",e=null==e?new DataTransfer:e)}containsFileDropList(){var e=this["#dataTransfer"].files;return null!=e&&0<e.length}getData(e){return null==e?null:this["#dataTransfer"].getData(e)}setData(e,t){if(null!=e&&null!=t)return this["#dataTransfer"].setData(e,t)}getFormats(){var e,t=[];for(e of this["#dataTransfer"].types)"Files"!=e&&t.push(e);return t}getWebFileDropList(){var e,t=[];for(e of this["#dataTransfer"].files)t.push(Si.$createFromNativeFile(e));return t}static get textFormat(){return"text"}static get htmlFormat(){return"text/html"}}R.declareSystemType(qe,{name:"DataObject"});class We extends f{get values(){return k(this["#values"])}get table(){return this["#table$ctrl"]["#table"]}static $create(e,t,i){var n=new We;return F(n,{"#table":e,"#sources":t,"#values":i}),n}}R.declareSystemType(We,{name:"QueryData",transmit:{toJSON(e,i){var t=e["#table"],n=e["#sources"],r=e["#values"];let s=[],l=0;for(let t of n){var a=r[l++];null==a?s.push(null):a instanceof Array?s.push(a.map(e=>i.serialize(e,t["#type"]))):s.push(i.serialize(a,t["#type"]))}return{"#":"QUERY",$SH:V.$getTransmitData(t),$SS:n.map(e=>e.name),$VA:s}}}});const Ye=(()=>{class t{constructor(e,t){this.messageBox=document.createElement("div"),this.messageBox.className="by-message-box",this.content=document.createElement("div"),this.content.className="by-message-content",this.determineBtn=document.createElement("button"),this.determineBtn.className="by-message-determine",this.determineBtn.textContent="确定",this.cancelBtn=document.createElement("button"),this.cancelBtn.className="by-message-cancel",this.cancelBtn.textContent="取消",this.messageCover=document.createElement("div"),this.messageCover.className="by-message-cover",this.messageCover.append(this.messageBox),this.content.innerHTML=e,this.messageBox.append(this.content,this.determineBtn,this.cancelBtn),t?this.messageBox.classList.remove("alert"):this.messageBox.classList.add("alert")}show(e,t){this["#opened"]=!0,this.content.innerHTML=e,t?this.messageBox.classList.remove("alert"):this.messageBox.classList.add("alert"),document.body.append(this.messageCover),this.messageCover.style.zIndex=2147483647,this.messageCover.style.height=document.documentElement.clientHeight>document.documentElement.offsetHeight?document.documentElement.clientHeight+"px":document.documentElement.offsetHeight+"px",this.messageBox.style.top=(window.innerHeight-Number(getComputedStyle(this.messageBox).height.replace("px","")))/2+document.documentElement.scrollTop+"px"}close(){this["#opened"]=!1,this.messageCover.remove(),this.cancelBtn.onclick=null,this.determineBtn.onclick=null}static alertOrConfirm(i,n){null!=this.instance&&this.instance["#opened"]&&(this.instance=null),null==this.instance&&(this.instance=new t(i,n));let r=this.instance;return new Promise(function(e,t){r.cancelBtn.onclick=()=>{r.close(),e(!1)},r.determineBtn.onclick=()=>{r.close(),e(!0)},r.show(i,n)})}}return class extends f{static confirm(e){return t.alertOrConfirm(e,!0)}static alert(e){return t.alertOrConfirm(e,!1)}}})();R.declareSystemType(Ye,{name:"Message"});class Je extends a{constructor(e){super();e=null!=e?e.detail:null,e=e?e.source:null;F(this,"targetUnit",e),F(this,"targetIndex",e?e.$getParent().$getChildIndex(e):-1)}}R.declareSystemType(Je,{name:"EditAreaEventArgs"});class Ge extends a{constructor(){super(),this["#cancel"]=!1}get cancel(){return!!this["#cancel"]}set cancel(e){this["#cancel"]=!!e}}R.declareSystemType(Ge,{name:"CancelEventArgs"});class Xe extends a{constructor(e){super();e=null!=e?e.detail:null;F(this,"#cell",e?e.source:null)}get targetCell(){return this["#cell"]}get rowIndex(){return this["#cell"]?this["#cell"].rowIndex:-1}get columnIndex(){return this["#cell"]?this["#cell"].columnIndex:-1}}R.declareSystemType(Xe,{name:"GridCellEventArgs"});class Qe extends a{constructor(e){super(),F(this,{"#raw":e,alt:e.altKey,control:e.ctrlKey,shift:e.shiftKey,keyCode:e.key})}}R.declareSystemType(Qe,{name:"KeyEventArgs"});class Ze extends a{constructor(e){super();e=null!=e?e.detail:null;let t=e?e.items||e.source:null;F(this,"targetItem",t=t instanceof Array?t[0]:t)}}R.declareSystemType(Ze,{name:"MenuEventArgs"});class t extends a{constructor(e){super(),F(this,{"#nativeEvent":e,button:t.$buttonToEnum(e.button)})}get x(){return this["#nativeEvent"].offsetX}get y(){return this["#nativeEvent"].offsetY}get pageX(){return this["#nativeEvent"].pageX}get pageY(){return this["#nativeEvent"].pageY}get screenX(){return this["#nativeEvent"].screenX}get screenY(){return this["#nativeEvent"].screenY}static $buttonToEnum(e){return 0==e?"left":1==e?"middle":2==e?"right":"undifined"}}R.declareSystemType(t,{name:"MouseEventArgs"});class et extends a{constructor(e){super();e=null!=e?e.detail:null;F(this,"targetItem",e?e.source:null)}}R.declareSystemType(et,{name:"ToolBarEventArgs"});class tt extends a{constructor(e){super();e=null!=e?e.detail:null,e=e?e.nodes||e.source:null;let t=e instanceof Array?e[0]:e;F(this,"node",t=t instanceof Qt?t:null),null!=t&&O.$setBindIdentity(this,O.$getBindIdentity(t))}}R.declareSystemType(tt,{name:"TreeNodeEventArgs"});class it extends a{constructor(e){super(),null==e&&(e=Se.getNow()),this["#time"]=e}get signalTime(){return this["#time"]}}R.declareSystemType(it,{name:"TimeoutEventArgs"});class nt extends a{constructor(e){super(),F(this,"#nativeEvent",e)}get x(){return this["#nativeEvent"].offsetX}get y(){return this["#nativeEvent"].offsetY}get pageX(){return this["#nativeEvent"].pageX}get pageY(){return this["#nativeEvent"].pageY}get screenX(){return this["#nativeEvent"].screenX}get screenY(){return this["#nativeEvent"].screenY}get control(){return this["#nativeEvent"].ctrlKey}get ctrl(){return this["#nativeEvent"].ctrlKey}get shift(){return this["#nativeEvent"].shiftKey}get data(){var e;return null==this["#cached_data"]?(e=this["#nativeEvent"].dataTransfer,this["#cached_data"]=new qe(e)):this["#cached_data"]}get allowedEffects(){var e=this["#nativeEvent"].dataTransfer.effectAllowed;return"uninitialized"==e?"all":e}get effect(){return this["#nativeEvent"].dataTransfer.dropEffect}set effect(t){if(null!=t){let e;switch(t){case"none":e="none";break;case"copy":case"copyMove":case"copyLink":case"all":e="copy";break;case"move":case"moveLink":e="move";break;case"link":e="link"}null!=e&&(this["#nativeEvent"].dataTransfer.dropEffect=e)}}}R.declareSystemType(nt,{name:"DragEventArgs"});class rt extends a{constructor(e){super(),F(this,"#nativeEvent",e)}get x(){return this["#nativeEvent"].offsetX}get y(){return this["#nativeEvent"].offsetY}get pageX(){return this["#nativeEvent"].pageX}get pageY(){return this["#nativeEvent"].pageY}get screenX(){return this["#nativeEvent"].screenX}get screenY(){return this["#nativeEvent"].screenY}get data(){var e;return null==this["#cached_data"]||this["#cached_data"]["#dataTransfer"]!=this["#nativeEvent"].dataTransfer?(e=this["#nativeEvent"].dataTransfer,this["#cached_data"]=new qe(e)):this["#cached_data"]}set data(t){if(t!=this["#cached_data"]&&null!=t){var i=this["#nativeEvent"].dataTransfer;let e;if(t instanceof DataTransfer?e=t:t instanceof qe&&(e=t["#dataTransfer"]),e!=i&&null!=e){i.clearData();for(var n of e.types){var r=e.getData(n);null!=r&&""!=r&&i.setData(n,r)}}}}get allowedEffects(){var e=this["#nativeEvent"].dataTransfer.effectAllowed;return"uninitialized"==e?"all":e}set allowedEffects(e){this["#nativeEvent"].dataTransfer.effectAllowed=e}get dragImage(){if(null!=this["#cached_img"]){var e=this["#cached_img"].src;if(null!=e)return s.$from(e)}return null}set dragImage(t){t=s.$toUrl(t);if(null!=t){let e;(e=null==this["#cached_img"]?this["#cached_img"]=d.ElementHelper.createElement("img"):this["#cached_img"]).src=t,this["#nativeEvent"].dataTransfer.setDragImage(e,1,1)}}}R.declareSystemType(rt,{name:"DragStartEventArgs"});const g=(()=>{const n={initial:"auto",hand:"pointer",help:"help",cross:"crosshair",wait:"wait",no:"not-allowed",resize:"ew-resize",resizeAll:"move",resizeNESW:"nesw-resize",resizeNS:"ns-resize",resizeNWSE:"nwse-resize",resizeWE:"ew-resize"};function s(e,t,i){e=C.getVisual(e),null==t?t=e.$hasState("self-disabled"):e.$setState("self-disabled",t),null==i?i=e.$hasState("parent-disabled"):e.$setState("parent-disabled",i);var n=t||i;if(n!=e["#disabled"]){n?e.$disable():e.$enable();for(var r of e["#element"].children)s(r,null,n)}}function r(e,t,i){let n,r;if(r=e.startsWith("dom:")?(n=document,e.slice(4)):e.startsWith("wdw:")?(n=window,e.slice(4)):(n=i,e),t instanceof Array)for(var s of t)n.addEventListener(r,s);else n.addEventListener(r,t)}function l(e,t,i){let n,r;if(r=e.startsWith("dom:")?(n=document,e.slice(4)):e.startsWith("wdw:")?(n=window,e.slice(4)):(n=i,e),t instanceof Array)for(var s of t)n.removeEventListener(r,s);else n.removeEventListener(r,t)}return class extends f{constructor(e){super(),F(this,{"#element":e=C.createVisualElement(new.target,e),"#constChildren":[],"#events":S(),"#properties":S(),"#dataEvents":S(),"#dataChildren":[]}),this["#dataParent"]=null,F(e,"#visualTag",this),this.$on("ui:child-afterinsert",e=>{!this.isEnabled&&e.detail.child&&s(e.detail.child,null,!0)}),this.$on("ui:child-beforeremove",e=>{!this.isEnabled&&e.detail.child&&s(e.detail.child,null,!1)}),this["#draggable"]=!1,this["#dropable"]=!1}get["#controlParent"](){let e=this["#element"].parentElement;for(;null!=e&&e!=document.body;){if(null!=e["#visualTag"]&&e["#visualTag"]instanceof v)return e["#visualTag"];e=e.parentElement}return null}get["#parent"](){var e=this["#element"].parentElement;return null==e||e==document.body?null:C.getVisual(e)}get["#root"](){return"getRootNode"in this["#element"]?this["#element"].getRootNode():this["#element"].ownerDocument}get["#isFocused"](){var e=this["#root"];return e&&e.activeElement==this["#element"]}get["#draggable"](){return!!this["#element"].draggable}set["#draggable"](e){this.$setState("draggable",!!e),this["#element"].draggable=!!e}get["#dropable"](){return this.$hasState("dropable")}set["#dropable"](e){this.$setState("dropable",!!e)}get["#isConnected"](){return this["#element"].isConnected}get["#computedStyle"](){return this["#element"].isConnected?window.getComputedStyle(this["#element"]):this["#style"]}get["#style"](){return this["#element"].style}get element(){return null==this["##cache_web_element"]&&(this["##cache_web_element"]=new D(this["#element"])),this["##cache_web_element"]}get isFocused(){return this["#isFocused"]}get id(){var e=this["#element"].id;return e||(this["#element"].id=d.ElementHelper.getAutoID())}set id(e){this["#element"].id=$(e)}get tabIndex(){return this["#element"].tabIndex}set tabIndex(e){this["#element"].tabIndex=e}get zIndex(){return 0|Number(this["#style"].zIndex)}set zIndex(e){this["#style"].zIndex=e=0<e?e:""}get text(){return this["#element"].dataset.text}set text(e){this["#element"].dataset.text=null!=e?e:""}get name(){return this["#element"].dataset.name||""}set name(e){this["#element"].dataset.name=null!=e?e:""}get text(){return this.$getCacheProp("text",null)}set text(e){this.$setCacheProp("text",e)}get["#docked"](){return this.$hasState("docked")}set["#docked"](e){this.$hasState("docked")!=e&&(this.$setState("docked",!!e),e?(this.$setCacheProp("top",this.top),this.$setCacheProp("left",this.left),this.$setCacheProp("height",this.height),this.$setCacheProp("width",this.width),this.$setCacheProp("position",this["#element"].style.position||""),this.isHeightFilled=!1,this.isWidthFilled=!1):(this.left=this.$getCacheProp("left"),this.top=this.$getCacheProp("top"),this.height=this.$getCacheProp("height"),this.width=this.$getCacheProp("width"),this["#element"].style.position=this.$getCacheProp("position","")))}get dock(){return this["#element"].dataset.dock||"none"}set dock(e){"none"!=e&&["left","right","top","bottom","fill"].includes(e)||(e="");let t=this["#element"].dataset.dock||"";var i;e!=(t="none"==t?"":t)&&(this["#element"].dataset.dock=e,null!=(i=this.$getParent(at)))&&(this["#docked"]=""!=e,i.$refreshChildrenDockStyle(this))}get left(){var e;return this["#isConnected"]&&!this["#hidden"]?(e=this["#element"].offsetLeft,this.$setCacheProp("left",e),e):this.$getCacheProp("left",0)}set left(e){this.$setCacheProp("left",e),this["#docked"]||(this.$adjustPosition(),this["#style"].left=d.PixelUnitHelper.lengthToPixel(e))}get top(){var e;return this["#isConnected"]&&!this["#hidden"]?(e=this["#element"].offsetTop,this.$setCacheProp("top",e),e):this.$getCacheProp("top",0)}set top(e){this.$setCacheProp("top",e),this["#docked"]||(this.$adjustPosition(),this["#style"].top=d.PixelUnitHelper.lengthToPixel(e))}$getHeightInternal(){var e=this["#element"].offsetHeight;return 0==e?d.PixelUnitHelper.pixelToLength(this["#style"].height):e}$setHeightInternal(e,t=!1){0!=e&&""!=e||(this["#style"].height=""),this["#style"].height=t?e:d.PixelUnitHelper.lengthToPixel(e)}$getWidthInternal(){var e=this["#element"].offsetWidth;return 0==e?d.PixelUnitHelper.pixelToLength(this["#style"].width):e}$setWidthInternal(e,t=!1){0!=e&&""!=e||(this["#style"].width=""),this["#style"].width=t?e:d.PixelUnitHelper.lengthToPixel(e)}get height(){var e;if(this["#isConnected"]&&!this["#hidden"])return e=this.$getHeightInternal(),this.$setCacheProp("height",e),e;{let e=this.$getCacheProp("height",0);return 0==e&&(0==(e=d.PixelUnitHelper.pixelToLength(this["#style"].height))&&(e=10),this.$setCacheProp("height",e)),e}}set height(e){this.$setCacheProp("height",e),this.isHeightFilled||this["#docked"]||this.$setHeightInternal(e,!1)}get width(){var e;if(this["#isConnected"]&&!this["#hidden"])return e=this.$getWidthInternal(),this.$setCacheProp("width",e),e;{let e=this.$getCacheProp("width",0);return 0==e&&(0==(e=d.PixelUnitHelper.pixelToLength(this["#style"].width))&&(e=10),this.$setCacheProp("width",e)),e}}set width(e){this.$setCacheProp("width",e),this.isWidthFilled||this["#docked"]||this.$setWidthInternal(e,!1)}get webWidthFilled(){return this.$hasState("filled")}set webWidthFilled(e){this["#docked"]||e!=this.$hasState("filled")&&(this.$setState("filled",e),e?(0!=(e=this.width)&&this.$setCacheProp("width",e),this.$setWidthInternal("100%",!0)):this.$setWidthInternal(this.$getCacheProp("width",0),!1))}get webHeightFilled(){return this.$hasState("height-filled")}set webHeightFilled(e){this["#docked"]||e!=this.$hasState("height-filled")&&(this.$setState("height-filled",e),e?(0!=(e=this.height)&&this.$setCacheProp("height",e),this.$setHeightInternal("100%",!0)):this.$setHeightInternal(this.$getCacheProp("height",0),!1))}get webID(){return this.id}set webID(e){this.id=e}get webClass(){return this["#element"].className}set webClass(e){e&&this["#element"].classList.add(e)}get webStyle(){return this["#element"].style}set webStyle(e){var t;e&&(t=this["#element"].getAttribute("style")||"",this["#element"].style=t+e)}get paddingLeft(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].paddingLeft)}set paddingLeft(e){this["#style"].paddingLeft=d.PixelUnitHelper.lengthToPixel(e)}get paddingTop(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].paddingTop)}set paddingTop(e){this["#style"].paddingTop=d.PixelUnitHelper.lengthToPixel(e)}get paddingRight(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].paddingRight)}set paddingRight(e){this["#style"].paddingRight=d.PixelUnitHelper.lengthToPixel(e)}get paddingBottom(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].paddingBottom)}set paddingBottom(e){this["#style"].paddingBottom=d.PixelUnitHelper.lengthToPixel(e)}get marginLeft(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].marginLeft)}set marginLeft(e){this["#style"].marginLeft=d.PixelUnitHelper.lengthToPixel(e)}get marginTop(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].marginTop)}set marginTop(e){this["#style"].marginTop=d.PixelUnitHelper.lengthToPixel(e)}get marginRight(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].marginRight)}set marginRight(e){this["#style"].marginRight=d.PixelUnitHelper.lengthToPixel(e)}get marginBottom(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].marginBottom)}set marginBottom(e){this["#style"].marginBottom=d.PixelUnitHelper.lengthToPixel(e)}get fontSize(){return d.PixelUnitHelper.pixelToLength(this["#computedStyle"].fontSize)}set fontSize(e){this["#style"].fontSize=d.PixelUnitHelper.lengthToPixel(e);for(var t of this["#constChildren"])t.fontSize=e}get fontIsItalic(){return["italic","oblique"].includes(this["#computedStyle"].fontStyle)}set fontIsItalic(e){this["#style"].fontStyle=e?"italic":"normal";for(var t of this["#constChildren"])t.fontIsItalic=e}get fontIsBold(){return 700<=this["#computedStyle"].fontWeight}set fontIsBold(e){this["#style"].fontWeight=e?"bold":"";for(var t of this["#constChildren"])t.fontIsBold=e}get foreColor(){return Ke.$fromString(this["#computedStyle"].color)}set foreColor(e){if(e){this["#style"].color=Ke.$toHexString(e);for(var t of this["#constChildren"])t.foreColor=e}}get backColor(){return Ke.$fromString(this["#computedStyle"].backgroundColor)}set backColor(e){if(e){this["#style"].backgroundColor=Ke.$toHexString(e);for(var t of this["#constChildren"])t.backColor=e}}get hasBorder(){return this.$hasState("hasborder")}set hasBorder(e){this.$setState("borderless",!e),this.$setState("hasborder",e)}get cursor(){var e,t=this["#computedStyle"].cursor;for(e of M(n))if(e[1]==t)return e[0];return"initial"}set cursor(e){var t,i=n[e];i&&(this["#style"].cursor=i);for(t of this["#constChildren"])t.cursor=e}get opacity(){var e=this["#computedStyle"].opacity;return"auto"==e||""==e?1:(e=Number(e),isNaN(e)?this.opacity=1:e)}set opacity(e){this["#style"].opacity=e}get["#hidden"](){return!!this.$hasState("hidden")||"none"==this["#style"].display}set["#hidden"](e){e&&null==this["#properties"].width&&(this["#properties"].width=this.$getWidthInternal(),this["#properties"].height=this.$getHeightInternal()),this["#element"].hidden=e,this.$setState("hidden",e)}get["#disabled"](){return this.$hasState("disabled")}set["#disabled"](e){this.$setState("disabled",e),s(this,e)}get visible(){return!this["#hidden"]}set visible(e){this["#hidden"]=!e}get hidden(){return this["#hidden"]}set hidden(e){this["#hidden"]=e}get isEnabled(){return!this["#disabled"]}set isEnabled(e){this["#disabled"]=!e}get isDisabled(){return this["#disabled"]}set isDisabled(e){this["#disabled"]=e}get tag(){return this["#bytag"]}set tag(e){this["#bytag"]=e}show(){this["#hidden"]=!1}hide(){this["#hidden"]=!0}focus(){this["#element"].focus()}blur(){this["#element"].blur()}$adjustPosition(){var e=this["#element"].parentElement;e&&"BODY"!=e.tagName&&""==window.getComputedStyle(e).position&&(e.style.position="relative"),this["#element"].style.position="absolute"}$disable(){this.$setState("disabled",!0);var e,t,i=this["#element"];for([e,t]of M(this["#events"]))l(e,t,i)}$enable(){this.$setState("disabled",!1);var e,t,i=this["#element"];for([e,t]of M(this["#events"]))r(e,t,i)}$on(e,t){(this["#events"][e]||(this["#events"][e]=[])).push(t),this.isEnabled&&r(e,t,this["#element"])}$off(e,t){var i,n=this["#events"][e]||(this["#events"][e]=[]);null!=t?0<=(i=n.indexOf(t))&&(n.splice(i,1),l(e,t,this["#element"])):l(e,n.splice(0),this["#element"])}$trigger(e,t){this.isEnabled&&this["#element"].dispatchEvent(new CustomEvent(e,{detail:B(t,{source:this})}))}$bubble(e,t){this.isEnabled&&this["#element"].dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:B(t,{source:this})}))}$getDataEvent(e){var t=this["#dataEvents"][e];return null!=t?t:(t=I.$create(e),this["#dataEvents"][e]=t)}$invokeDataEvent(e,t){e=this["#dataEvents"][e];if(null!=e)return I.$invoke(e,[this,t||new a])}$hasState(e){return this["#element"].hasAttribute("data-"+e)||this["#element"].hasAttribute(e)||this["#element"].classList.contains("by-"+e)}$setState(e,t){t?(this["#element"].setAttribute(e,""),this["#element"].setAttribute("data-"+e,!0),this["#element"].classList.add(e),this["#element"].classList.add("by-"+e)):(this["#element"].removeAttribute(e),this["#element"].removeAttribute("data-"+e),this["#element"].classList.remove(e),this["#element"].classList.remove("by-"+e))}$getState(e){return this["#element"].getAttribute("data-"+e)}$addClass(e){this["#element"].classList.add(e)}$removeClass(e){this["#element"].classList.remove(e)}$setAttribute(e,t){this["#element"].setAttribute(e,t)}$getAttribute(e){return this["#element"].getAttribute(e)}$hasAttribute(e){return this["#element"].hasAttribute(e)}$removeAttribute(e){return this["#element"].removeAttribute(e)}$setCacheProp(e,t){this["#properties"][e]=t}$getCacheProp(e,t=null){e=this["#properties"][e];return null==e?t:e}$constProp(e,t,i){if(t=C.getVisual(t),null!=i){if(null!=i.classes){let e=i.classes;for(var n of e=e instanceof Array?e:[e])t.$addClass(n);delete i.classes}for(var[r,s]of M(i))r in t&&(t[r]=s)}return F(this,e,t),t}$constChild(e,t,i){if(t=C.getVisual(t),null!=i){if(null!=i.classes){let e=i.classes;for(var n of e=e instanceof Array?e:[e])t.$addClass(n);delete i.classes}for(var[r,s]of M(i))r in t&&(t[r]=s)}return F(this,e,t),this["#constChildren"].push(t),this["#element"].append(t["#element"]),t}$contains(e,t=!0){e=C.getElement(e);return t?this["#element"].contains(e):e.parentElement==this["#element"]}$remove(){this["#dialog"]=null,this["#host"]=null;var e=this["#parent"];null!=e&&e.$trigger("ui:child-beforeremove",{child:this}),this["#element"].remove(),null!=e&&e.$trigger("ui:child-afterremove",{child:this})}$prepend(e){e=C.getVisual(e);this.$trigger("ui:child-beforeinsert",{child:e,index:0}),this["#element"].prepend(e["#element"]),this.$trigger("ui:child-afterinsert",{child:e,index:0})}$append(e){e=C.getVisual(e);this.$trigger("ui:child-beforeinsert",{child:e}),this["#element"].append(e["#element"]),this.$trigger("ui:child-afterinsert",{child:e})}$insert(e,t){var i,e=C.getVisual(e);this.$trigger("ui:child-beforeinsert",{child:e,index:t}),null==t?this["#element"].append(e["#element"]):null==(i=this.$getChildAt(t))?(t=void 0,this["#element"].append(e["#element"])):i["#element"].before(e["#element"]),this.$trigger("ui:child-afterinsert",{child:e,index:t})}$fillChildren(e){for(var t of e)this.$append(t)}$clear(){for(var e of this.$getChildren())e.$remove()}$removeAt(e){e=this.$getChildAt(e);return!!e&&(e.$remove(),!0)}$removeChild(e,t=!0){if(this.$contains(e,t))return e.$remove(),!0}$getChildAt(e){return this.$getChildren()[e]||null}$getChildIndex(e){return this.$getChildren().indexOf(e)}$getChildCount(){return this.$getChildren().length}$getChildren(t){let e=[];var i,n=this["#constChildren"];for(i of this["#element"].children){var r=C.getVisual(i);n.includes(r)||e.push(r)}return e=null!=t?e.filter(e=>e instanceof t):e}$getParent(t){if(null==t)return this["#parent"];{let e=this["#parent"];for(;null!=e&&!(e instanceof t);)e=e["#parent"];return e}}}})();R.declareSystemVisualType(g,{name:"Visual",visual:{name:"Visual",tags:"div",classes:["by-visual","visual"],attrs:{"data-title":"text",tabIndex:"tabIndex",hidden:"hidden",disabled:"isDisabled","data-text":"text","data-height":"height","data-width":"width","data-widthfilled":"isWidthFilled","data-heightfilled":"isHeightFilled","data-left":"left","data-top":"top","data-color":"foreColor","data-backcolor":"backColor","data-cursor":"cursor"}}});class st extends g{}R.declareSystemVisualType(st,{name:"BlockVisual",visual:{name:"BlockVisual",inner:!0,tags:"div",classes:"block-visual"}});class lt extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=$(e)}}R.declareSystemVisualType(lt,{name:"ButtonVisual",visual:{name:"ButtonVisual",inner:!0,tags:"button",classes:"button-visual"}});class at extends g{constructor(e){super(e),this.$on("ui:child-afterinsert",e=>{e=e.detail.child;null!=e&&["left","right","top","bottom","fill"].includes(e.dock)&&(e["#docked"]=!0,this.$refreshChildrenDockStyle(e))}),this.$on("ui:child-beforeremove",e=>{e=e.detail.child;null!=e&&["left","right","top","bottom","fill"].includes(e["#docked"])&&(this.$refreshChildrenDockStyle(e,!0),e["#docked"]=!1)})}$refreshChildrenDockStyle(e,t=!1){null!=this["#element"].style.position&&""!=this["#element"].style.position||(this["#element"].style.position="relative");var i,r=[],s=[],l=[],a=[],o=[];for(i of super.$getChildren())if(i!=e||!t){var n=i.dock;if(""!=n&&"none"!=n)switch(n){case"top":s.push(i);break;case"bottom":l.push(i);break;case"left":a.push(i);break;case"right":o.push(i);break;case"fill":r.push(i)}}if(0!=s.length||0!=l.length||0!=a.length||0!=o.length||0!=r.length){let t=0;for(var u of s){u["#element"].style.position="absolute";var h=u.$getCacheProp("height");u.$setWidthInternal("100%",!0),u.$setHeightInternal(h,!1),u["#element"].style.top=t+"px",t+=h,u["#element"].style.left="0px",u["#element"].style.right="",u["#element"].style.bottom=""}let e=0;for(var d of l){d["#element"].style.position="absolute";var c=d.$getCacheProp("height");d.$setWidthInternal("100%",!0),d.$setHeightInternal(c,!1),d["#element"].style.bottom=t+"px",e+=c,d["#element"].style.left="0px",d["#element"].style.right="",d["#element"].style.top=""}var m,g,p=t+e,f=0==p?"100%":`calc(100% - ${p}px)`;let i=0;for(m of a){m["#element"].style.position="absolute";var $=m.$getCacheProp("width");m.$setHeightInternal(f,!0),m.$setWidthInternal($,!1),m["#element"].style.left=i+"px",i+=$,m["#element"].style.top=t+"px",m["#element"].style.right="",m["#element"].style.bottom=""}let n=0;for(g of o){g["#element"].style.position="absolute";var y=g.$getCacheProp("width");g.$setHeightInternal(f,!0),g.$setWidthInternal(y,!1),g["#element"].style.right=n+"px",n+=y,g["#element"].style.top=t+"px",g["#element"].style.left="",g["#element"].style.bottom=""}var v=i+n,b=0==v?"100%":`calc(100% - ${v}px)`;if(0<r.length){var v=r.length,x=100/v,w=p/v,S=0==p?x+"%":`calc(${x}% - ${w}px)`;for(let e=0;e<r.length;e++){var T,E,C=r[e];C["#element"].style.position="absolute",C.$setWidthInternal(b,!0),C.$setHeightInternal(S,!0),C["#element"].style.left=i+"px",0==e?C["#element"].style.top=t+"px":(T=x*e,E=w*e,C["#element"].style.top=`calc(${t} + ${T}% - ${E}px)`),C["#element"].style.right="",C["#element"].style.bottom=""}}}}}R.declareSystemVisualType(at,{name:"ContainerVisual",visual:{name:"ContainerVisual",inner:!0,tags:"div",classes:"container-visual"}});class ot extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e||""}}R.declareSystemVisualType(ot,{name:"ContentVisual",visual:{name:"ContentVisual",inner:!0,tags:"span",classes:"content-visual"}});class ut extends g{}R.declareSystemVisualType(ut,{name:"FieldSetVisual",visual:{name:"FieldSetVisual",inner:!0,tags:"fieldset",classes:"fieldset-visual"}});class ht extends g{}R.declareSystemVisualType(ht,{name:"FormVisual",visual:{name:"FormVisual",inner:!0,tags:"form",classes:"form-visual"}});class dt extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e}}R.declareSystemVisualType(dt,{name:"LegendVisual",visual:{name:"LegendVisual",inner:!0,tags:"legend",classes:"legend-visual"}});class ct extends g{get image(){return this["#element"].getAttribute("src")}set image(e){e?this.$setAttribute("src",s.$toUrl(e)):this["#element"].removeAttribute("src")}}R.declareSystemVisualType(ct,{name:"ImageVisual",visual:{name:"ImageVisual",inner:!0,tags:"img",classes:"image-visual"}});class mt extends g{get["#type"](){return this["#element"].type||"text"}get text(){return $(this["#element"].value)}set text(e){(e=null==e?"":e)!=this["#element"].value&&(this["#element"].value=e,this.$trigger("change"))}get value(){return this["#element"].value}set value(e){this["#element"].value=e||""}get readonly(){return this.$hasState("readonly")}set readonly(e){this.$setState("readonly",e)}get required(){return this.$hasState("required")}set required(e){this.$setState("required",e)}get min(){return this.$getAttribute("min")}set min(e){this.$setAttribute("min",e||null)}get max(){return super.$getAttribute("max")}set max(e){super.$setAttribute("max",e||null)}get minLength(){return this.$getAttribute("minlength")}set minLength(e){return this.$setAttribute("minlength",e)}get maxLength(){return this.$getAttribute("maxlength")}set maxLength(e){this.$setAttribute("maxlength",e)}get pattern(){return super.$getAttribute("pattern")}set pattern(e){null==e?(super.$removeAttribute("pattern"),super.$removeAttribute("title")):((e=(e=e.toString()).startsWith("^")?e:".*"+e).endsWith("$")||(e+=".*"),this.$setAttribute("pattern",e),this.$setAttribute("title",e))}get step(){return super.$getAttribute("step")}set step(e){return null==e||0==e?super.$removeAttribute("step"):super.$setAttribute("step",e)}get placeholder(){return this["#element"].placeholder}set placeholder(e){this["#element"].placeholder=e||""}get hasError(){return!this["#element"].validity.valid}get errorMessage(){return this["#element"].validationMessage}focus(e=!1){this["#element"].focus(),e&&this.selectAll()}blur(){this["#element"].blur()}$verify(){return this.readonly||this.disabled||!this.hasError?null:(this["#element"].reportValidity(),this.focus(),this["#element"].validationMessage||"Error")}verify(){return this.$verify()}get["#supportSelect"](){return null!=this["#element"].selectionStart}selectAll(){this["#supportSelect"]&&("select"in this["#element"]?this["#element"].select():"setSelectionRange"in this["#element"]&&this["#element"].setSelectionRange(0,this["#element"].value.length))}unselectAll(){var e;this["#supportSelect"]&&(e=this["#element"].selectionStart,this["#element"].setSelectionRange(e,e))}selectRange(e,t){this["#supportSelect"]&&(null==t&&(t=this["#element"].value.length),this["#element"].setSelectionRange(e,t))}get selectionStart(){return this["#element"].selectionStart||0}set selectionStart(e){this["#supportSelect"]&&(this["#element"].selectionStart=e)}get selectionEnd(){return this["#element"].selectionEnd||0}set selectionEnd(e){this["#supportSelect"]&&(this["#element"].selectionEnd=e)}}R.declareSystemVisualType(mt,{name:"InputVisual",visual:{name:"InputVisual",inner:!0,tags:"input",classes:"input-visual",inputTypes:"text"}});class gt extends mt{constructor(e){super(e),this["#element"].type="checkbox"}get checked(){return this["#element"].checked}set checked(e){this["#element"].checked=!!e}get isChecked(){return this["#element"].checked}set isChecked(e){this["#element"].checked=!!e}get indeterminate(){return this["#element"].indeterminate}set indeterminate(e){this.$setState("indeterminate",e),this["#element"].indeterminate=!!e}get text(){return this.indeterminate?"indeterminate":this.isChecked?"true":"false"}set text(e){this.isChecked=null!=e&&e.toString().toLowerCase().includes("true"),this.indeterminate="indeterminate"==e}get value(){return this.isChecked}set value(e){var t=this.isChecked,e=!(this.indeterminate=!1)===e||"true"==e||"checked"==e;e!=t&&(this.isChecked=e,this.$trigger("change"))}}R.declareSystemVisualType(gt,{name:"InputCheckBoxVisual",visual:{name:"InputCheckBoxVisual",inner:!0,classes:"inputcheckbox-visual",inputTypes:"checkbox"}});class pt extends mt{constructor(e){super(e),this["#element"].type="color"}get value(){return Ke.$fromString(this["#element"].value)}set value(e){this["#element"].value=Ke.$toHexString(e,!1)}}R.declareSystemVisualType(pt,{name:"InputColorVisual",visual:{name:"InputColorVisual",inner:!0,classes:"inputcolor-visual",inputTypes:"color"}});const ft=class extends mt{constructor(e){super(e),this["#element"].type="datetime-local"}get text(){var e=this["#element"].value;return e?e.replace("T"," "):""}set text(e){this.$setValueInternal(e)}get value(){return"time"==this["#element"].type?pe("0001-01-01T"+this["#element"].value):pe(this["#element"].value)}set value(e){this.$setValueInternal(e)}$setValueInternal(e){var t=this["#element"].value,e=(this["#element"].value=fe(e,this["#type"]),this["#element"].value);e!=t&&this.$trigger("change")}get min(){return pe(this["#element"].min)}set min(e){this["#element"].min=fe(e,this["#type"])}get max(){return pe(this["#element"].max)}set max(e){this["#element"].max=fe(e,this["#type"])}get["#type"](){let e=this["#element"].type;return["datetime-local","date","time"].includes(e)||(this["#type"]=e="datetime-local"),e}set["#type"](e){var t,i,n;(e=["datetime-local","date","time"].includes(e)?e:"datetime-local")!=this["#element"].type&&(t=this.min,i=this.max,n=this.value,this["#element"].type=e,t&&(this["#element"].min=fe(t,e)),i&&(this["#element"].max=fe(i,e)),n&&(this["#element"].value=fe(n,e)),this["#element"].step="time"==e?"0.001":"any")}};function pe(e){return null==e||""==e||null==(e=e instanceof Se?e:Se(e))||isNaN(e.valueOf())?null:e}function fe(e,t){e=pe(e);return null==e?"":e.format("date"==t?"yyyy-MM-dd":"time"==t?"HH:mm:ss":"yyyy-MM-ddTHH:mm:ss.fff")}R.declareSystemVisualType(ft,{name:"InputDateTimeVisual",visual:{name:"InputDateTimeVisual",inner:!0,classes:"inputdatetime-visual",inputTypes:["datetime-local","date","time"]}});class $t extends mt{constructor(e){super(e),this["#element"].type="number",this.$addClass("by-number")}get value(){return this["#element"].valueAsNumber}set value(e){this.value!=(this["#element"].value=e)&&this.$trigger("change")}get step(){var e=this.$getAttribute("step");return""==e||null==e||"any"==e?0:e}set step(e){0==e||null==e?this.$setAttribute("step","any"):this.$setAttribute("step",e.toString())}}R.declareSystemVisualType($t,{name:"InputNumberVisual",visual:{name:"InputNumberVisual",inner:!0,classes:"inputnumber-visual",inputTypes:"number"}});class yt extends mt{constructor(e){super(e),this["#element"].type="radio"}get isChecked(){return this["#element"].checked}set isChecked(e){this["#element"].checked!=e&&(this["#element"].checked=!!e,this.$trigger("change"))}$setGroupName(e){this["#element"].name=e}}R.declareSystemVisualType(yt,{name:"InputRadioVisual",visual:{name:"InputRadioVisual",inner:!0,classes:"inputradio-visual",inputTypes:"radio",attrs:{"data-checked":"isChecked"}}});class vt extends mt{constructor(e){super(e),this["#element"].type="range",this.max=10,this.value=0}get value(){return this["#element"].valueAsNumber|this["#element"].value|0}set value(e){this["#element"].value=e}get min(){return 0|this["#element"].min}set min(e){this["#element"].min=e}get max(){this["#element"].max}set max(e){return this["#element"].max=e}get step(){var e=this["#element"].step;return""==e||null==e||"any"==e?1:0|e}set step(e){this["#element"].step=e}}R.declareSystemVisualType(vt,{name:"InputRangeVisual",visual:{name:"InputRangeVisual",inner:!0,classes:"inputrange-visual",inputTypes:"range"}});class bt extends mt{constructor(e){super(e),this["#element"].type="text"}get isPassword(){return"password"==this["#element"].type}set isPassword(e){this["#element"].type=e?"password":"text"}}R.declareSystemVisualType(bt,{name:"InputTextVisual",visual:{name:"InputTextVisual",inner:!0,classes:"inputtext-visual",inputTypes:["text","password"],attrs:{"is-password":"isPassword"}}});class xt extends mt{constructor(e){super(e),this["#element"].type="file"}get files(){return this["#element"].files}get multiple(){return this["#element"].multiple}set multiple(e){this["#element"].multiple=!!e}get accept(){return this["#element"].accept||null}set accept(e){this["#element"].accept=$(e)}get value(){return this["#element"].value}set value(e){this["#element"].value=$(e)}}R.declareSystemVisualType(xt,{name:"InputFileVisual",visual:{name:"InputFileVisual",inner:!0,classes:"inputfile-visual",inputTypes:"file"}});class wt extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e}get bindTarget(){var e=this["#element"].htmlFor;return e?C.getVisual(d.ElementHelper.getElementById(e)):null}set bindTarget(e){var t;null==e?this["#element"].htmlFor="":(t=(t=e.id)||(e.id=d.ElementHelper.getAutoID()),this["#element"].htmlFor=t)}}R.declareSystemVisualType(wt,{name:"LabelVisual",visual:{name:"LabelVisual",inner:!0,tags:"label",classes:"label-visual"}});class St extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e}get href(){return this["#element"].getAttribute("href")}set href(e){this["#element"].setAttribute("href",e)}}R.declareSystemVisualType(St,{name:"LinkVisual",visual:{name:"LinkVisual",inner:!0,tags:"a",classes:"link-visual"}});class Tt extends g{}R.declareSystemVisualType(Tt,{name:"ListVisual",visual:{name:"ListVisual",inner:!0,tags:["ol","ul"],classes:"list-visual"}});class Et extends g{}R.declareSystemVisualType(Et,{name:"ListItemVisual",visual:{name:"ListItemVisual",inner:!0,tags:"li",classes:"listitem-visual"}});class Ct extends g{constructor(e){super(e),this.$setAttribute("controls",!0)}get isAudio(){var e=this["#element"].tagName;return null!=e&&"audio"==e.toLowerCase()}get loop(){return this["#element"].loop}set loop(e){this["#element"].loop=!!e}get autoPlay(){return this["#element"].autoplay}set autoPlay(e){this["#element"].autoplay=!!e}get isPaused(){return this["#element"].paused}get isEnded(){return this["#element"].ended}get isMuted(){return this["#element"].muted}set isMuted(e){this["#element"].muted=!!e}get volume(){return this["#element"].volume}set volume(e){this["#element"].volume=e||0}get src(){return this.$getAttribute("src")||null}set src(e){e&&this.$setAttribute("src",e)}get poster(){return this.$getAttribute("poster")||null}set poster(e){e&&this.$setAttribute("poster",e)}play(){try{return this["#element"].play()}catch(e){return this["#element"].muted=!0,this["#element"].play()}}pause(){this["#element"].pause()}}R.declareSystemVisualType(Ct,{name:"MediaVisual",visual:{name:"MediaVisual",inner:!0,tags:["video","audio"],classes:"media-visual"}});class It extends g{get max(){return this["#element"].max}set max(e){this["#element"].max=e}get value(){return this["#element"].value}set value(e){this["#element"].value=e}}R.declareSystemVisualType(It,{name:"ProgressVisual",visual:{name:"ProgressVisual",inner:!0,tags:"progress",classes:"progress-visual"}});class At extends g{get text(){return $(this["#element"].value)}set text(e){this["#element"].value=e}get selectedIndex(){return this["#element"].selectedIndex}set selectedIndex(e){e!=this.selectedIndex&&(this["#element"].selectedIndex=e,this.$trigger("change"))}get selectedItem(){var e=this["#element"].selectedIndex;return-1!=e&&(e=this.$getChildAt(e))?e["#data"]:null}set selectedItem(t){let e;e=null==t?-1:t instanceof Dt?this.$getChildren().indexOf(t):this.$getChildren().findIndex(e=>h.primitiveEquals(t,e["#data"])),this.selectedIndex=e}get readonly(){return this.$hasState("readonly")}set readonly(e){this.$setState("readonly",e)}get required(){return this.$hasState("required")}set required(e){this.$setState("required",e)}get items(){return this.$getChildren().map(e=>e["#data"])}get value(){return this["#element"].value}set value(e){this["#element"].value=$(e)}get options(){return this.$getChildren(Dt)}set options(e){var t;e&&(t=this.value,this.$clear(),p(e)||Ue.$isMapable(e)||e[Symbol.iterator]?this.$addOptions(e):this.$addSingleOption(e),this.value=t,-1==this.selectedIndex)&&(this.selectedIndex=0)}get hasError(){return!this["#element"].validity.valid}get errorMessage(){return this["#element"].validationMessage}$addSingleOption(e,t,i){null==t&&(t=$(e));var n=new Dt;n.text=t,F(n,"#data",e),null==i?this.$append(n):this.$insert(n,i)}$addOptions(e){if(Ue.$isMapable(e))for(var[t,i]of Ue.$toEntries(e))this.$addSingleOption(t,i);else if(e[Symbol.iterator])for(var n of e)this.$addSingleOption(n)}$removeOption(t){var e;return null!=t&&null!=(e=this.$getChildren().find(e=>h.primitiveEquals(t,e["#data"])))?e.$remove():void 0}$verify(){var e;if(!this.readonly&&!this.disabled&&(this.$hasState("required")&&-1==this.selectedIndex))return e=T.Verify_Message_Required,this["#element"].setCustomValidity(e),this.focus(),e;return this["#element"].setCustomValidity(""),null}verify(){return this.$verify()}}R.declareSystemVisualType(At,{name:"SelectVisual",visual:{name:"SelectVisual",inner:!0,tags:"select",classes:"select-visual"}});class Dt extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e||""}get data(){return this["#data"]}}R.declareSystemVisualType(Dt,{name:"OptionVisual",visual:{name:"OptionVisual",inner:!0,tags:"option",classes:"option-visual"}});class kt extends g{}R.declareSystemVisualType(kt,{name:"TableVisual",visual:{name:"TableVisual",inner:!0,tags:"table",classes:"table-visual"}});class Nt extends g{get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e||""}}R.declareSystemVisualType(Nt,{name:"CaptionVisual",visual:{name:"CaptionVisual",inner:!0,tags:"caption",classes:"caption-visual"}});class _t extends g{}R.declareSystemVisualType(_t,{name:"TableBodyVisual",visual:{name:"TableBodyVisual",inner:!0,tags:"tbody",classes:"tbody-visual"}});class Bt extends g{}R.declareSystemVisualType(Bt,{name:"TableHeadVisual",visual:{name:"TableHeadVisual",inner:!0,tags:"thead",classes:"thead-visual"}});class Mt extends g{}R.declareSystemVisualType(Mt,{name:"TableRowVisual",visual:{name:"TableRowVisual",inner:!0,tags:"tr",classes:"tr-visual"}});class Ot extends g{get align(){return this["#element"].style.textAlign||"start"}set align(e){this["#element"].style.textAlign=e}get rowIndex(){var e=super.$getParent();return null==e?-1:e.rowIndex}get cellIndex(){return this["#element"].cellIndex-1}}R.declareSystemVisualType(Ot,{name:"TableCellVisual",visual:{name:"TableCellVisual",inner:!0,tags:"td",classes:"td-visual"}});class Pt extends g{}R.declareSystemVisualType(Pt,{name:"TableHeadCellVisual",visual:{name:"TableHeadCellVisual",inner:!0,tags:"th",classes:"th-visual"}});class Ft extends g{get text(){return this["#element"].value}set text(e){this["#element"].value=e||""}get value(){return this["#element"].value}set value(e){this["#element"].value=e||""}get readonly(){return this.$hasState("readonly")}set readonly(e){this.$setState("readonly",e)}get placeholder(){return this["#element"].placeholder}set placeholder(e){this["#element"].placeholder=e||""}get hasError(){return!this["#element"].validity.valid}get errorMessage(){return this["#element"].validationMessage}focus(e=!1){this["#element"].focus(),e&&this.selectAll()}blur(){this["#element"].blur()}get selectionStart(){return this["#element"].selectionStart}set selectionStart(e){this["#element"].selectionStart=e}get selectionEnd(){return this["#element"].selectionEnd}set selectionEnd(e){this["#element"].selectionEnd=e}selectAll(){this["#element"].setSelectionRange(0,this["#element"].value.length)}unselectAll(){var e=this["#element"].selectionStart;this["#element"].setSelectionRange(e,e)}selectRange(e,t){this["#element"].setSelectionRange(e,t)}$verify(){return this.readonly||this.disabled||!this.hasError?null:(this["#element"].reportValidity(),this.focus(),this["#element"].validationMessage||"出错")}verify(){return this.$verify()}}R.declareSystemVisualType(Ft,{name:"TextAreaVisual",visual:{inner:!0,tags:"textarea",classes:["textarea","textarea-visual"]}});{let i;function $e(e){let t;(t=e==globalThis.document.documentElement?null:function(e){let t=e;for(;null!=t;){if(C.hasVisual(t)){var i=C.getVisual(t);if(i instanceof v)return i}t=t.parentElement}return null}(e))!=i&&(null!=i&&i.$trigger("global:leave"),null!=t&&t.$trigger("global:enter"),i=t)}globalThis.document.documentElement.addEventListener("focusin",e=>{$e(e.target)}),globalThis.document.documentElement.addEventListener("mousedown",e=>{$e(e.target)})}class v extends g{constructor(e){super(e),this.$on("focus",e=>this.$invokeDataEvent("enter")),this.$on("blur",e=>this.$invokeDataEvent("leave")),this.$on("global:enter",e=>{this.$onBeforeEnter&&this.$onBeforeEnter(e),this.$invokeDataEvent("enter")}),this.$on("global:leave",e=>{this.$onBeforeLeave&&this.$onBeforeLeave(e),this.$invokeDataEvent("leave")}),this.$on("keydown",e=>{this.$invokeDataEvent("keyDown",new Qe(e))}),this.$on("keyup",e=>{this.$invokeDataEvent("keyUp",new Qe(e))}),this.$on("mousedown",e=>{this.$$checkDirectContains(e.target)&&this.$invokeDataEvent("mouseDown",new t(e))}),this.$on("mousemove",e=>{this.$$checkDirectContains(e.target)&&this.$invokeDataEvent("mouseMove",new t(e))}),this.$on("mouseup",e=>{this.$$checkDirectContains(e.target)&&this.$invokeDataEvent("mouseUp",new t(e))}),this.$on("click",e=>{this.$$checkDirectContains(e.target)&&this.$invokeDataEvent("click")}),this.$on("dragstart",e=>{this.$$checkDirectContains(e.target)&&(this["#draggable"]?this.$invokeDataEvent("dragStart",new rt(e)):e.preventDefault())}),this.$on("dragenter",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation(),this.$invokeDataEvent("dragEnter",new nt(e)))}),this.$on("dragover",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation(),this.$invokeDataEvent("dragOver",new nt(e)))}),this.$on("dragleave",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation(),this.$invokeDataEvent("dragLeave",new nt(e)))}),this.$on("drop",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation(),this.$invokeDataEvent("dragDrop",new nt(e)))})}get click(){return this.$getDataEvent("click")}get enter(){return this.$getDataEvent("enter")}get leave(){return this.$getDataEvent("leave")}get keyDown(){return this.$getDataEvent("keyDown")}get keyUp(){return this.$getDataEvent("keyUp")}get mouseDown(){return this.$getDataEvent("mouseDown")}get mouseMove(){return this.$getDataEvent("mouseMove")}get mouseUp(){return this.$getDataEvent("mouseUp")}get dragStart(){return this.$getDataEvent("dragStart")}get dragEnter(){return this.$getDataEvent("dragEnter")}get dragOver(){return this.$getDataEvent("dragOver")}get dragLeave(){return this.$getDataEvent("dragLeave")}get dragDrop(){return this.$getDataEvent("dragDrop")}get allowDrag(){return this["#draggable"]}set allowDrag(e){this["#draggable"]=e}get allowDrop(){return this["#dropable"]}set allowDrop(e){this["#dropable"]=e}$$checkDirectContains(e){let t=e;for(;null!=t;){if(t==this["#element"])return!0;if(null!=t["#visualTag"]&&t["#visualTag"]instanceof v)return!1;t=t.parentElement}return!1}$removeMenu(e){e.$off("ui:menu-show"),e.$off("ui:menu-hide")}$bindMenu(e){e.$on("ui:menu-show",e=>{this.$trigger("by:unit-menuopened")}),e.$on("ui:menu-hide",e=>{this.$trigger("by:unit-menuclosed")})}$onBeforeLeave(e){}$onBeforeEnter(e){}get contextMenu(){return this["#contextmenu"]}set contextMenu(e){null!=this["#contextmenu"]&&this.$removeMenu(this["#contextmenu"]),e&&(this.$bindMenu(e),this.$on("contextmenu",e=>{e.preventDefault(),this["#contextmenu"].$show(e.pageX,e.pageY)})),this["#contextmenu"]=e}remove(){this.$remove()}bringToFront(){if(null!=this["#controlParent"]){var t,i=this["#element"].parentElement;this["#element"].remove();let e=-1;for(t of i.children){var n=window.getComputedStyle(t).zIndex;"auto"!=n&&(n=Number(n))>e&&(e=n)}this.zIndex=Math.max(1,e+1),i.append(this["#element"])}else{i=this["#element"].parentElement;d.ZIndexHelper.setToTopMost(this),null!=i&&(this["#element"].remove(),i.append(this["#element"]))}}sendToBack(){var e=this["#element"].parentElement;this.zIndex=0,null!=e&&(this["#element"].remove(),e.prepend(this["#element"]))}$$loadTableControl(e){F(this,"#table$ctrl",e)}get["#dataTable"](){var e;return null!=this["#table$ctrl"]?this["#table$ctrl"]["#table"]:null!=(e=this.$identity())&&(e=O.$getBindTo(e))instanceof V?e:null}set toolTip(e){var t=this["#element"].dataset.tooltip||null;this["#element"].dataset.tooltip=(e=e||null)||"",null==e&&null==t||null!=e&&null!=t||(null==t?(t=this["#cb_cache_hover"]=e=>{var t=this["#element"].dataset.tooltip;Rt.checkIsHost(this)||Rt.showToolTip(this,t)},this.$on("mouseenter",t),t=this["#cb_cache_hover_leave"]=e=>{Rt.closeToolTip(this)},this.$on("mouseleave",t)):null==e&&(null!=(t=this["#cb_cache_hover"])&&(this.$off("mouseenter",t),this["#cb_cache_hover"]=null),null!=(e=this["#cb_cache_hover_leave"]))&&(this.$off("mouseleave",e),this["#cb_cache_hover_leave"]=null))}get toolTip(){return this["#element"].dataset.tooltip||null}}R.declareSystemVisualType(v,{name:"Control",visual:{classes:"by-control"}});class Rt extends v{static checkIsHost(e){var t=Rt["#instance"];return null!=t&&t["#tipHost"]==e}static closeToolTip(e){var t=Rt["#instance"];null!=t&&t["#tipHost"]==e&&t.close()}static showToolTip(e,t,i){let n;return(n=null==Rt["#instance"]?Rt["#instance"]=new Rt:Rt["#instance"]).show(e,t,i)}get text(){return this["#element"].style.getPropertyValue("--tip-content")}set text(e){this["#element"].style.setProperty("--tip-content",`'${e}'`)}show(e,t,i=4e3){this["#element"].dataset.bytIgnoreZindex="true",this.$setAttribute("data-byt-ignore-zindex",!0);this["#element"].style.setProperty("--tip-root-width","0px"),this["#element"].style.setProperty("--tip-root-height","0px"),this["#tipHost"]=e,this.text=t,this.$addClass("by-tooltip-show"),document.body.append(this["#element"]);let n=this["#tipHost"]["#element"].getBoundingClientRect().top+this["#tipHost"]["#element"].getBoundingClientRect().height;e=this["#tipHost"]["#element"].getBoundingClientRect().left;let r=!1,s=this["#tipHost"]["#element"];for(;null!=s&&s!=document.body&&!r;)(s.getBoundingClientRect().top+s.getBoundingClientRect().height+1<n||s.className.includes("by-dialog")&&s.getBoundingClientRect().top+s.getBoundingClientRect().height-40<n)&&(r=!0),s=s.parentElement;(n+40>window.innerHeight||r)&&(n=this["#tipHost"]["#element"].getBoundingClientRect().top-this["#tipHost"]["#element"].getBoundingClientRect().height),this.top=n+window.scrollY,this.left=e+window.scrollX,null!=this["#closeTimer"]&&d.clearTimeout(this["#closeTimer"]),this["#closeTimer"]=d.setTimeout(()=>{this.close()},i)}close(){this["#element"].remove(),this.$removeClass("by-tooltip-show"),(this["#tipHost"]=null)!=this["#closeTimer"]&&d.clearTimeout(this["#closeTimer"]),this["#closeTimer"]=null}}R.declareSystemVisualType(Rt,{name:"ToolTip",visual:{inner:!0,name:"ToolTip",class:"by-tooltip"}});class Lt extends v{constructor(e){super(e),super.$constChild("#container",new at)}get children(){return new n(this["#container"].$getChildren())}get scrollable(){return"auto"==this["#computedStyle"].overflow}set scrollable(e){this["#element"].style.overflow=e?"auto":"",this["#container"]["#element"].style.overflow=e?"auto":""}add(e){return e instanceof g?this["#container"].$append(e):e instanceof HTMLElement?(this["#container"]["#element"].append(e),!0):void 0}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this["#container"].$append(t)}insert(e,t){return this["#container"].$insert(t,e)}contains(e){return this["#container"].$contains(e,!1)}clear(){return this["#container"].$clear()}removeChildAt(e){return this["#container"].$removeAt(e)}removeChild(e){return this["#container"].$removeChild(e)}}R.declareSystemVisualType(Lt,{name:"Panel",visual:{classes:"by-panel",attrs:{"data-scrollable":"scrollable"}}});class Vt extends v{constructor(e){super(e),this.hasCellBorder=!1,this.$setRowSizesInternal(["1fr"]),this.$setColumnSizesInternal(["1fr"]),this.$adjustBlocks(1,1)}get hasCellBorder(){return!this.$hasState("table-cellborderless")}set hasCellBorder(e){this.$setState("table-cellborderless",!e)}static $convertSizesToCssTemplate(e){return e.join(" ")}static $convertSizesToRelativeFloat(t){var e,i,n=[];let r=0,s=0,l=0;for(e of t)e.endsWith("%")?(i=Number(e.slice(0,-1)),n[l]=i,r+=i):s++,l++;let a=(100-r)/s;a<5&&(a=5);for(let e=0;e<t.length;e++)null==n[e]&&(n[e]=a);return n}$getBlocks(){var e,t=[];for(e of this["#element"].children)t.push(C.getVisual(e));return t}$getBlockAt(e,t){e=e*this.columnCount+t,t=this["#element"].children[e];return null==t?null:C.getVisual(t)}$setRowSizesInternal(e){this["#rowSizes"]=e,this["#element"].style.gridTemplateRows=Vt.$convertSizesToCssTemplate(e)}$setColumnSizesInternal(e){this["#columnSizes"]=e,this["#element"].style.gridTemplateColumns=Vt.$convertSizesToCssTemplate(e)}$adjustBlocks(t,e){var n=document.createDocumentFragment();let i=!0;var r,s=[],l=[];for(let e=0;e<t;e++)l.push([]);for(r of this.$getBlocks()){var a=r.rowIndex,o=r.colIndex;if(t<=a||e<=o){if(!r.isEmpty){i=!1;break}s.push(r)}else l[a][o]=r}if(i){for(var u of s)u["#element"].remove();for(let i=0;i<t;i++)for(let t=0;t<e;t++){let e=l[i][t];null==e&&((e=new Ut).rowIndex=i,e.colIndex=t),n.append(e["#element"])}return this["#element"].append(n),!0}return!1}get rowCount(){return this["#rowSizes"].length}set rowCount(t){if("number"==typeof t){var e=this["#columnSizes"].length;if(0<t&&this.$adjustBlocks(t,e)){var i=this["#rowSizes"];if(t>i.length)for(let e=i.length;e<t;e++)i.push("1fr");else i.splice(t);this.$setRowSizesInternal(i)}}}get rowSizes(){return Vt.$convertSizesToRelativeFloat(this["#rowSizes"])}get columnCount(){return this["#columnSizes"].length}set columnCount(t){if("number"==typeof t){var e=this["#rowSizes"].length;if(0<t&&this.$adjustBlocks(e,t)){var i=this["#columnSizes"];if(t>i.length)for(let e=i.length;e<t;e++)i.push("1fr");else i.splice(t);this.$setColumnSizesInternal(i)}}}get columnSizes(){return Vt.$convertSizesToRelativeFloat(this["#columnSizes"])}get children(){var e,t,i=[];for(e of this.$getBlocks())e.isEmpty||null!=(t=e.$getTableChild())&&i.push(t);return new n(i)}setRowSize(e,t){var i=this["#rowSizes"];e<0||e>=i.length||"number"==typeof t&&(t<3?t=3:100<t&&(t=100),i[e]=t+"%",this.$setRowSizesInternal(i))}setColumnSize(e,t){var i=this["#columnSizes"];e<0||e>=i.length||"number"==typeof t&&(t<3?t=3:98<t&&(t=98),i[e]=t+"%",this.$setColumnSizesInternal(i))}add(n,r,s){if(null!=n){s=this.$getBlockAt(s,r);if(null!=s){if(n.$remove(),s.isEmpty)s.$setTableChild(n);else{let e=n;var l=this.$getBlocks(),a=l.length;let t=l.indexOf(s),i=s;do{var o=i.$getTableChild();if(i.$setTableChild(e),null==(e=o))break}while(t++,i=l[t],t<a);null!=e&&(r=this.rowCount,this.rowCount=r+1,this.$getBlockAt(r,0).$setTableChild(e))}return!0}}}clear(){for(var e of this.$getBlocks())e.isEmpty||(e.$getTableChild().$remove(),e.$clearTableChild())}contains(e){for(var t of this.$getBlocks())if(t.$getTableChild()==e)return!0;return!1}getChildAt(e,t){t=this.$getBlockAt(t,e);return null==t?null:t.$getTableChild()}removeChildAt(e,t){t=this.$getBlockAt(t,e);return!t.isEmpty&&(t.$getTableChild().$remove(),t.$clearTableChild(),!0)}removeChild(e){for(var t of this.$getBlocks())if(!t.isEmpty)if(t.$getTableChild()==e)return e.$remove(),t.$clearTableChild(),!0;return!1}}R.declareSystemVisualType(Vt,{name:"TableLayoutPanel",visual:{tags:"div",classes:"by-tableLayout-panel"}});class Ut extends g{constructor(e){super(e),this.rowIndex=0,this.colIndex=0}get rowIndex(){return this["#rowIndex"]}set rowIndex(e){this["#rowIndex"]=e,this["#element"].style.gridRow=e+1+" / "+(e+2)}get colIndex(){return this["#colIndex"]}set colIndex(e){this["#colIndex"]=e,this["#element"].style.gridColumn=e+1+" / "+(e+2)}get isEmpty(){return null==this["#visualChild"]}$getTableChild(){var e=this["#visualChild"];return null!=e&&e["#element"].parentElement!=this["#element"]?this["#visualChild"]=null:e}$setTableChild(e){var t=this.$getTableChild();t!=e&&(null!=t&&t["#element"].remove(),null==e?this["#visualChild"]=null:(t=C.getVisual(e),this["#visualChild"]=t,this["#element"].append(t["#element"])))}$clearTableChild(){var e=this["#element"].children;if(0<e.length)for(var t of Array.from(e))t.remove();this["#visualChild"]=null}}R.declareSystemVisualType(Ut,{name:"TableLayoutBlock",visual:{inner:!0,tags:"div",classes:"by-tableLayout-block"}});class A extends v{constructor(e){super(e),this.$constChild("#body",new at,{classes:"by-dialog-body"}),this.$constProp("#title",new st,{classes:"by-dialog-title"}),this.$constProp("#cover",new st,{classes:"by-dialog-cover"}),this["#title"].$constChild("#titlecontent",new ot,{classes:"by-dialog-titlecontent"}),this["#title"].$constChild("#titleclose",new ot,{classes:"by-dialog-titleclose"}),F(this,"#titlecontent",this["#title"]["#titlecontent"]),F(this,"#titleclose",this["#title"]["#titleclose"]),this["#titleclose"].$on("click",e=>{this.$close()}),this["#title"].$on("dblclick",e=>{e.target!=this["#titleclose"]["#element"]&&(this.isFullScreen=!this.isFullScreen)}),this["#title"].$on("mousedown",e=>{if(e.target!=this["#titleclose"]["#element"]&&!this.isFullScreen){let t=this.left,i=this.top,n=e.pageX,r=e.pageY;e=()=>{this.$off("dom:mousemove"),this.$off("wdw:blur"),this.$off("wdw:mouseup")};this.$on("dom:mousemove",e=>{e.preventDefault(),this.left=e.pageX-n+t,this.top=e.pageY-r+i}),this.$on("wdw:blur",e),this.$on("wdw:mouseup",e)}}),this.$on("mousedown",e=>{this["#isOpened"]&&this.$setTopMost()})}$bindIdentity(e){if(null!=e){super.$bindIdentity(e);e=O.$getIdentityDialogControl(e,Object.getPrototypeOf(this).constructor);if(null!=e)for(var[t,i]of M(e))this["##dialog_props"][t].$$loadTableControl(i);return this}}get dialogClosed(){return this.$getDataEvent("dialogClosed")}get dialogClosing(){return this.$getDataEvent("dialogClosing")}get["#isFree"](){var e=this["#element"].parentElement;return null==e||e==document.body}get["#isOpened"](){return this.$hasState("opened")}get isEmbeded(){return!this["#isFree"]}get isTopMost(){return d.ZIndexHelper.getIsTopMost(this)}set isTopMost(e){e&&this.$setTopMost()}get left(){return super.left}set left(e){var t=this.width,i=window.innerWidth;this["#data_left"]=super.left=e=i<(e=e<=0?0:e)+t?i-t:e,this["#style"].right=""}get top(){return super.top}set top(e){var t=this.height,i=window.innerHeight,n=document.documentElement.offsetHeight,i=n<i?i:n;super.top=e=i<(e=e<=0?0:e)+t?i-t:e,this["#data_top"]=e}get text(){return this["#titlecontent"].text}set text(e){this["#titlecontent"].text=e}get isFullscreen(){return this.isFullScreen}set isFullscreen(e){this.isFullScreen=e}get isFullScreen(){return this.$hasState("fullscreen")}set isFullScreen(e){this["#isFree"]&&(this.$setState("fullscreen",e),this["#title"].$setState("fullscreen",e),this["#body"].$setState("fullscreen",e),e?A.$enableGlobalFullscreen():A.$checkAndDisableGlobalFullscreen(),super.top=document.documentElement.scrollTop,super.left=document.documentElement.scrollLeft)}get scrollable(){return this.$hasState("scrollable")}set scrollable(e){this.$setState("scrollable",e)}get children(){return new n(this["#body"].$getChildren())}$0(){}$fillChildren(e){for(var t of e)this["#body"].$append(t)}$open(e=!1){var t,i,n;if(super.hidden=!1,!globalThis.document.contains(this["#element"]))return this.$setState("opened",!0),this.$setState("opened-modal",e),this.$setState("popup",!0),this.$prepend(this["#title"]),e&&document.body.append(this["#cover"]["#element"]),document.body.append(this["#element"]),this.$setTopMost(),this["#element"].style.position="absolute",t=window.innerHeight,i=window.innerWidth,n=0|A.$assign$zDepth(this),this.isFullScreen?(super.top=document.documentElement.scrollTop,super.left=document.documentElement.scrollLeft):(super.left=(i-this.width)/2+n,super.top=(t-this.height)/2+document.documentElement.scrollTop+n),A.$$registerOpenedDialog(this),e?(null!=document.activeElement&&document.activeElement.blur(),new Promise((t,e)=>{this.$on("ui:dialog-afterclose",e=>{t(!0)})})):void 0}$close(){if(this.$hasState("opened")){let e=new Ge;return Promise.resolve(this.$invokeDataEvent("dialogClosing",e)).then(()=>{e.cancel||(this.$setState("opened",!1),this.$setState("popup",!1),this["#title"].$remove(),this.isFullScreen&&(this.isFullScreen=!1),this["#cover"].$remove(),this.$remove(),A.$$unregisterOpenedDialog(this),this.$invokeDataEvent("dialogClosed"),this.$trigger("ui:dialog-closed"),this.$trigger("ui:dialog-afterclose"))})}}$setTopMost(){this.$hasState("opened-modal")&&d.ZIndexHelper.setToTopMost(this["#cover"]),d.ZIndexHelper.setToTopMost(this)}static $$registerOpenedDialog(e){null==A["##openedDialogs"]&&(A["##openedDialogs"]=[]),A["##openedDialogs"].push(e)}static $$unregisterOpenedDialog(e){null!=A["##openedDialogs"]&&0<=(e=A["##openedDialogs"].indexOf(e))&&A["##openedDialogs"].splice(e,1)}static $assign$zDepth(e){void 0!==A["##zDepth#timer"]&&d.clearTimeout(A["##zDepth#timer"]);let t;var i;return t=void 0===A["##zDepth"]?0:0<(i=A["##zDepth"])?-i:5-i,A["##zDepth"]=t,A["##zDepth#timer"]=d.setTimeout(()=>A["##zDepth"]=void 0,3e4),t}close(){this["#isFree"]&&this.$close()}hide(){super.hide()}show(){if(!this["#isFree"])return super.show();this.$hasState("opened")?(this.$setTopMost(),super.show()):this.$open()}showDialog(){return this["#isFree"]?this.$hasState("opened")?(this.$setTopMost(),void super.show()):this.$open(!0):super.show()}add(e){return this["#body"].$append(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this["#body"].$append(t)}insert(e,t){return this["#body"].$insert(t,e)}contains(e){return this["#body"].$contains(e)}clear(){return this["#body"].$clear()}removeChildAt(e){return this["#body"].$removeAt(e)}removeChild(e){return this["#body"].$removeChild(e)}static $enableGlobalFullscreen(){document.body.classList.add("by-global-fullscreen")}static $checkAndDisableGlobalFullscreen(){null==document.querySelector(".by-fullscreen")&&document.body.classList.remove("by-global-fullscreen")}}window.addEventListener("resize",()=>{if(null!=A["##openedDialogs"]){var e,t=window.innerWidth,i=window.innerHeight;for(e of A["##openedDialogs"]){var n=e["#data_top"]||e.top,n=(80<n+e.height-i?(e["#data_top"]=n,e["#style"].top=3):e.top=e["#data_top"],e["#data_left"]||e.left);0<n+e.width-t?(e["#data_left"]=n,e["#style"].left="",e["#style"].right=0):(e["#style"].right="",e.left=e["#data_left"])}}}),R.declareSystemVisualType(A,{name:"Dialog",alias:"dialog",classes:"by-dialog",attrs:{"data-scrollable":"scrollable",fullscreen:"isFullScreen"}});class Ht extends A{$0(){}static getMergeDialog(e){return e instanceof A?e["#host"]:null}}R.declareSystemVisualType(Ht,{name:"Manager",alias:"manager",visual:{classes:"by-manager"}});const jt=(()=>{function i(e){var t=e["#type"],i=e["#field"]["#verify"],n=e["#settings"],r=a(t,n.isArray);if(null!=i){for(var[s,l]of M(i))"notNull"==s&&l?r.required=!0:s in r&&(r[s]=l);t==$&&(null==i.maxLength&&null!=i.max&&(r.maxLength=i.max),null==i.minLength)&&null!=i.min&&(r.minLength=i.min)}return n.readonly&&(r.readonly=!0),new o(e,r)}function n(e){var t,i,n=e["#type"],r=e["#settings"];return"between"==r.operator?(t=a(n,r.isArray),i=a(n,r.isArray),new s(e,[t,i])):new o(e,a(n,r.isArray))}function a(e,t){let i;if(e==Boolean||e==Y?i=[!0,!1]:R.isEnumType(e)&&(i=e.$values()),null!=i||t)return(t=new At).options=i,t;switch(e){case String:case $:return new bt;case Date:case Se:return new ft;case r:var n=new bt;return n.minLength=n.maxLength=1,n;case J:case G:case X:case l:n=new $t;return n.step=1,n;case Q:case Z:case Number:case c:n=new $t;return n.step="any",n}return new bt}class o extends g{constructor(e,t){super(),t=t||new bt,F(this,"#source",e),F(this,"#type",e?e.type:$),this.$constChild("#innerBox",t),t.$on("change",e=>this.$trigger("ui:sourcebox-change",{origin:e})),t.$on("focus",e=>this.$trigger("ui:sourcebox-focus",{origin:e})),t.$on("blur",e=>this.$trigger("ui:sourcebox-blur",{origin:e}))}$getHeightInternal(){return this["#innerBox"]["#element"].offsetHeight}$setHeightInternal(e,t=!1){this["#innerBox"]["#style"].height=t?e+"%":d.PixelUnitHelper.lengthToPixel(e)}$getWidthInternal(){return this["#innerBox"]["#element"].offsetWidth}$setWidthInternal(e,t=!1){this["#innerBox"]["#style"].width=t?e+"%":d.PixelUnitHelper.lengthToPixel(e)}get data(){var e=this["#innerBox"].value;return this["#type"](e)}set data(e){this["#innerBox"].value=$(e)}get value(){return this.data}set value(e){this.data=e}get readonly(){return this["#innerBox"].readonly}set readonly(e){this["#innerBox"].readonly=!!e}get isFocused(){return this["#innerBox"].isFocused}get hasError(){return this["#innerBox"].hasError}get errorMessage(){return this["#innerBox"].errorMessage}$bindLabel(e){return e.bindTarget=this["#innerBox"]}$refreshDataCollection(e){var t;this["#innerBox"]instanceof At&&null!=e&&(t=this["#innerBox"].value,t=(e=e instanceof Array?e:k(e)).includes(t)?t:e[0],this["#innerBox"].options=e,this["#innerBox"].value=t)}$report(){var e=this["#innerBox"]["#element"];null!=e&&"function"==typeof e.reportValidity&&e.reportValidity()}verify(){return this.$verify()}$verify(){return this["#innerBox"].$verify()}focus(e){this["#innerBox"].focus(e)}blur(){this["#innerBox"].blur()}}class s extends g{constructor(e,t){super();let[i,n]=t;F(this,"#source",e),F(this,"#type",e.type),this.$constChild("#upperBox",i),this.$constChild("#lowerBox",n),i.$on("change",e=>{this.$trigger("ui:sourcebox-change",{origin:e})}),i.$on("blur",e=>{this.__lastblur=Date.now(),n.isFocused||this.$trigger("ui:sourcebox-blur",{origin:e})}),i.$on("focus",e=>{(null==this.__lastblur||100<Date.now()-this.__lastblur)&&this.$trigger("ui:sourcebox-focus",{origin:e})}),n.$on("change",e=>this.$trigger("ui:sourcebox-change",{origin:e})),n.$on("blur",e=>{this.__lastblur=Date.now(),i.isFocused||this.$trigger("ui:sourcebox-blur",{origin:e})}),n.$on("focus",e=>{(null==this.__lastblur||100<Date.now()-this.__lastblur)&&this.$trigger("ui:sourcebox-focus",{origin:e})})}get["#upperEmpty"](){var e=this["#upperBox"].value;return""==e||null==e}get["#lowerEmpty"](){var e=this["#lowerBox"].value;return""==e||null==e}get data(){var e=this["#upperBox"].value,t=this["#lowerBox"].value;return null==e||""==e||null==t||""==t?null:[e,t]}set data(e){e instanceof Array?(this["#upperBox"].value=e[0],this["#lowerBox"].value=e[1]):this["#upperBox"].value=this["#lowerBox"].value=e}get value(){return this.data}set value(e){this.data=e}get readonly(){return this["#upperBox"].readonly}set readonly(e){this["#upperBox"].readonly=this["#lowerBox"].readonly=!!e}get isFocused(){return this["#upperBox"].isFocused||this["#lowerBox"].isFocused}get hasError(){return this["#upperEmpty"]!=this["#lowerEmpty"]}get errorMessage(){return this["#upperBox"].errorMessage||this["#lowerBox"].errorMessage}$bindLabel(e){e.bindTarget=this["#upperBox"]}$verify(){var e=this["#upperBox"].value,t=this["#lowerBox"].value,e=""==e||null==e;return e==(""==t||null==t)?null:((e?this["#upperBox"]:this["#lowerBox"]).focus(),new je(!1,"between必须同时非空"))}$report(){var e=this.hasError?"between必须同时非空":"";let t=this["#upperBox"]["#element"],i=this["#lowerBox"]["#element"];"function"==typeof t.setCustomValidity&&t.setCustomValidity(e),"function"==typeof i.setCustomValidity&&i.setCustomValidity(e),e&&("function"==typeof t.reportValidity&&t.reportValidity(),"function"==typeof i.reportValidity&&i.reportValidity(),d.setTimeout(()=>{"function"==typeof t.setCustomValidity&&t.setCustomValidity(""),"function"==typeof i.setCustomValidity&&i.setCustomValidity("")},3e3))}focus(e){this["#upperBox"].focus(e)}blur(){this["#upperBox"].blur(),this["#lowerBox"].blur()}}return R.declareSystemVisualType(o,{name:"DataSourceEditingBox",visual:{classes:"by-datasource-box"}}),R.declareSystemVisualType(s,{name:"DataSourceTwinEditingBox",visual:{classes:"by-datasource-twinbox"}}),{DataSourceEditingBox:o,DataSourceTwinEditingBox:s,createDataSourceBox:function(e,t){return null==e?new o:(t?n:i)(e)},createQueryBox:n,createEditingBox:i,createEmptySourceBox(){return new o}}})();class zt extends g{constructor(e,t){super(e),null==t&&(t=jt.createEmptySourceBox()),this.$constChild("#label",new wi),this.$constChild("#sourceBox",t),t.$bindLabel(this["#label"]),this["#sourceBox"].$on("ui:sourcebox-focus",e=>this.$enterEditing()),this["#sourceBox"].$on("ui:sourcebox-blur",e=>this.$quitEditing()),this["#sourceBox"].$on("keydown",e=>{"Enter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),null==this.$verify(!0)&&(this.$quitEditing(),this.$bubble("ui:areaunit-editnext",{origin:e,shiftKey:e.shiftKey})))})}get["#source"](){return this["#sourceBox"]["#source"]}get["#isEditing"](){return this.$hasState("editing")}get field(){var e=this["#sourceBox"]["#source"],e=e?e.accessfield:null;return e instanceof U?e:null}get text(){return this["#label"].text}set text(e){this["#label"].text=e}get readonly(){return this["#sourceBox"].readonly}set readonly(e){this["#sourceBox"].readonly=!!e}get value(){return this["#sourceBox"].data}set value(e){this["#sourceBox"].data=e}$enterEditing(){this.$hasState("editing")||(this.$setState("editing",!0),this.$bubble("ui:areaunit-editbegin"))}$quitEditing(){this.$hasState("editing")&&(this.$setState("editing",!1),this.$bubble("ui:areaunit-editend"))}$verify(){return this.readonly||this.isDisabled?null:this["#sourceBox"].$verify(!0)}$report(){this["#sourceBox"].$report(),this["#sourceBox"].focus(!0)}focus(){this["#sourceBox"].focus(),this.$enterEditing()}init(){this.value=null}}R.declareSystemVisualType(zt,{name:"AreaUnit",visual:{classes:"by-areaunit",attrs:{image:"image","data-image":"image"}}});class Kt extends v{constructor(e){super(e),this.$constChild("#form",new ht),this["#form"].$constChild("#fieldset",new ut),F(this,"#fieldset",this["#form"]["#fieldset"]),this["#fieldset"].$constChild("#legend",new dt),F(this,"#legend",this["#fieldset"]["#legend"]),this.$on("ui:areaunit-editnext",e=>{var t=e.detail.source,i=this["#fieldset"].$getChildren(),n=i.length,r=this["#fieldset"].$getChildIndex(t),s=e.detail.shiftKey?-1:1;let l;for(let e=-1==r?0:r+s;e!=r;e+=s){e<0?e=n+e:e>=n&&(e-=n);var a=i[e];if(null!=a&&!a.disabled&&!a.readonly&&!a.hidden){l=a;break}}null!=l&&l.focus()})}$getHeightInternal(){return this["#form"].height}$setHeightInternal(e,t=!1){this["#fieldset"].isHeightFilled=!0,this["#form"].$setHeightInternal(e,t)}$getWidthInternal(){return this["#form"].width}$setWidthInternal(e,t){this["#form"].$setWidthInternal(e,t),this["#fieldset"].$setState("filled",!0),t&&this["#form"].$setState("filled",t)}get text(){return this["#legend"].text}set text(e){this["#legend"].text=e}get units(){return new n(this.$getUnits())}get currentUnit(){return this["#fieldset"].$getChildren().find(e=>e["#isEditing"])||null}$fillChildren(e){for(var t of e)this["#fieldset"].$append(t)}$getUnits(){return this["#fieldset"].$getChildren()}init(){for(var e of this["#fieldset"].$getChildren())e.init()}verify(){return this.$verify()}$verify(){for(var e of this["#fieldset"].$getChildren()){var t=e.$verify();if(t&&!t.isOk)return e.$report(),t}return new je(!0)}}R.declareSystemVisualType(Kt,{name:"Area",visual:{classes:"by-area"}});class qt extends zt{$verify(){return null==super.$verify()||null==this["#source"]?new je(!0):this["#source"].$verify(this.value)}$refreshAction(e,t){var i=this["#source"];null!=i&&(i=i.$checkCanEdit(e),this.isDisabled=!i,t)&&i&&this.$callSource(e)}$callSource(e){this["#source"]&&this["#source"].$checkCanCall(e)&&this.$refreshData(this["#source"].$call())}$refreshData(e,t=!1){if(e instanceof Promise)return e.then(e=>this.$refreshData(e,t));var i=e,e=e instanceof Array?e[0]:e;this["#sourceBox"].data=e,this["#sourceBox"].$refreshDataCollection(i)}static $createFromSource(e){var t=jt.createEditingBox(e),t=new qt(null,t),{text:i,readonly:n,visible:r}=e?e["#settings"]:{};return n&&(t.readonly=!0),!1===r&&(t.hidden=!0),i?t.text=i:e&&(t.text=e.name),t}}R.declareSystemVisualType(qt,{name:"EditAreaUnit",visual:{classes:"by-editareaunit"}}),R.declareSystemVisualType(class extends Kt{constructor(e){super(e),this.$on("ui:areaunit-editbegin",e=>this.$invokeDataEvent("unitEditBegin",new Je(e))),this.$on("ui:areaunit-editend",e=>this.$invokeDataEvent("unitEditEnd",new Je(e)))}get unitEditBegin(){return this.$getDataEvent("unitEditBegin")}get unitEditEnd(){return this.$getDataEvent("unitEditEnd")}get editAction(){return this["#element"].dataset.action||"insert"}set editAction(e){(e=$(e))==this["#element"].dataset.action||"insert"!=e&&"update"!=e||this.$refreshAction(e,!0)}$refreshAction(e,t=!1){for(var i of this["#fieldset"].$getChildren())i.$refreshAction(e,t);this["#element"].dataset.action=e}getEditingData(){var e=this["#bindRow"],t=O.$getBindTo(this.$identity());if(!(t instanceof V))throw new m(T.Control_Missing_Table);let i,n;if(null==e){if(i=[],n=[],null!=t)for(var r of t["#fields"])i.push(r),n.push(null);for(var s of this["#fieldset"].$getChildren()){var l=s["#source"].accessfield,s=s.value,a=i.indexOf(l);-1==a?(i.push(l),n.push(s)):n[a]=s}}else{i=Array.from(e["#fields"]),n=e["#cells"].map(e=>e.value);for(var o of this["#fieldset"].$getChildren()){var u=e.$getIndexBySource(o["#source"]);0<=u&&(o=o.value,n[u]=""==o?null:o)}}return new H(t,i,n)}setEditingData(e){if(e instanceof H){this["#bindRow"]=e;for(var t of this["#fieldset"].$getChildren()){var i=e.$getCellBySource(t["#source"]);null!=i&&(t.value=i.value)}}}setEditingValueRelationally(e,t){if(null!=this["#table$ctrl"]){var i,n,r=this["#dataTable"],s=this["#table$ctrl"].sources,l=this["#fieldset"].$getChildren();for([i,n]of V.$findSourceRelationAssignPairs(r,s,e,t,!0)){var a=l[i];null!=a&&null!=n&&(a.value=n.value)}}}$$loadTableControl(e){var t;super.$$loadTableControl(e);for(t of e["#sources"]){var i=qt.$createFromSource(t);this["#fieldset"].$append(i)}this.$refreshAction("insert",!1)}},{name:"EditArea",visual:{classes:"by-editarea",attrs:{"data-action":"editAction"},childInfo:qt}});class Wt extends zt{get operator(){return this["#operator"]}static $createFromSource(e){var t=jt.createQueryBox(e),t=new Wt(null,t),{text:e,operator:i,readonly:n,visible:r}=e?e["#settings"]:{};return i&&F(t,"#operator",i),n&&(t.readonly=!0),!1!==r&&null!==r||(t.hidden=!0),e&&(t.text=e),t}}R.declareSystemVisualType(Wt,{name:"QueryAreaUnit",visual:{classes:"by-queryareaunit"}}),R.declareSystemVisualType(class extends Kt{get data(){var e=this["#dataTable"];if(null==e)throw new y("QueryArea.data",T.QueryData_Missing_Table);var t,i=[],n=[];for(t of this.$getUnits())i.push(t["#source"]),n.push(t.value);return We.$create(e,i,n)}$$loadTableControl(e){super.$$loadTableControl(e);for(var t of e.sources)this["#fieldset"].$append(Wt.$createFromSource(t))}},{name:"QueryArea",visual:{classes:"by-queryarea",childInfo:Wt}});class b extends Ot{constructor(e){super(e),this.$constChild("#text",new ot),this.$on("click",e=>this.$bubble("ui:cell-click")),this.$on("dblclick",e=>this.$bubble("ui:cell-dblclick")),this.$on("mousedown",e=>{0==e.button&&this.$bubble("ui:cell-mousedown",{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey})}),this.$on("mouseup",e=>{var t;0==e.button&&(null==(t=this.$getParent(Xt))||t["#mouseActived"])&&(this.$bubble("ui:cell-needselect",{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}),this.$hasState("allowEdit"))&&(this["#canActiveEdit"]?this["#isCellEditing"]||(this.$bubble("ui:cell-beforeedit"),this.$beginCellEditing()):null!=(t=this["#gridrow"])&&t.$beginRowEditing())}),this.$on("keydown",e=>{this["#isCellEditActive"]&&(this["#isCellEditing"]?"Esc"==e.key||"Escape"==e.key?this.$bubble("ui:cell-quitedit",{origin:e}):"Enter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),this.$endCellEditing(),this.$bubble("ui:cell-editnext",{origin:e,shiftKey:e.shiftKey})):"Enter"==e.key||"Tab"==e.key?(e.preventDefault(),this["#canActiveEdit"]&&this.$beginCellEditing()):"Delete"==e.key&&this.$bubble("ui:cell-editdelete"))})}get["#cellIndex"](){var e=this.$getParent();return e?e.$getChildIndex(this):-1}get["#column"](){var e,t=this["#cellIndex"];return-1==t||null==(e=this.$getParent(Xt))?null:e.$getColumnAt(t)}get["#gridrow"](){return this.$getParent(Yt)}get["#isCellEditActive"](){return this.$hasState("cellEditActive")}get["#isCellEditing"](){return this.$hasState("cellEditing")}get["#canActiveEdit"](){var e;return!!this.$hasState("allowEdit")&&!this.$hasState("readonly")&&(null==(e=this["#source"])||e.$checkCanEdit(this["#action"]||"update"))}get isEditing(){return this["#isCellEditing"]}get text(){return this["#text"].text}set text(t){var i=this["#source"]?this["#source"]["#type"]:null;if(null==i)return this.$refreshData(t=null==t?"":t);{let e;if(null==(e="function"==typeof i.$parse?i.$parse(t):"function"==typeof i.parse?i.parse(t):h.primitiveCast(i,t)))throw new y("parse",type,t);this.$refreshData(e)}}get value(){return null!=this["#dataTarget"]?this["#dataTarget"].value:null}set value(e){return null!=this["#dataTarget"]?this["#dataTarget"].value=e:null}get readonly(){return this.$hasState("readonly")}set readonly(e){this.$setState("readonly",e)}get align(){return this["#element"].style.textAlign||"start"}set align(e){this["#element"].style.textAlign=e}get owningRow(){return this["#gridrow"]}get owningColumn(){return this["#column"]}get dataCell(){return this["#dataTarget"]}get rowIndex(){var e=super.$getParent();return null==e?-1:e.rowIndex}get columnIndex(){return this["#cellIndex"]}$refreshData(e,t=!1,i=!1){if(e instanceof Promise)return e.then(e=>this.$refreshData(e,t,i));var n=this["#_cached_data"];let r;e instanceof Array?(this["#_cached_data_collection"]=e,null!=this["#sourceBox"]&&this["#sourceBox"].$refreshDataCollection(e),r=e.includes(n)?n:e[0],this["#sourceBox"].data=r):r=e,null!=n&&(r==n||null!=r&&null!=n&&r.valueOf()==n.valueOf())||(this["#_cached_data"]=r,this["#text"].text=$(r),t||null==this["#dataTarget"]||(this["#dataTarget"].value=r),i||null==this["#sourceBox"]||(this["#sourceBox"].data=r),t&&null!=this["#source"]&&(null==(e=this["#source"].$verify(r))||e.isOk?this.$refreshError(!1):this.$refreshError(!0,"string"==typeof e?e:e.info)))}$refreshError(e,t){this.$setState("error",!!e),this["#element"].title=e?t:""}$callSource(){var e=this["#source"],t=this["#dataTarget"];e&&t&&this["#source"].$checkCanCall(this["#action"]||"update")&&this.$refreshData(e.$call())}$setEditAction(e){this["#action"]=e||"update"}$setAllowEdit(e){this.$setState("allowEdit",e),!e&&this["#isCellEditActive"]&&this.$endRowEditing()}$remove(){super.$remove(),this["#isCellEditActive"]&&this.$endRowEditing(),b.$removeDataBinding(this)}$beginRowEditing(){if(!this["#isCellEditActive"]&&this["#canActiveEdit"]){this.$setState("cellEditActive",!0);var i=this["#source"];if(null==this["#sourceBox"]){i=jt.createDataSourceBox(i,!1);i.readonly=this.readonly;let e=0,t=0;var n=this["#computedStyle"].borderTopWidth,n=("auto"!=n&&""!=n&&(n=Number.parseFloat(n),isNaN(n)||(t+=n)),this["#computedStyle"].borderBottomWidth),n=("auto"!=n&&""!=n&&(n=Number.parseFloat(n),isNaN(n)||(t+=n)),this["#computedStyle"].borderLeftWidth),n=("auto"!=n&&""!=n&&(n=Number.parseFloat(n),isNaN(n)||(e+=n)),this["#computedStyle"].borderRightWidth);"auto"!=n&&""!=n&&(n=Number.parseFloat(n),isNaN(n)||(e+=n)),e<=1&&(e=1),t<=1&&(t=1),i.width=this.width-e,i.height=this.height-t,this["#sourceBox"]=i}let t=this["#sourceBox"];null!=this["#_cached_data_collection"]&&t.$refreshDataCollection(this["#_cached_data_collection"]),null!=this["#_cached_data"]?t.data=this["#_cached_data"]:t.value=this.text,this["#text"].$remove(),this.$append(t),t.$on("ui:sourcebox-change",e=>{this.$refreshData(t.data,!1,!0)}),t.$on("ui:sourcebox-blur",e=>{this.$endCellEditing()})}}$endRowEditing(){this["#isCellEditing"]&&this.$endCellEditing(),this.$setState("cellEditActive",!1),null!=this["#sourceBox"]&&(this["#sourceBox"].$remove(),this["#sourceBox"].$off("ui:sourcebox-change"),this["#sourceBox"].$off("ui:sourcebox-focus"),this["#sourceBox"].$off("ui:sourcebox-blur"),this["#sourceBox"]=null,this.$append(this["#text"]))}$beginCellEditing(){this["#isCellEditing"]||(this["#isCellEditActive"]||this.$beginRowEditing(),this.$setState("cellEditing",!0),null!=this["#sourceBox"]&&this["#sourceBox"].focus(),this["##delayedFocusHandler"]=d.setTimeout(()=>{null!=this["#sourceBox"]&&this["#sourceBox"].focus()},5),this.$bubble("ui:cell-editbegin"))}$endCellEditing(){this["#isCellEditing"]&&(this.$setState("cellEditing",!1),null!=this["##delayedFocusHandler"]&&d.clearTimeout(this["##delayedFocusHandler"]),this["##delayedFocusHandler"]=void 0,null!=this["#sourceBox"]&&(this["#sourceBox"].blur(),this.$refreshError(this["#sourceBox"].hasError,this["#sourceBox"].errorMessage),this.$refreshData(this["#sourceBox"].data,!1,!0)),this.$bubble("ui:cell-editend"))}static $createFromData(e,t){var i=new b;return null!=e&&b.$adjustCellWithColumn(i,e),b.$setDataBinding(i,t),i}static $adjustCellWithColumn(e,t){var i=t["#source"];e["#source"]=i,e.visible=t.visible,e.readonly=t.readonly,e.disabled=t.disabled,e.width=t.width,e.align=t.align}static $setDataBinding(i,n){null!=n&&(n instanceof o?(i["#dataTarget"]=n,o.$listenCellSync(n,i["#syncCb"]=(e,t)=>i.$refreshData(n.value,!0)),i.$refreshData(n.value,!0)):i.$refreshData(n))}static $removeDataBinding(e){var t=e["#dataTarget"];t&&(o.$removeCellSync(t,e["#syncCb"]),e["#dataTarget"]=null,e["#syncCb"]=null)}}R.declareSystemVisualType(b,{name:"GridCell",visual:{tags:["td"],classes:"by-gridcell"}});class Yt extends Mt{constructor(e){super(e),this.$constChild("#header",new Pt),this["#header"].$constChild("#checkbox",new gt),F(this,"#checkbox",this["#header"]["#checkbox"]),this.$on("ui:cell-needselect",e=>{this["#isSelected"]||(this.$setSelected(!0),this.$bubble("ui:row-selectionchanged",{isSelected:!0,canDrag:!0,isReserve:e.ctrlKey,isRanged:e.shiftKey}))}),this.$on("mouseenter",e=>this.$bubble("ui:row-mouseenter")),this["#checkbox"].$on("click",e=>{var t=!this.isSelected;this.$setSelected(t),this.$bubble("ui:row-selectionchanged",{isSelected:t,canDrag:!1,isReserve:!0})}),this.$on("ui:child-afterinsert",()=>this.$checkStructure()),this.$on("ui:child-beforeremove",()=>this.$checkStructure()),this.$on("ui:cell-beforeedit",e=>{e=e.detail.source;this["#isEditing"]?null!=this["#lastEditCell"]&this["#lastEditCell"]!=e&&(this["#lastEditCell"].$endCellEditing(),this["#lastEditCell"]=e):(this.$bubble("ui:row-beforeedit",{cell:e}),this.$beginRowEditing(),this["#lastEditCell"]=e)}),this.$on("ui:cell-quitedit",e=>{this.$endRowEditing()}),this.$on("ui:cell-editnext",e=>{var t=e.detail.source;this["#isEditing"]||(this.$bubble("ui:row-beforeedit",{cell:t}),this.$beginRowEditing()),this.$focusNextCell(t,e.detail.shiftKey)}),this.$on("ui:cell-editdelete",e=>{this.$bubble("ui:row-editdelete")})}get["#grid"](){return this.$getParent(Xt)}get["#gridcells"](){return this.$getChildren()}get["#isEditing"](){return this.$hasState("isEditing")}get["#isSelected"](){return this.$hasState("selected")}get["#editingCell"](){return this.$getChildren().find(e=>e["#isEditing"]&&e["#isActive"])}get isSelected(){return this["#isSelected"]}get row(){return this["#dataTarget"]||null}get cells(){return new n(this["#gridcells"])}get rowIndex(){var e=this.$getParent();return e?e.$getChildIndex(this):-1}$focusNextCell(t,e=!1){var t=null==t?-1:t["#cellIndex"],i=this.$getChildren(),n=i.length,r=e?-1:1;let s;for(let e=t+r;e<n&&0<=e;e+=r){var l=i[e];if(null!=l&&l["#canActiveEdit"]&&l.visible){s=l;break}}null!=s?(this["#lastEditCell"]=s).$beginCellEditing():(this.$endRowEditing(),this.$bubble("ui:row-editnext",{shiftKey:e,reverse:e}))}$checkStructure(){if(null!=this.$getParent()||null!=this.row)throw new m(T.Grid_Cannot_Modify_Restricted_GridRows)}$appendCellOrCellData(e,t){this.$checkStructure();e=e instanceof b?e:b.$createFromData(null,e);return t?this.$insert(e,t):this.$append(e)}add(e){return this.$appendCellOrCellData(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this.$appendCellOrCellData(t)}insert(e,t){return this.$appendCellOrCellData(t,e)}clear(){return this.$checkStructure(),this.$clear()}removeChildAt(e){return this.$checkStructure(),this.$removeAt(e)}$remove(){super.$remove(),Yt.$removeDataBinding(this)}$setSelected(e){this.$setState("selected",e),this["#checkbox"].checked=!!e}$setAllowEdit(e){this.$setState("allowEdit",e);for(var t of this["#gridcells"])t.$setAllowEdit(e)}$setEditAction(e){this["#action"]=e||"upate",this["#_ignore_source_tag"]=null;for(var t of this["#gridcells"])t.$setEditAction(e)}$beginRowEditing(){if(!this["#isEditing"]){this.$setState("isEditing",!0);for(var e of this["#gridcells"])e.$beginRowEditing();this["#_ignore_source_tag"]||(this.$callSource(),this["#_ignore_source_tag"]="insert"==this["#action"]),this.$bubble("ui:row-editbegin")}}$endRowEditing(){this.$setState("isEditing",!1);for(var e of this["#gridcells"])e.$endRowEditing();this.$bubble("ui:row-editend")}$callSource(){for(var e of this.$getChildren())e.$callSource()}static $createFromData(e,t){var i=new Yt;if(null!=e)for(var n of e)i.$append(b.$createFromData(n));return null!=t&&Yt.$setDataBinding(i,t,e),i}static $adjustWithColumns(e,t){var i=e.$getChildren(),n=i.length,r=t.length,s=Math.min(n,r);let l=0;for(;l<s;l++)b.$adjustCellWithColumn(i[l],t[l]);for(;l<r;l++)e.$append(b.$createFromData(t[l]));for(;l<n;l++)i[l].$remove()}static $setDataBinding(t,i,n){var r=t.$getChildren();if(null!=i&&i[Symbol.iterator]){let e=0;var s,l=p(i)?i:k(i);for(s of r){var a=l[e++];null!=a&&b.$setDataBinding(s,a)}}else if(i instanceof H){let e=0;var o,u=i;for(o of n?n.map(e=>e["#source"]):r.map(e=>e["#source"])){var h=u.$getCellBySource(o);h&&b.$setDataBinding(r[e],h),e++}t["#dataTarget"]=u}}static $removeDataBinding(e){if(e["#dataTarget"]){e["#dataTarget"]=null;for(var t of e.$getChildren())b.$removeDataBinding(t)}}}R.declareSystemVisualType(Yt,{name:"GridRow",visual:{classes:"by-gridrow",attrs:{selected:"isSelected"},childInfo:b}});class Jt extends Pt{constructor(e){super(e),this.$constChild("#text",new ot),this.$constChild("#reorderBtn",new ot),this["#reorderBtn"].$on("click",e=>{this.$bubble("ui:column-requireorder",{isAsc:this.isAsc=!this.isAsc})}),this["#reorderBtn"].hidden=!0,this.align="center"}get field(){var e=this["#source"];return e?e["#field"]:null}get columnIndex(){var e=this.$getParent();return e?e.$getChildIndex(this):-1}get text(){return this["#text"].text}set text(e){this["#text"].text=e||this.name}get width(){return super.width}set width(e){super.width=e,this.$bubble("ui:column-widthchanged",{value:e})}get align(){return this["#element"].style.textAlign||"start"}set align(e){this["#element"].style.textAlign=e,this.$bubble("ui:column-alignchanged",{value:e})}get readonly(){return this.$hasState("readonly")}set readonly(e){this.$setState("readonly",e),this.$bubble("ui:column-readonlychanged",{value:e})}get isDisabled(){return super.isDisabled}set isDisabled(e){super.isDisabled=e,this.$bubble("ui:column-disabledchanged",{value:e})}get isEnabled(){return!this.isDisabled}set isEnabled(e){this.isDisabled=!e}get hidden(){return super.hidden}set hidden(e){this.visible=!e}get visible(){return super.visible}set visible(e){super.visible=e,this.$bubble("ui:column-visiblechanged",{value:e})}static $createFromSource(e){var t=new Jt,i=(F(t,"#source",e),e?e["#settings"]:{});return i.text?t.text=i.text:e&&(t.text=e.name),i.readonly&&(t.readonly=!0),!1!==i.visible&&null!==i.visible||(t.visible=!1),t}static $createFromRaw(e){var t=new Jt;return t.text=e,t}}R.declareSystemVisualType(Jt,{name:"GridColumn",visual:{classes:"by-gridcolumn",attrs:{align:"align",readonly:"readonly","data-readonly":"readonly",left:null,top:null}}});class Gt extends Mt{constructor(e){super(e),this.$constChild("#header",new Pt),this["#header"].$constChild("#checkbox",new gt),F(this,"#checkbox",this["#header"]["#checkbox"]),this["#checkbox"].$on("click",e=>{this.$bubble("ui:gridheadrow-selectionchanged")}),this.$setEnableMultiLine(!1)}get checked(){return this["#checkbox"].isChecked}set checked(e){this["#checkbox"].isChecked=e}get indeterminate(){return this["#checkbox"].indeterminate}set indeterminate(e){this["#checkbox"].indeterminate=e}$setEnableMultiLine(e){this["#checkbox"]["#element"].style.visibility=e?"visible":"hidden"}}R.declareSystemVisualType(Gt,{name:"GridHeadRow",visual:{inner:!0,classes:"by-gridheadrow"}});class Xt extends v{constructor(e){super(e),this.$constChild("#tableVisual",new kt),this["#tableVisual"].$constChild("#caption",new Nt),this["#tableVisual"].$constChild("#gridhead",new Bt),this["#tableVisual"].$constChild("#gridbody",new _t),F(this,"#caption",this["#tableVisual"]["#caption"]),F(this,"#gridhead",this["#tableVisual"]["#gridhead"]),F(this,"#gridbody",this["#tableVisual"]["#gridbody"]),this["#gridhead"].$constChild("#gridheadRow",new Gt),F(this,"#gridheadRow",this["#gridhead"]["#gridheadRow"]),this.$on("ui:cell-mousedown",e=>{this["#lastMouseActiveCell"]=e.detail.source,this["#mouseActived"]=!0}),this.$on("mouseup",()=>this["#mouseActived"]=!1),this.$on("mouseleave",()=>this["#mouseActived"]=!1),this.$on("ui:row-selectionchanged",e=>{if(e.detail.isSelected){var n=e.detail.source,{isReserve:e,canDrag:r,isRanged:s}=e.detail,e=!this["#multiline"]||s&&!e,r=r&&this["#multiline"];let t=s&&this["#lastMouseRow"]||n,i=e?null:this["#gridrows"].filter(e=>e["#isSelected"]);if(this.$refreshSelection(Xt.$calculateRangedRows(this["#gridrows"],t,n,i)),r){const l=()=>{this.$off("ui:row-mouseenter"),this.$off("mouseleave"),this.$off("wdw:blur"),this.$off("wdw:mouseup")};this.$on("ui:row-mouseenter",e=>{e.preventDefault(),window.getSelection().removeAllRanges();e=e.detail.source;this.$refreshSelection(Xt.$calculateRangedRows(this["#gridrows"],t,e,i))}),this.$on("mouseleave",e=>l()),this.$on("wdw:blur",e=>l()),this.$on("wdw:mouseup",e=>l())}}else this.$refreshSelection(this["#gridrows"].filter(e=>e["#isSelected"]))}),this.$on("ui:row-beforeedit",e=>{for(var t of this["#gridrows"])t["#isEditing"]&&t.$endRowEditing()}),this.$on("ui:row-editnext",e=>{var t=e.detail.source,e=e.detail.shiftKey,t=null==t?0:t.rowIndex+(e?-1:1),e=this["#gridbody"].$getChildAt(t);null!=e?(e.$beginRowEditing(),e.$focusNextCell()):this.allowKeyPressAddRow&&(null!=(e=this.$newDataRow())&&null!=this["#cachedEditRow"]&&H.$copyFieldAndCells(e,this["#cachedEditRow"]),e=Yt.$createFromData(this["#columns"],e),null!=t?this["#gridbody"].$insert(e,t):this["#gridbody"].$append(e),e.$setEditAction("insert"),e.$beginRowEditing(),e.$focusNextCell())}),this.$on("ui:row-editdelete",e=>{this.allowKeyPressDeleteRow&&e.detail.source.$remove()}),this["#gridheadRow"].$on("ui:gridheadrow-selectionchanged",e=>{var t=this["#gridheadRow"].checked,i=this["#gridheadRow"].indeterminate;this.$refreshSelection(i||t?this["#gridrows"]:[])}),this["#gridheadRow"].$on("ui:column-requireorder",e=>{var t=e.detail.source;if(null!=t){let i=t["#columnIndex"];e=e.detail.isAcs;let n=t["#source"]["#type"];t=this["#gridrows"];let r=e?1:-1;var s,e=q.$sortArray(t,(e,t)=>r*h.primitiveCompare(n,e.$getChildAt(i).value,t.$getChildAt(i).value)),l=document.createDocumentFragment();for(s of e)l.append(s["#element"]);this["#gridbody"]["#element"].append(l)}}),this["#gridheadRow"].$on("ui:column-widthchanged",e=>{var t,i=e.detail.source["#columnIndex"],n=e.detail.value;for(t of this["#gridrows"])t.$getChildAt(i).width=n}),this["#gridheadRow"].$on("ui:column-alignchanged",e=>{var t,i=e.detail.source["#columnIndex"],n=e.detail.value;for(t of this["#gridrows"])t.$getChildAt(i).align=n}),this["#gridheadRow"].$on("ui:column-readonlychanged",e=>{var t,i=e.detail.source["#columnIndex"],n=e.detail.value;for(t of this["#gridrows"])t.$getChildAt(i).readonly=n}),this["#gridheadRow"].$on("ui:column-disabledchanged",e=>{var t,i=e.detail.source["#columnIndex"],n=e.detail.value;for(t of this["#gridrows"])t.$getChildAt(i).isDisabled=n}),this["#gridheadRow"].$on("ui:column-visiblechanged",e=>{var t,i=e.detail.source["#columnIndex"],n=e.detail.value;for(t of this["#gridrows"])t.$getChildAt(i).visible=n}),this["#gridheadRow"].$on("ui:child-afterinsert",e=>{var t,i=e.detail.child,n=e.detail.index;for(t of this["#gridrows"])t.$insert(b.$createFromData(i),n)}),this["#gridheadRow"].$on("ui:child-afterremove",e=>{var t,i=e.detail.child,n=e.detail.index||i["#columnIndex"];for(t of this["#gridrows"])t.$removeAt(n)}),this["#gridbody"].$on("ui:child-afterinsert",e=>{e=e.detail.child;e.$setSelected(!1),e.$setAllowEdit(this["#allowEdit"])}),this.$on("ui:cell-click",e=>this.$invokeDataEvent("cellClick",new Xe(e))),this.$on("ui:cell-dblclick",e=>this.$invokeDataEvent("cellDoubleClick",new Xe(e))),this.$on("ui:cell-editend",e=>this.$invokeDataEvent("cellEditEnd",new Xe(e))),this.$on("ui:cell-editbegin",e=>this.$invokeDataEvent("cellEditBegin",new Xe(e))),this.$on("ui:grid-selection-changed",e=>this.$invokeDataEvent("selectionChanged"))}get allowKeyPressAddRow(){return!this["#forbid_key_insert"]}set allowKeyPressAddRow(e){this["#forbid_key_insert"]=!e}get allowKeyPressDeleteRow(){return!this["#forbid_key_delete"]}set allowKeyPressDeleteRow(e){this["#forbid_key_delete"]=!e}$setWidthInternal(e,t){super.$setWidthInternal(e,t),this["#tableVisual"].$setState("filled",t),this["#gridhead"].$setState("filled",t),this["#gridbody"].$setState("filled",t)}set["#columnSettings"](e){let t=null;try{t=JSON.parse(e)}catch(e){}t&&Xt.$loadColumnSettings(this,t)}get["#gridrows"](){return this["#gridbody"].$getChildren()}get["#columns"](){return this["#gridheadRow"].$getChildren()}get["#lastMouseRow"](){return this["#lastMouseActiveCell"]?this["#lastMouseActiveCell"]["#gridrow"]:null}get["#currentEditRow"](){return this["#gridrows"].find(e=>e["#isEditing"])}get["#allowEdit"](){return this.$hasState("allowEdit")}get["#multiline"](){return this.$hasState("multiline")}get cellClick(){return this.$getDataEvent("cellClick")}get cellDoubleClick(){return this.$getDataEvent("cellDoubleClick")}get cellEditEnd(){return this.$getDataEvent("cellEditEnd")}get cellEditBegin(){return this.$getDataEvent("cellEditBegin")}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get currentCell(){var e;return this["#allowEdit"]&&((e=this["#currentEditRow"])?e["#editingCell"]:null)||this["#lastMouseActiveCell"]}get text(){return this["#caption"].text}set text(e){this["#caption"].text=e}get allowEdit(){return this["#allowEdit"]}set allowEdit(t){t!=this["#allowEdit"]&&(this.$setState("allowEdit",t),this["#gridrows"].forEach(e=>{e.$setAllowEdit(t),e.$setEditAction("update")}))}get isMultiLine(){return this["#multiline"]}set isMultiLine(e){this.$setState("multiline",e),this["#gridheadRow"].$setEnableMultiLine(e),e||(e=this["#lastMouseRow"])&&this.$refreshSelection([e])}get gridColumns(){return new n(this["#columns"])}get gridRows(){return new n(this["#gridrows"])}get rows(){return new n(this["#gridrows"].map(e=>e["#dataTarget"]||null))}get selectedRows(){return new n(this["#gridrows"].filter(e=>e["#isSelected"]).map(e=>e["#dataTarget"]))}set selectedRows(e){var i,n=this["#gridrows"],r=[];if(null!=e&&e[Symbol.iterator])for(let t of e)null!=t&&null!=(i=n.find(e=>e["#dataTarget"]==t))&&r.push(i);this.$refreshSelection(r)}get selectedGridRows(){return new n(this["#gridrows"].filter(e=>e["#isSelected"]))}set selectedGridRows(e){var t=this["#gridrows"],i=[];if(null!=e&&e[Symbol.iterator])for(var n of e)null!=n&&t.includes(n)&&i.push(n);this.$refreshSelection(i)}$onBeforeLeave(e){var t=this["#currentEditRow"];null!=t&&t.$endRowEditing()}$fillChildren(e){for(var t of e)t instanceof Jt?this.$appendColumnOrInfo(t):t instanceof Yt&&this.$appendRowOrRowData(t)}$appendColumnOrInfo(e,t){e=e instanceof Jt?e:Jt.$createFromRaw(e);return null!=t?this["#gridheadRow"].$insert(e,t):this["#gridheadRow"].$append(e)}$getColumnAt(e){return this["#gridheadRow"].$getChildAt(e)}addColumn(e){return this.$appendColumnOrInfo(e)}addColumns(e){if(null!=e&&e[Symbol.iterator])for(var t of e)this.$appendColumnOrInfo(t)}insertColumn(e,t){return this.$appendColumnOrInfo(t,e)}clearColumns(){this["#gridheadRow"].$clear()}removeColumn(e){e=this["#gridheadRow"].$getChildIndex(e);e<0||this["#gridheadRow"].$removeAt(e)}removeColumnAt(e){if(0<=e)return this["#gridheadRow"].$removeAt(e)}$appendRowOrRowData(e,t){let i;return i=e instanceof Yt?(null!=e["#parent"]&&e.$remove(),Yt.$adjustWithColumns(e,this["#columns"]),e):Yt.$createFromData(this["#columns"],e),null!=t?this["#gridbody"].$insert(i,t):this["#gridbody"].$append(i),!0}add(e){return this.$appendRowOrRowData(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this.$appendRowOrRowData(t)}insert(e,t){return this.$appendRowOrRowData(t,e)}clear(){this["#gridbody"].$clear()}clearAll(){this["#gridbody"].$clear(),this["#gridheadRow"].$clear()}removeChild(t){var e=t instanceof H?this["#gridrows"].findIndex(e=>e["#dataTarget"]==t):this["#gridrows"].indexOf(t);return this["#gridbody"].$removeAt(e)}removeChildAt(e){return this["#gridbody"].$removeAt(e)}newGridRow(){var e=this.$newDataRow(!1);return Yt.$createFromData(this["#columns"],e)}newRow(){return this.$newDataRow(!1)}setEditingData(e){e instanceof H&&(this["#cachedEditRow"]=e)}setEditingValueRelationally(e,t){var i=this["#currentEditRow"];if(null!=i){var n,r,s=this["#dataTable"],l=this["#columns"].map(e=>e["#source"]),s=V.$findSourceRelationAssignPairs(s,l,e,t,!0),a=i["#gridcells"];for([n,r]of s){var o=a[n];null!=o&&null!=r&&(o.value=r.value)}}}static $calculateRangedRows(n,e,r,t){var s=[];if(e==r||null==r)e&&s.push(e);else{e=null==e?0:e.rowIndex,r=null==r?0:r.rowIndex;let t=e,i=r;t>i&&(t=r,i=e);for(let e=t;e<=i;e++)s.push(n[e])}if(t)for(var i of t)s.includes(i)||s.push(i);return s}$newDataRow(){var e,t=this["#dataTable"];return null==t?null:(e=this["#columns"].map(e=>e["#source"]["#field"]),new H(t,e))}$refreshSelection(e){var t=this["#gridrows"];if(null==e)e=t.filter(e=>e["#isSelected"]);else{for(var i of t)i.$setSelected(!1);for(var n of e)n.$setSelected(!0)}e=e.length;0==e?(this["#gridheadRow"].checked=!1,this["#gridheadRow"].indeterminate=!1):e==t.length?(this["#gridheadRow"].checked=!0,this["#gridheadRow"].indeterminate=!1):(this["#gridheadRow"].indeterminate=!0,this["#gridheadRow"].checked=!1),this.$trigger("ui:grid-selection-changed")}$$loadTableControl(e){super.$$loadTableControl(e);for(var t of e.sources)this["#gridheadRow"].$append(Jt.$createFromSource(t))}static $loadColumnSettings(t,e){if(e instanceof Array)for(var i of e){let e;"string"==typeof i?e=Jt.$createFromRaw(i):(e=Jt.$createFromRaw(i.text),i.name&&(e.name=i.name),i.readonly&&(e.readonly=i.readonly),!1!==i.visible&&null!==i.visible||(e.visible=!1)),t.$appendColumnOrInfo(e)}}}R.declareSystemVisualType(Xt,{name:"Grid",visual:{classes:"by-grid",attrs:{"data-allowedit":"allowEdit","data-multiline":"isMultiLine",columns:"#columnSettings"},childInfo:Yt}});class Qt extends Et{constructor(e){super(e),this.$constChild("#content",new st,{classes:"by-treenode-content"}),this.$constChild("#subtree",new Tt,{classes:"by-treenode-children"}),this["#content"].$constChild("#expandBtn",new ot,{classes:"byt-treenode-expandbtn"}),this["#content"].$constChild("#checkbox",new gt,{classes:"byt-treenode-checkbox"}),this["#content"].$constChild("#text",new ot,{classes:"byt-treenode-text"}),F(this,{"#expandBtn":this["#content"]["#expandBtn"],"#checkbox":this["#content"]["#checkbox"],"#text":this["#content"]["#text"]}),this["#expandBtn"].$on("click",e=>{this.$setExpanded(!this.isExpanded)}),this["#checkbox"].$on("click",e=>{this.$setSelected(!this.isSelected),this.$bubble("ui:node-selectionchanged",{nodes:this})}),this["#text"].$on("click",e=>{this.isSelected||(this.$setSelected(!0),this.$bubble("ui:node-selectionchanged",{nodes:this})),this.$trigger("ui:clicked"),this.$bubble("ui:node-clicked",{nodes:this})}),this["#text"].$on("dblclick",e=>{this.$bubble("ui:node-dblclicked",{nodes:this})}),this["#subtree"].hide(),this.$on("ui:clicked",e=>this.$invokeDataEvent("click")),this.$on("ui:treenode-expanded",e=>this.$invokeDataEvent("expanded")),this["#expandBtn"].$addClass("noChild"),this["#subtree"].$on("ui:child-afterinsert",e=>{this["#expandBtn"].$removeClass("noChild")}),this["#subtree"].$on("ui:child-afterremove",e=>{this["#subtree"].$getChildCount()<=1&&this["#expandBtn"].$addClass("noChild")})}get click(){return this.$getDataEvent("click")}get expanded(){return this.$getDataEvent("expanded")}get text(){return this["#text"].text}set text(e){this["#text"].text=e}get nodes(){return new n(this["#subtree"].$getChildren())}get isSelected(){return this.$hasState("selected")}set isSelected(e){e!=this.isSelected&&(this.$setSelected(e),this.$bubble("ui:node-selectionchanged"))}get isExpanded(){return this.$hasState("expanded")}set isExpanded(e){this.$setExpanded(e)}get tree(){return this.$getParent(Zt)}get parentNode(){return this.$getParent(Qt)}get prevNode(){var e,t=this.$getParent();return t&&(e=t.$getChildIndex(this),t.$getChildAt(e-1))||null}get nextNode(){var e,t=this.$getParent();return t&&(e=t.$getChildIndex(this),t.$getChildAt(e+1))||null}collapse(){this.$setExpanded(!1)}collapseAll(){this.$setExpanded(!1,!0)}expand(){this.$setExpanded(!0)}expandAll(){this.$setExpanded(!0,!0)}$setExpanded(e,t){if(this.$hasState("expanded")!=e&&(this.$setState("expanded",e),this["#expandBtn"].$setState("expanded",e),this["#subtree"].$setState("expanded",e),e&&0<this["#subtree"].$getChildCount()?(this["#subtree"].hidden=!1,this.$trigger("ui:treenode-expanded")):this["#subtree"].hidden=!0),t)for(var i of this["#subtree"].$getChildren())i.$setExpanded(e,!0)}$setSelected(e){e!=this.isSelected&&(this.$setState("selected",e),this["#checkbox"].checked=e)}$setMultipleSelect(e){this["#checkbox"].hidden=!e}contains(e,t=!1){return t?this["#subtree"].$contains(e):-1!=this["#subtree"].$getChildIndex(e)}add(e){return this["#subtree"].$append(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this["#subtree"].$append(t)}insert(e,t){return this["#subtree"].$insert(t,e)}clear(){return this["#subtree"].$clear()}$searchAndRemove(e,t){return t?(this["#subtree"].$contains(e)&&e.remove(),!1):this["#subtree"].$removeChild(e,t)}removeChild(e,t){return this.$searchAndRemove(e,t)}removeChildAt(e){return this["#subtree"].$removeAt(e)}remove(){return this.$remove()}$remove(){return this.isSelected&&this.$setSelected(!1),super.$remove()}*$getAllNodes(){yield this;for(var e of this["#subtree"].$getChildren())for(var t of e.$getAllNodes())yield t}$getAllNodesArray(){return Array.from(this.$getAllNodes())}getAllNodes(){return new Le(this.$getAllNodesArray())}getAllNodeValues(){return new Le(Array.prototype.map.call(this.$getAllNodesArray(),e=>e.tag))}}R.declareSystemVisualType(Qt,{name:"TreeNode",visual:{classes:"by-treenode",attrs:{selected:"isSelected",expanded:"isExpanded"}}});class Zt extends v{constructor(e){super(e),this.$constChild("#roottree",new Tt,{classes:"by-roottree"}),this.$on("ui:node-selectionchanged",e=>{e=e.detail.source.isSelected&&!this["#multiple"]?[e.detail.source]:this.$getAllSelectedNodes();this.$refreshAll(e)}),this.$on("ui:node-clicked",e=>this.$invokeDataEvent("nodeClick",new tt(e))),this.$on("ui:node-dblclicked",e=>this.$invokeDataEvent("nodeDoubleClick",new tt(e))),this.$on("ui:tree-selectionchanged",e=>this.$invokeDataEvent("selectionChanged",new tt(e)))}$setWidthInternal(e,t){super.$setWidthInternal(e,t),t?this["#roottree"].$setState("filled",!0):this["#roottree"].$setState("filled",!1)}get["#multiple"](){return this.$hasState("multiple")}get nodeClick(){return this.$getDataEvent("nodeClick")}get nodeDoubleClick(){return this.$getDataEvent("nodeDoubleClick")}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get nodes(){return new n(this["#roottree"].$getChildren(Qt))}get isMultiLine(){return this["#multiple"]}set isMultiLine(t){this.$setState("multiple",t);var e=this.$getAllNodesArray();e.forEach(e=>e.$setMultipleSelect(t)),t||(e=e.find(e=>e.isSelected),this.$refreshAll([e]))}get selectedNode(){return this.$getAllNodesArray().find(e=>e.isSelected)}set selectedNode(e){e instanceof Qt&&this.$contains(e)&&this.$refreshAll([e])}get selectedNodes(){return new n(this.$getAllSelectedNodes())}set selectedNodes(e){e=Array.from(e||[]).filter(e=>this.$contains(e));this.$refreshAll(e)}contains(e,t=!1){return t?this["#roottree"].$contains(e):-1!=this["#roottree"].$getChildIndex(e)}add(e){return this["#roottree"].$append(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this["#roottree"].$append(t)}insert(e,t){return this["#roottree"].$insert(t,e)}clear(){return this["#roottree"].$clear()}$searchAndRemove(e,t){return t?(this["#roottree"].$contains(e)&&e.remove(),!1):this["#roottree"].$removeChild(e,t)}removeChild(e,t){return this.$searchAndRemove(e,t)}removeChildAt(e){return this["#roottree"].$removeAt(e)}remove(){return this.$remove()}collapseAll(){for(var e of this.$getAllNodes())e.$setExpanded(!1)}expandAll(){for(var e of this.$getAllNodes())e.$setExpanded(!0)}$getAllSelectedNodes(){return this.$getAllNodesArray().filter(e=>e.isSelected)}*$getAllNodes(){for(var e of this["#roottree"].$getChildren())for(var t of e.$getAllNodes())yield t}$getAllNodesArray(){return Array.from(this.$getAllNodes())}getAllNodes(){return new Le(this.$getAllNodesArray())}getAllNodeValues(){return new Le(Array.prototype.map.call(this.$getAllNodesArray(),e=>e.tag))}$refreshAll(e){for(var t of this.$getAllNodes())t.$setSelected(!1);if(null!=e&&e[Symbol.iterator])for(var i of e)null!=i&&i.$setSelected(!0);else e instanceof Qt&&e.$setSelected(!0);this.$trigger("ui:tree-selectionchanged",{nodes:e})}newNode(){var e,t,i=this["#dataTable"];return null==i?null:(e=(e=this["#table$ctrl"])?e.accessfields:i["#fields"],e=new H(i,e),t=new Qt,O.$setBindIdentity(t,O.$getBindIdentity(i)),t.tag=e,t)}}R.declareSystemVisualType(Zt,{name:"Tree",visual:{classes:"by-tree",attrs:{"data-multiline":"isMultiLine"},childInfo:Qt}});class ei extends v{constructor(e){super(e),this.$constChild("#video",new Ct(d.ElementHelper.createElement("video"))),this["#video"].$on("ended",this.$invokeDataEvent("ended")),this["#video"].$on("play",this.$invokeDataEvent("playing")),this["#video"].$on("pause",this.$invokeDataEvent("paused")),this["#media"]=this["#video"]}get isAudioOnly(){return this["#media"].isAudio}set isAudioOnly(t){if(t!=this.isAudioOnly){let e;var i=this["#media"];(e=t?(null==this["#audio"]&&(this.$constChild("#audio",new Ct(d.ElementHelper.createElement("audio"))),this["#audio"].$on("ended",this.$invokeDataEvent("ended")),this["#audio"].$on("play",this.$invokeDataEvent("playing")),this["#audio"].$on("pause",this.$invokeDataEvent("paused"))),this["#audio"]):this["#video"]).loop=i.loop,e.autoPlay=i.autoPlay,e.volume=i.volume,e.resource=i.resource,e.poster=i.poster,e.hidden=!1,i.hidden=!0,this["#media"]=e}}get poster(){var e=this["#media"].poster;return e?s.$from(e):null}set poster(e){this["#media"].poster=s.$toUrl(e)}get src(){return this["#media"].src}set src(e){this["#media"].src=e||""}get ended(){return this.$getDataEvent("ended")}get paused(){return this.$getDataEvent("paused")}get playing(){return this.$getDataEvent("playing")}get loop(){return!!this["#media"].loop}set loop(e){this["#media"].loop=e}get autoPlay(){return!!this["#media"].autoPlay}set autoPlay(e){this["#media"].autoPlay=e}get isPaused(){return!!this["#media"].isPaused}get isEnded(){return!!this["#media"].isEnded}get isMuted(){return!!this["#media"].isMuted}set isMuted(e){this["#media"].isMuted=e}get volume(){return Number(this["#media"].volume)}set volume(e){this["#media"].volume=e}get resource(){var e=this["#media"].src;return e?He.$fromUrl(e):null}set resource(e){this["#media"].src=e instanceof He?e.path:""}play(){return this["#media"].play()}pause(){this["#media"].pause()}}R.declareSystemVisualType(ei,{name:"MediaPlayer",visual:{classes:"by-audioplayer",attrs:{loop:"loop",autoplay:"autoPlay",volume:"volume",resource:"resource"}}}),R.declareSystemVisualType(class extends ei{constructor(e){super(e),super.isAudioOnly=!1}},{name:"VideoPlayer",visual:{classes:"by-videoplayer"}}),R.declareSystemVisualType(class extends ei{constructor(e){super(e),super.isAudioOnly=!0}},{name:"AudioPlayer",visual:{classes:"by-audioplayer"}});class ti extends Et{constructor(e){super(e),this.$constChild("#content",new st),this.$constChild("#submenu",new ri),this["#content"].$constChild("#image",new ct),this["#content"].$constChild("#text",new ot),this["#content"].$constChild("#expandBtn",new ot),F(this,{"#image":this["#content"]["#image"],"#text":this["#content"]["#text"],"#expandBtn":this["#content"]["#expandBtn"]}),this["#expandBtn"].hidden=!0,this["#submenu"].hidden=!0,this["#submenu"].$on("ui:menu-hide",e=>this.$setState("expanded",!1)),this["#submenu"].$on("ui:menu-show",e=>this.$setState("expanded",!0)),this["#submenu"].$on("ui:menu-children-changed",e=>this["#expandBtn"].hidden=this["#submenu"]["#isEmpty"]),this["#content"].$on("click",e=>{this["#submenu"]["#isEmpty"]?this.$closeSubMenu():this.$showSubMenu(),this.$bubble("ui:menuitem-clicked",{items:this}),this.$invokeDataEvent("click")}),this["#image"].hidden=!0,this.$setIsTopLevel(!1)}get click(){return this.$getDataEvent("click")}get["#isExpanded"](){return this.$hasState("expanded")}get text(){return this["#text"].text}set text(e){this["#text"].text=e}get image(){return this["#image"].image}set image(e){(this["#image"].image=e)?(this["#text"].hidden=""===this["#text"].text,this["#image"].hidden=!1):(this["#image"].hidden=!0,this["#text"].hidden=!1)}get items(){return new n(this["#submenu"].getMenuItems())}add(e){return this["#submenu"].$insertMenuItem(e)}addRange(e){return this["#submenu"].$appendMenuItems(e)}insert(e,t){return this["#submenu"].$insertMenuItem(t,e)}removeChildAt(e){return this["#submenu"].$removeMenuItemAt(e)}removeChild(e){return this["#submenu"].$removeMenuItem(e)}clear(){return this["#submenu"].$clearMenuItems()}$setIsTopLevel(e){this.$setState("toplevel",e),this["#submenu"].$setIsTopLevel(e)}$showSubMenu(){d.ZIndexHelper.setToTopMost(this["#submenu"]),this.$hasState("toplevel")?this["#submenu"].$show(0,this.height):this["#submenu"].$show(this.width+1,.67*this.height);let t=null,i=e=>{e=e.$getParent();e instanceof A?t=e:null!=e&&i(e)};i(this);var e=Number(this["#submenu"]["#element"].getBoundingClientRect().bottom)-(null==t?0:t.top+10);this["#submenu"]["#element"].style.setProperty("--dialog-height",null==t?0:t.height+"px"),this["#submenu"]["#element"].style.setProperty("--menulist-top",e+"px")}$closeSubMenu(){this.$bubble("ui:menuitem-requireclose",{items:this})}$remove(){this["#isExpanded"]&&this.$closeSubMenu(),this.$setIsTopLevel(!1),super.$remove()}}R.declareSystemVisualType(ti,{name:"MenuItem",visual:{classes:"by-menuitem",attrs:{"data-left":null,"data-top":null,"data-height":null,"data-displaystyle":"displayStyle","data-image":"image"}}});class ii extends Tt{}R.declareSystemVisualType(ii,{name:"MenuList",visual:{inner:!0,classes:"by-menulist",childInfo:ti}});class ni extends ii{}R.declareSystemVisualType(ni,{name:"BaseContextMenuList",visual:{inner:!0,classes:"by-basecontextmenulist"}});class ri extends v{constructor(e){super(e),this.$constChild("#menulist",new ni),this.$on("ui:menuitem-requireclose",e=>{this.$hide()}),this["#menulist"].$on("ui:child-afterremove",e=>{this.$trigger("ui:menu-children-changed")}),this["#menulist"].$on("ui:child-afterinsert",e=>{this.$trigger("ui:menu-children-changed")})}get["#isEmpty"](){return 0==this["#menulist"].$getChildCount()}$show(e,t){null!=e&&(this.left=e,this.top=t),d.ZIndexHelper.setToTopMost(this),this.hidden=!1,this.$setState("hidden",!1),this["#element"].isConnected||document.body.append(this["#element"]),this.$on("wdw:blur",e=>this.$hide()),this.$on("dom:keydown",e=>{["Escape","Esc"].includes(e.code)&&this.$hide()}),this.$on("dom:mousedown",e=>{e.composedPath().includes(this["#element"])||this.$hide()}),this.$trigger("ui:menu-show")}$hide(){this.hidden=!0,this.$setState("hidden",!0),this.$off("wdw:blur"),super.$off("dom:keydown"),super.$off("dom:mousedown"),this.$trigger("ui:menu-hide")}$setIsTopLevel(e){this.$setState("toplevel",e),this["#menulist"].$setState("toplevel",e)}getMenuItems(){return this["#menulist"].$getChildren()}$appendMenuItems(e){if(e&&e[Symbol.iterator])for(var t of e)this["#menulist"].$append(t)}$insertMenuItem(e,t){return this["#menulist"].$insert(e,t)}$removeMenuItem(e,t=!1){return this["#menulist"].$removeChild(e,t)}$removeMenuItemAt(e){return this["#menulist"].$removeAt(e)}$clearMenuItems(){return this["#menulist"].$clear()}}R.declareSystemVisualType(ri,{name:"BaseContextMenu",visual:{inner:!0,classes:"by-basecontextmenu"}});class si extends ri{constructor(e){super(e),this.$on("ui:menuitem-clicked",e=>this.$invokeDataEvent("itemClick",new Ze(e))),this["#menulist"].$on("ui:menu-show",e=>this.$invokeDataEvent("opened")),this["#menulist"].$on("ui:menu-hide",e=>this.$invokeDataEvent("closed")),this["#menulist"].hidden=!0}get itemClick(){return this.$getDataEvent("itemClick")}get opened(){return this.$getDataEvent("opened")}get closed(){return this.$getDataEvent("closed")}$show(e,t){this.$remove(),this["#menulist"].hidden=!1,super.$show(e,t)}$hide(){super.$hide(),this.$remove()}$fillChildren(e){for(var t of e)this["#menulist"].$append(t)}get items(){return new n(super.getMenuItems())}add(e){return super.$insertMenuItem(e)}addRange(e){return super.$appendMenuItems(e)}insert(e,t){return super.$insertMenuItem(t,e)}clear(){return super.$clearMenuItems()}removeChildAt(e){return super.$removeMenuItemAt(e)}removeChild(e,t=!1){return super.$removeMenuItem(e,t)}}R.declareSystemVisualType(si,{name:"ContextMenu",visual:{classes:"by-contextmenu"}});class li extends ii{}R.declareSystemVisualType(li,{name:"MenuBarList",visual:{inner:!0,classes:"by-menubarlist",childInfo:ti}});class ai extends v{constructor(e){super(e),this.$constChild("#menulist",new li),this["#menulist"].$on("ui:child-afterinsert",e=>{e=e.detail.child;e instanceof ti?e.$setIsTopLevel(!0):e.$setState("toplevel",!0)}),this["#menulist"].$on("ui:child-beforeremove",e=>{e=e.detail.child;e instanceof ti?e.$setIsTopLevel(!1):e.$setState("toplevel",!1)}),this.$on("ui:menuitem-clicked",e=>this.$invokeDataEvent("itemClick",new Ze(e)))}get itemClick(){return this.$getDataEvent("itemClick")}$fillChildren(e){for(var t of e)this["#menulist"].$append(t)}get items(){return new n(this["#menulist"].$getChildren())}add(e){return this["#menulist"].$append(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this["#menulist"].$append(t)}insert(e,t){return this["#menulist"].$insert(t,e)}clear(){return this["#menulist"].$clear()}removeChildAt(e){return this["#menulist"].$removeAt(e)}removeChild(e,t=!1){return this["#menulist"].$removeChild(e,t)}}R.declareSystemVisualType(ai,{name:"MenuBar",visual:{classes:["by-bar","by-menubar"]}});class oi extends Lt{constructor(e){super(e),F(this,"#tabtag",new ui),this["#tabtag"].$on("ui:tag-close",e=>{this.$remove()}),this["#tabtag"].$on("ui:tag-click",e=>{this.$setSelectState(!0),this.$bubble("ui:tabpage-selected")})}get["#isSelected"](){return super.$hasState("selected")}get text(){return this["#tabtag"].text}set text(e){this["#tabtag"].text=e}get hidden(){return super.hidden}set hidden(e){super.hidden=this["#tabtag"].hidden=e}get name(){return super.name}set name(e){super.name=this["#tabtag"].text=e||""}$remove(){this["#tabtag"].$remove(),super.$remove(),this.$setSelectState(!1),this.hidden=!1}$setSelectState(e){this.$setState("selected",e),this["#tabtag"].$setSelectState(e),super.hidden=!e}}R.declareSystemVisualType(oi,{name:"TabPage",visual:{classes:"by-tabpage"}});class ui extends Et{constructor(e){super(e),this.$constChild("#link",new St),this.$constChild("#closeBtn",new ot,{classes:"by-tabpagetag-closebtn"}),this.$on("click",e=>{e.target!==this["#closeBtn"]["#element"]&&this.$trigger("ui:tag-click")}),this["#closeBtn"].$on("click",e=>{this.$trigger("ui:tag-close")}),this.$on("dblclick",e=>{this.$trigger("ui:tag-close")})}get text(){return this["#link"].text}set text(e){this["#link"].text=e}get["#isSelected"](){return super.$hasState("selected")}$setSelectState(e){this.$setState("selected",e),this["#closeBtn"].$setState("selected",e)}}R.declareSystemVisualType(ui,{name:"TabPageTag",visual:{inner:!0,classes:"by-tabpagetag"}});class hi extends v{constructor(e){super(e),this.$constChild("#tabtags",new Tt,{classes:"by-tabstags"}),this.$constChild("#tabsbody",new st,{classes:"by-tabsbody"}),this.$on("ui:tabpage-selected",e=>{this.$refreshTabsSelection(e.detail.source)}),this["#tabsbody"].$on("ui:child-afterinsert",e=>{var t=e.detail.child,e=e.detail.index;null==e?this["#tabtags"].$append(t["#tabtag"]):this["#tabtags"].$insert(t["#tabtag"],e),null==this.selectedPage?this.selectedPage=t:t.$setSelectState(!1)}),this["#tabsbody"].$on("ui:child-beforeremove",e=>{var e=e.detail.child;e["#isSelected"]&&(e=this["#tabsbody"].$getChildIndex(e),null!=(e=this["#tabsbody"].$getChildAt(-1==e?0:0==e?1:e-1)))&&(this.selectedPage=e)}),this.$on("ui:tabs-selectionchanged",e=>this.$invokeDataEvent("selectionChanged"))}$setWidthInternal(e,t){super.$setWidthInternal(e,t),t?(this["#tabtags"].$setState("filled",!0),this["#tabsbody"].$setState("filled",!0)):(this["#tabtags"].$setState("filled",!1),this["#tabsbody"].$setState("filled",!1))}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get selectedPage(){return this["#tabsbody"].$getChildren().find(e=>e["#isSelected"])}set selectedPage(e){e instanceof oi&&this.$refreshTabsSelection(e)}get tabPages(){return new n(this["#tabsbody"].$getChildren())}add(e){return this["#tabsbody"].$append(e)}addRange(e){if(e)for(var t of e)this["#tabsbody"].$append(t)}insert(e,t){return this["#tabsbody"].$insert(t,e)}clear(){return this["#tabsbody"].$clear()}removeChildAt(e){return this["#tabsbody"].$removeAt(e)}removeChild(e){return this["#tabsbody"].$removeChild(e)}$fillChildren(e){for(var t of e)this["#tabsbody"].$append(t)}$refreshTabsSelection(e){for(var t of this["#tabsbody"].$getChildren())t.$setSelectState(!1);e.$setSelectState(!0),this.$trigger("ui:tabs-selectionchanged")}}R.declareSystemVisualType(hi,{name:"Tabs",visual:{classes:"by-tabs"}});class di extends Et{constructor(e){super(e),this.$on("click",()=>this.$bubble("ui:item-click")),this.$on("click",()=>this.$invokeDataEvent("click"))}get click(){return this.$getDataEvent("click")}get text(){return this["#element"].textContent}set text(e){this["#element"].textContent=e}get image(){return null}set image(e){}get displayStyle(){return"text"}set displayStyle(e){}static $create(e="$default"){let t;switch((e="string"==typeof e?{name:e,image:!0}:e).type){case"colorpicker":t=new mi(null,new pt);break;case"combobox":t=new pi;break;case"input":t=new mi;break;default:t=new ci}return e.name&&(t.name=e.name),e.value&&(t.value=e.value),e.data?t.data=e.data:t.text=e.text||e.name,e.image&&t["#image"].show(),t}}R.declareSystemVisualType(di,{name:"ToolBarItem",visual:{classes:"by-toolbaritem",attrs:{"data-left":null,"data-top":null,"data-height":null,"data-actived":"isActived","data-readonly":"readonly","data-displaystyle":"displayStyle","data-image":"image"}}});class ci extends di{constructor(e){super(e),this.$constChild("#image",new ct),this.$constChild("#text",new ot),this["#image"].hidden=!0,this["#activeOnClick"]=!0,this.$on("click",e=>{this["#activeOnClick"]&&(this.isActived=!this.isActived),this.$bubble("ui:toolbaritem-actived")})}get isActived(){return this.$hasState("actived")}set isActived(e){this.$setState("actived",e)}get value(){return this.isActived}set value(e){this.isActived=!!e}get text(){return this["#text"].text}set text(e){this["#text"].text=e}get image(){return s.$from(this["#image"].image)}set image(e){this["#image"].image=e}get displayStyle(){var e=!this["#image"].hidden,t=!this["#text"].hidden;return e?t?"imageAndText":"image":t?"text":"none"}set displayStyle(e){e=(e=e||"imageAndText").toLowerCase(),this["#image"].hidden=-1===e.indexOf("image"),this["#text"].hidden=-1===e.indexOf("text")}}R.declareSystemVisualType(ci,{name:"ToolBarContentableItem",visual:{name:"ToolBarContentableItem",attrs:{actived:"isActived"}}});class mi extends di{constructor(e,t){super(e),this.$constChild("#input",t||new bt),this["#input"].$on("change",()=>this.$trigger("ui:toolbaritem-changed")),this["#input"].$on("change",()=>this.$bubble("ui:toolbaritem-actived"))}get text(){return this["#input"].text}set text(e){this["#input"].text=e}get value(){return this["#input"].value}set value(e){this["#input"].value=e||""}}R.declareSystemVisualType(mi,{name:"ToolBarInputableItem"});class gi extends ci{}R.declareSystemVisualType(gi,{name:"ToolBarButton",visual:{classes:"by-toolbarbutton"}});class pi extends mi{constructor(e){var t=new At;super(e,t),F(this,"#select",t),this["#select"].$on("change",e=>this.$invokeDataEvent("selectionChanged"))}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get items(){return new n(this["#select"].items)}get selectedIndex(){return this["#select"].selectedIndex}set selectedIndex(e){this["#select"].selectedIndex=e}get selectedItem(){return this["#select"].selectedItem}set selectedItem(e){this["#select"].selectedItem=e}get value(){return this.selectedItem}set value(e){this.selectedItem=e}get data(){return this.selectedItem}set data(e){e[Symbol.iterator]?(this.clear(),this.addRange(e)):this.selectedItem=e}add(e,t){return this["#select"].$addSingleOption(e,t)}insert(e,t,i){return this["#select"].$addSingleOption(t,i,e)}addRange(e){return this["#select"].$addOptions(e)}clear(){return this["#select"].$clear()}removeChildAt(e){return this["#select"].$removeAt(e)}removeChild(e){return this["#select"].$removeOption(e)}}R.declareSystemVisualType(pi,{name:"ToolBarComboBox",visual:{name:"ToolBarComboBox",classes:"by-toolbarcombobox"}});class fi extends ci{}R.declareSystemVisualType(fi,{name:"ToolBarLabel",visual:{classes:"by-toolbarlabel"}}),class{[di](){}},R.declareSystemVisualType(class extends di{},{name:"ToolBarSeparator",visual:{classes:"by-toolbarseparator"}});class $i extends mi{constructor(e){super(e,new bt),this.$on("ui:toolbaritem-changed",e=>this.$invokeDataEvent("textChanged"))}get textChanged(){return this.$getDataEvent("textChanged")}}R.declareSystemVisualType($i,{name:"ToolBarTextBox",visual:{classes:"by-toolbartextbox"}});class yi extends v{constructor(e){super(e),this.$constChild("#bar",new Tt),this.$on("ui:item-click",e=>this.$invokeDataEvent("itemClick",new et(e)))}get itemClick(){return this.$getDataEvent("itemClick")}$fillChildren(e){for(var t of e)this["#bar"].$append(t)}get items(){return new n(this["#bar"].$getChildren(di))}add(e){return this["#bar"].$append(e)}addRange(e){for(var t of e)this["#bar"].$append(t);return!0}insert(e,t){return this["#bar"].$insert(t,e)}clear(){return this["#bar"].$clear()}removeChildAt(e){return this["#bar"].$removeAt(e)}removeChild(e){return this["#bar"].$removeChild(e)}}R.declareSystemVisualType(yi,{name:"ToolBar",visual:{classes:["by-bar","by-toolbar"]}});class vi extends v{constructor(e){super(e)}get["#activeVisual"](){return this}$getHeightInternal(){return this["#activeVisual"]["#element"].offsetHeight}$setHeightInternal(e,t=!1){t?(this["#element"].style.height=e,this["#activeVisual"]["#style"].height="100%"):(this["#element"].style.height="",this["#activeVisual"]["#style"].height=0==e||""==e?"":d.PixelUnitHelper.lengthToPixel(e))}$getWidthInternal(){return this["#activeVisual"]["#element"].offsetWidth}$setWidthInternal(e,t=!1){t?(this["#element"].style.width=e,this["#activeVisual"]["#style"].width="100%"):(this["#element"].style.width="",this["#activeVisual"]["#style"].width=0==e||""==e?"":d.PixelUnitHelper.lengthToPixel(e))}get tabIndex(){return this["#activeVisual"].tabIndex}set tabIndex(e){this["#activeVisual"].tabIndex=e}focus(){this["#activeVisual"].focus()}blur(){this["#activeVisual"].blur()}}R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#image",new ct),this.image=null}get image(){return s.$from(this["#image"].image)}set image(e){null==e?this["#image"].hidden=!0:(this["#image"].hidden=!1,this["#image"].image=s.$from(e))}get sizeMode(){return this["#element"].dataset.sizeMode||"initial"}set sizeMode(e){"string"==typeof e&&(e=e.toLowerCase()),["initial","strech","zoom"].includes(e)||(e="initial");let t="scale-down";switch(this["#element"].dataset.sizeMode=e){case"strech":case"fill":t="fill";break;case"contain":case"zoom":t="contain";break;default:t="scale-down"}this["#element"].style.objectFit=t,this["#image"]["#element"].style.objectFit=t}get["#activeVisual"](){return this["#image"]}},{name:"ImageBox",visual:{classes:"by-imagebox",attrs:{"data-image":"image","data-sizemode":"sizeMode"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#button",new lt),this["#button"].$constChild("#image",new ct),this["#button"].$constChild("#text",new ot),F(this,"#image",this["#button"]["#image"]),F(this,"#text",this["#button"]["#text"]),this["#image"].hidden=!0,this["#button"].$on("focus",e=>this.$trigger("input:focus")),this["#button"].$on("blur",e=>this.$trigger("input:blur"))}get click(){return this.$getDataEvent("click")}get text(){return this["#text"].text}set text(e){null==e&&(e=""),""===this["#text"].text&&""!==e&&(this["#text"].hidden=!1),this["#text"].text=e}get image(){return s.$from(this["#image"].image)}set image(e){this["#image"].image=s.$toUrl(e),e?(this["#text"].hidden=""===this["#text"].text,this["#image"].hidden=!1):(this["#image"].hidden=!0,this["#text"].hidden=!1)}get["#activeVisual"](){return this["#button"]}},{name:"Button",visual:{classes:"by-button",attrs:{image:"image","data-image":"image"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#select",new At),this["#select"].$on("change",e=>this.$invokeDataEvent("selectionChanged")),this["#select"].$on("ui:changed",e=>this.$invokeDataEvent("selectionChanged")),this["#select"].$on("focus",e=>this.$trigger("input:focus")),this["#select"].$on("blur",e=>this.$trigger("input:blur"))}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get text(){return this["#select"].text}set text(e){this["#select"].text=e}get value(){return this.selectedItem}set value(e){this.selectedItem=e}get data(){return this.selectedItem}set data(e){null!=e&&e[Symbol.iterator]?(this.clear(),this.addRange(e)):this.selectedItem=e}get selectedIndex(){return this["#select"].selectedIndex}set selectedIndex(e){this["#select"].selectedIndex=0|e}get selectedItem(){return this["#select"].selectedItem}set selectedItem(e){this["#select"].selectedItem=e}get items(){return new n(this["#select"].items)}$fillChildren(e){for(var t of e)this["#select"].$append(t)}add(e,t){return this["#select"].$addSingleOption(e,t)}insert(e,t,i){return this["#select"].$addSingleOption(t,i,e)}addRange(e){return this["#select"].$addOptions(e)}clear(){return this["#select"].$clear()}removeChildAt(e){return this["#select"].$removeAt(e)}removeChild(e){return this["#select"].$removeOption(e)}get["#activeVisual"](){return this["#select"]}},{name:"ComboBox",visual:{classes:"by-combobox",childInfo:Dt,attrs:{value:"value","data-value":"value"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#label",new wt),this.$constChild("#input",new gt),this["#input"].$on("change",e=>this.$invokeDataEvent("checkedChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur")),this["#label"].bindTarget=this["#input"]}get checkedChanged(){return this.$getDataEvent("checkedChanged")}get isChecked(){return this["#input"].isChecked}set isChecked(e){this["#input"].isChecked=!!e}get indeterminate(){return this["#input"].indeterminate}set indeterminate(e){this["#input"].indeterminate=e}get text(){return this["#label"].text}set text(e){this["#label"].text=e}get value(){return this.isChecked}set value(e){this.indeterminate=!1,this.isChecked=!0===e||"true"===e||"checked"===e}get["#activeVisual"](){return this["#input"]}},{name:"CheckBox",visual:{classes:"by-checkbox",attrs:{checked:"isChecked","data-checked":"isChecked",indeterminate:"indeterminate"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#input",new pt),this["#input"].$on("change",e=>this.$invokeDataEvent("valueChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur"))}get valueChanged(){return this.$getDataEvent("valueChanged")}get value(){return this["#input"].value}set value(e){this["#input"].value=e}get["#activeVisual"](){return this["#input"]}},{name:"ColorPicker",visual:{classes:"by-colorpicker",attrs:{value:"value","data-value":"value"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#input",new ft),this["#input"].$on("change",e=>this.$invokeDataEvent("valueChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur"))}get valueChanged(){return this.$getDataEvent("valueChanged")}get text(){return this["#input"].text}set text(e){this["#input"].text=e}get value(){return this["#input"].value}set value(e){this["#input"].value=e}get mode(){var e=this["#input"]["#type"];return"date"==e||"time"==e?e:"dateTime"}set mode(e){e=["date","time"].includes(e)?e:"datetime-local";this["#input"]["#type"]=e}get["#activeVisual"](){return this["#input"]}},{name:"DateTimePicker",visual:{classes:"by-datetimepicker",attrs:{value:"value","data-value":"value","data-datetimemode":"mode"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#input",new $t),this["#input"].step=1,this["#input"].$on("change",e=>this.$invokeDataEvent("valueChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur"))}get valueChanged(){return this.$getDataEvent("valueChanged")}get text(){return this["#input"].text}set text(e){this["#input"].text=e}get value(){return c(this["#input"].value)}set value(e){this["#input"].value=e?e.toString():"0"}get increment(){return c(this["#input"].step)}set increment(e){this["#input"].step=e}get["#activeVisual"](){return this["#input"]}},{name:"NumberBox",visual:{classes:"by-numberbox",attrs:{value:"value","data-value":"value","data-delta":"increment","data-increment":"increment"}}});class bi extends vi{constructor(e){super(e),this.$constChild("#input",new yt),this.$constChild("#label",new wt,{classes:"radio-label"}),this["#label"].bindTarget=this["#input"],this["#input"].$on("change",e=>this.$bubble("ui:radio-changed")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur"))}get click(){return this.$getDataEvent("click")}get name(){return super.name}set name(e){super.name=e,""==this.text&&(this.text=e)}get text(){return this["#label"].text}set text(e){this["#label"].text=e}get isChecked(){return this["#input"].isChecked}set isChecked(e){this["#input"].isChecked=!!e}$setGroupName(e){this.$setAttribute("name",e),this["#input"].$setAttribute("name",e)}get["#activeVisual"](){return this["#input"]}}R.declareSystemVisualType(bi,{name:"RadioButton",visual:{classes:"by-radiobutton",attrs:{checked:"isChecked"}}});class xi extends v{constructor(e){super(e),this.$constChild("#fieldset",new ut),this["#fieldset"].$constChild("#legend",new dt),F(this,"#legend",this["#fieldset"]["#legend"]),this.name="$default",this["#fieldset"].$on("ui:child-beforeremove",e=>{e.detail.child.$setGroupName("")}),this["#fieldset"].$on("ui:child-afterinsert",e=>{e.detail.child.$setGroupName(this["#groupName"])}),this.$on("ui:radio-changed",e=>this.$invokeDataEvent("selectionChanged")),this.text||this["#legend"]["#element"].setAttribute("hidden",!0)}get isWidthFilled(){return this.$hasState("filled")}set isWidthFilled(e){this.$setState("filled",e),this["#fieldset"].$setState("filled",e)}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get text(){return this["#legend"].text}set text(e){e?(this["#legend"].text=e,this["#legend"]["#element"].removeAttribute("hidden")):this["#legend"]["#element"].setAttribute("hidden",!0)}get name(){return super.name}set name(e){let t=d.ElementHelper.getUniqueName(e);this["#groupName"]=t,this["#fieldset"].$getChildren().forEach(e=>e.$setGroupName(t)),super.name=e}get buttons(){return new n(this["#fieldset"].$getChildren())}get checkedButton(){return this["#fieldset"].$getChildren().find(e=>e.isChecked)}set checkedButton(e){this["#fieldset"].$contains(e)&&e instanceof bi&&(e.isChecked=!0)}get checkedIndex(){return this["#fieldset"].$getChildren().findIndex(e=>e.isChecked)}set checkedIndex(e){e=this["#fieldset"].$getChildAt(e);null!=e&&(e.isChecked=!0)}$fillChildren(e){for(var t of e)this["#fieldset"].$append(t)}add(e){return this["#fieldset"].$append(e)}addRange(e){if(e&&e[Symbol.iterator])for(var t of e)this["#fieldset"].$append(t)}clear(){return this["#fieldset"].$clear()}insert(e,t){return this["#fieldset"].$insert(t,e)}removeChildAt(e){return this["#fieldset"].$removeAt(e)}removeChild(e){return this["#fieldset"].$removeChild(e)}}R.declareSystemVisualType(xi,{name:"RadioButtonGroup",visual:{classes:"by-radiobuttongroup",attrs:{name:"name"},childInfo:bi}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#input",new vt),this["#input"].$on("change",e=>this.$invokeDataEvent("valueChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur"))}get valueChanged(){return this.$getDataEvent("valueChanged")}get text(){return $(this["#input"].value)}set text(e){this["#input"].value=e}get value(){return 0|this["#input"].value}set value(e){this["#input"].value=e}get min(){return 0|this["#input"].min}set min(e){this["#input"].min=e}get max(){return 0|this["#input"].max}set max(e){this["#input"].max=e}get delta(){return this["#input"].step}set delta(e){this["#input"].step=e}get["#activeVisual"](){return this["#input"]}},{name:"Slider",visual:{classes:"by-sliderbox",attrs:{value:"value",min:"min",max:"max","data-value":"value","data-min":"min","data-max":"max","data-increment":"delta","data-delta":"delta"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#input",new bt),this.$constChild("#textarea",new Ft),this["#input"]["#hidden"]=!0,this["#textarea"]["#hidden"]=!0,this.$setEditingTarget(this["#input"]),this["#input"].$on("change",e=>this.$invokeDataEvent("textChanged")),this["#textarea"].$on("change",e=>this.$invokeDataEvent("textChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur")),this["#textarea"].$on("focus",e=>this.$trigger("input:focus")),this["#textarea"].$on("blur",e=>this.$trigger("input:blur"))}$setEditingTarget(e){var t;this["#editingTarget"]!==e&&(null!=this["#editingTarget"]&&(t=this["#editingTarget"],e.text=t.text,e.selectionStart=t.selectionStart,e.selectionEnd=t.selectionEnd,e.width=t.width,e.height=t.height,t["#hidden"]=!0),e["#hidden"]=!1,this["#editingTarget"]=e)}get textChanged(){return this.$getDataEvent("textChanged")}get text(){return this["#editingTarget"].text}set text(e){this["#editingTarget"].text=e||""}get readonly(){return this.$hasState("readonly")}set readonly(e){this.$setState("readonly",e),this["#input"].$setState("readonly",e),this["#textarea"].$setState("readonly",e)}get placeholder(){return this["#input"].placeholder}set placeholder(e){this["#input"].placeholder=this["#textarea"].placeholder=e||""}get isPassword(){return this.$hasState("is-password")}set isPassword(e){this.$setState("is-password",e),this["#input"].isPassword=!!e}get isMultiLine(){return this["#editingTarget"]==this["#textarea"]}set isMultiLine(e){this.$setState("multiline",e),this.$setEditingTarget(e?this["#textarea"]:this["#input"])}get selectionStart(){return this["#editingTarget"].selectionStart}set selectionStart(e){this["#editingTarget"].selectionStart=e}get selectionEnd(){return this["#editingTarget"].selectionEnd}set selectionEnd(e){this["#editingTarget"].selectionEnd=e}get selectedText(){return this["#editingTarget"].text.slice(this["#editingTarget"].selectionStart,this["#editingTarget"].selectionEnd)}set selectedText(e){var e=$(e),t=this["#editingTarget"].text,i=this["#editingTarget"].selectionStart,n=this["#editingTarget"].selectionEnd;this["#editingTarget"].text=t.slice(0,i)+e+t.slice(n),this["#editingTarget"].selectRange(i,i+e.length)}selectAll(){this["#editingTarget"].selectAll()}unselectAll(){this["#editingTarget"].unselectAll()}selectRange(e,t){this["#editingTarget"].selectRange(e,t)}get["#activeVisual"](){return this["#editingTarget"]}},{name:"TextBox",visual:{classes:"by-textbox",attrs:{readonly:"readonly",placeholder:"placeholder","data-value":"value","data-readonly":"readonly","data-password":"isPassword","data-multiline":"isMultiLine","data-title":"placeholder"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#bindLabel",new wt),this.$constChild("#filesLabel",new wt),this.$constChild("#input",new xt),this["#input"].$on("change",e=>this.$invokeDataEvent("selectionChanged")),this["#input"].$on("focus",e=>this.$trigger("input:focus")),this["#input"].$on("blur",e=>this.$trigger("input:blur")),this["#bindLabel"].text="en-us"==ze.language?"Select Files":"选择文件",this["#bindLabel"].bindTarget=this["#input"],this["#bindLabel"].$addClass("by-filepicker-bindlabel"),this["#filesLabel"].$addClass("by-filepicker-filesLlbel"),this["#input"].$on("change",e=>{0==this.fileNames.toArray().length?this.$refreshFilesLabelText():this["#filesLabel"].text=this.fileNames.toArray().toString()}),this.$refreshFilesLabelText()}$refreshFilesLabelText(){this["#filesLabel"].text="en-us"==ze.language?"Unselected":"未选择任何文件"}get text(){return this["#bindLabel"].text}set text(e){this["#bindLabel"].text=e}get selectionChanged(){return this.$getDataEvent("selectionChanged")}get files(){return this.webFiles}get webFiles(){return new n(Array.from(this["#input"].files).map(e=>Si.$createFromNativeFile(e)))}get fileNames(){return new n(Array.from(this["#input"].files).map(e=>e.name))}get isMultiple(){return this["#input"].multiple}set isMultiple(e){this["#input"].multiple=e}get acceptType(){return this["#input"].accept}set acceptType(e){this["#input"].accept=e}clear(){this["#input"].value=""}get["#activeVisual"](){return this["#input"]}},{name:"FilePicker",visual:{classes:"by-filepicker",attrs:{multiple:"isMultiple",accept:"acceptType"}}});class wi extends vi{constructor(e){super(e),this.$constChild("#label",new wt),this["#label"].$constChild("#image",new ct),this["#label"].$constChild("#text",new ot),F(this,"#image",this["#label"]["#image"]),F(this,"#text",this["#label"]["#text"]),this["#image"].hidden=!0,this["#label"].$on("focus",e=>this.$trigger("input:focus")),this["#label"].$on("blur",e=>this.$trigger("input:blur"))}get click(){return this.$getDataEvent("click")}get text(){return this["#text"].text}set text(e){null==e&&(e=""),""===this["#text"].text&&""!==e&&(this["#text"].hidden=!1),this["#text"].text=e}get image(){return s.$from(this["#image"].image)}set image(e){(this["#image"].image=e)?(this["#text"].hidden=""===this["#text"].text,this["#image"].hidden=!1):(this["#image"].hidden=!0,this["#text"].hidden=!1)}$bindInput(e){e&&(this["#label"].bindTarget=C.getVisual(e))}get["#activeVisual"](){return this["#label"]}}R.declareSystemVisualType(wi,{name:"Label",visual:{classes:"by-label",attrs:{image:"image","data-image":"image"}}}),R.declareSystemVisualType(class extends vi{constructor(e){super(e),this.$constChild("#progress",new It),this["#min"]=this["#value"]=0,this["#max"]=100,this.$refreshValue()}$refreshValue(){var e=this["#min"],t=this["#max"];let i=(this["#value"]-e)/(t-e);i<0?i=0:1<i&&(i=1),this["#progress"].value=i}get value(){return this["#value"]}set value(e){this["#value"]=e||0,this.$refreshValue()}get min(){return this["#min"]}set min(e){this["#min"]=e||0,this.$refreshValue()}get max(){return this["#max"]}set max(e){this["#max"]=e||0,this.$refreshValue()}get["#activeVisual"](){return this["#progress"]}},{name:"ProgressBar",visual:{classes:"by-progressbar",attrs:{min:"min",max:"max",value:"value","data-value":"value","data-min":"min","data-max":"max"}}});class Si extends f{constructor(e){super(),F(this,"#file",e||new File([],""))}get name(){return this["#file"].name}get size(){return this["#file"].size}get fileType(){return this["#file"].type}getText(){return this["#file"].text()}getBytes(){return this["#file"].arrayBuffer().then(e=>Array.from(new Uint8Array(e)))}download(){var e=document.createElement("a");e.download=this["#file"].name,e.href=URL.createObjectURL(this["#file"]),e.click()}static create(e,t){return Si.$fromNameAndContent(e,t)}static $fromNameAndContent(e,t){let i;return null==t&&(t=""),i="string"==typeof t||t instanceof Blob||t instanceof Object.getPrototypeOf(Uint32Array)||t instanceof ArrayBuffer?new File([t],e):t[Symbol.iterator]?new File(t,e):new File([],e),new Si(i)}static $createFromNativeFile(e){return e instanceof File?new Si(e):Si.$fromNameAndContent("default",e)}}R.declareSystemType(Si,{name:"WebFile"}),"function"!=typeof Blob.prototype.text&&(Blob.prototype.text=function(){return new Promise((e,t)=>{let i=new FileReader;i.onload(()=>e(i.result)),i.onerror(()=>t(i.error)),i.readAsText(this)})}),"function"!=typeof Blob.prototype.arrayBuffer&&(Blob.prototype.arrayBuffer=function(){return new Promise((e,t)=>{let i=new FileReader;i.onload(()=>e(i.result)),i.onerror(()=>t(i.error)),i.readAsArrayBuffer(this)})});class Ti extends f{constructor(e){super(),F(this,"#document",e||d.globalThis.document)}get body(){var e=new D(this["#document"].body);return F(this,"body",e),e}createElement(e,t){return Ti.createElement(e,t,this["#document"])}getElementByID(e){e=this["#document"].getElementById(e);return null==e?null:new D(e)}querySelector(e){e=this["#document"].querySelector(e);return null==e?null:new D(e)}querySelectorAll(e){var t,i=[];for(t of Document.prototype.querySelectorAll.call(this["#document"],e)||[])i.push(null==t?null:new D(t));return i}static createElement(e,t,i=globalThis.document){var n=i.createElement(e||"div");if(null!=t&&Ue.$isMapable(t))for(var[r,s]of Ue.$toEntries(t))n.setAttribute(r,s);return new D(n)}}R.declareSystemType(Ti,{name:"WebDocument"});class Ei extends f{constructor(e){super(),F(this,"#window",e||d.globalThis)}get alertBeforeUnload(){return!!this["##alert_unload"]}set alertBeforeUnload(e){e!=this["##alert_unload"]&&(this["##alert_unload"]=!!e,null==this["##alert_handle"]&&(this["##alert_handle"]=e=>(e.preventDefault(),e.returnValue=!0)),this["##alert_unload"]?this["#window"].addEventListener("beforeunload",this["##alert_handle"]):this["#window"].removeEventListener("beforeunload",this["##alert_handle"]))}get document(){var e=new Ti(this["#window"].document);return F(this,"document",e),e}get height(){return this["#window"].innerHeight}get width(){return this["#window"].innerWidth}get xOffset(){return this["#window"].pageXOffset}get yOffset(){return this["#window"].pageYOffset}get url(){return this["#window"].location.href}get title(){return this["#window"].document.title}set title(e){return this["#window"].document.title=e}log(e){return this["#window"].console.log(e)}static open(e){return(e.startsWith(".")||e.startsWith("/")||e.startsWith("\\"))&&(e=E.ProjectFilesUtil.getFileFullPathInProject(e)),d.globalThis.open(e)}static refresh(){d.browser.location.reload()}static log(e){return console.log(e)}static get window(){var e=new Ei;return F(Ei,"window",e),e}}R.declareSystemType(Ei,{name:"WebWindow",instance:{DOMEvents:{resize:"resize",blur:"blur",focus:"focus",mouseDown:{name:"mousedown",type:t},mouseUp:{name:"mouseup",type:t},keyDown:{name:"keydown",type:Qe},keyUp:{name:"keyup",type:Qe}}}}),C.registerDOMEvent(Ei,"resize","resize"),C.registerDOMEvent(Ei,"blur","blur"),C.registerDOMEvent(Ei,"focus","focus"),C.registerDOMEvent(Ei,"mouseDown","mousedown",t),C.registerDOMEvent(Ei,"mouseUp","mouseup",t),C.registerDOMEvent(Ei,"keyDown","keydown",Qe),C.registerDOMEvent(Ei,"keyUp","keyup",Qe);class D extends f{constructor(e){super(),F(this,"#element",e),e.addEventListener("dragenter",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation())}),e.addEventListener("dragover",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation())}),e.addEventListener("dragleave",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation())}),e.addEventListener("drop",e=>{this["#dropable"]&&(e.preventDefault(),e.stopPropagation())})}get id(){return this["#element"].id}set id(e){return this["#element"].id=e}get allowDrag(){return this["#element"].draggable}set allowDrag(e){this["#element"].draggable=e}get allowDrop(){return this["#dropable"]}set allowDrop(e){this["#dropable"]=e}get innerHTML(){return this["#element"].innerHTML}set innerHTML(e){return this["#element"].innerHTML=e}get innerText(){return this["#element"].innerText}set innerText(e){return this["#element"].innerText=e}get attributes(){return Ue.$fromEntries(Array.from(this["#element"].attributes).map(e=>[e.name,e.value]))}get children(){var e,t=[];for(e of this["#element"].children)t.push(new D(e));return t}get classList(){return Array.from(this["#element"].classList)}set classList(e){this["#element"].classList=e||[]}get parentElement(){return null==this["#element"].parentElement?null:new D(this["#element"].parentElement)}get tagName(){return this["#element"].tagName}get style(){return new Ci(this["#element"].style)}get contextMenu(){return this["#contextmenu"]}set contextMenu(e){e?(null==this["#cb_contextMenu"]&&(this["#cb_contextMenu"]=e=>{var t=this["#contextmenu"];null!=t&&(e.preventDefault(),t.$show(e.pageX,e.pageY))}),this["#contextmenu"]=e,this["#element"].addEventListener("contextmenu",this["#cb_contextMenu"])):(this["#contextmenu"]=null,this["#element"].removeEventListener("contextmenu",this["#cb_contextMenu"]))}addAttribute(e,t){this["#element"].setAttribute(e,t||"")}hasAttribute(e){return this["#element"].hasAttribute(e)}removeAttribute(e){return this["#element"].removeAttribute(e)}setAttribute(e,t){this["#element"].setAttribute(e,t||"")}getAttribute(e){return this["#element"].getAttribute(e)}addClass(e){if(e){if("string"==typeof e)return this["#element"].classList.add(e);if(e[Symbol.iterator])for(var t of e)this["#element"].classList.add(t)}}hasClass(e){return this["#element"].classList.contains(e)}removeClass(e){if(e){if("string"==typeof e)return this["#element"].classList.remove(e);if(e[Symbol.iterator])for(var t of e)this["#element"].classList.remove(t)}}toggleClass(e){if(e)return this["#element"].classList.contains(e)?this["#element"].classList.remove(e):this["#element"].classList.add(e)}static $$resolveNode(e){return"string"==typeof e?e:null==e?"":null!=e["#element"]?e["#element"]:e instanceof HTMLElement?e:""}contains(e){return null!=e&&this["#element"].contains(D.$$resolveNode(e))}append(e){if(null!=e)return this["#element"].append(D.$$resolveNode(e))}prepend(e){if(null!=e)return this["#element"].prepend(D.$$resolveNode(e))}before(e){if(null!=e)return this["#element"].before(D.$$resolveNode(e))}after(e){if(null!=e)return this["#element"].after(D.$$resolveNode(e))}replaceWith(e){return null==e?this.remove():this["#element"].replaceWith(D.$$resolveNode(e))}remove(){return this["#element"].remove()}static createElement(e,t){return Ti.createElement(e,t)}}C.registerDOMEvent(D,"click","click"),C.registerDOMEvent(D,"doubleClick","dblclick"),C.registerDOMEvent(D,"mouseDown","mousedown",t),C.registerDOMEvent(D,"mouseUp","mouseup",t),C.registerDOMEvent(D,"mouseEnter","mouseenter",t),C.registerDOMEvent(D,"mouseOver","mouseover",t),C.registerDOMEvent(D,"mouseLeave","mouseleave",t),C.registerDOMEvent(D,"mouseMove","mousemove",t),C.registerDOMEvent(D,"mouseOut","mouseout",t),C.registerDOMEvent(D,"keyDown","keydown",Qe),C.registerDOMEvent(D,"keyUp","keyup",Qe),C.registerDOMEvent(D,"blur","blur"),C.registerDOMEvent(D,"focus","focus"),C.registerDOMEvent(D,"dragStart","dragstart",rt),C.registerDOMEvent(D,"dragEnter","dragenter",nt),C.registerDOMEvent(D,"dragOver","dragover",nt),C.registerDOMEvent(D,"dragLeave","dragleave",nt),C.registerDOMEvent(D,"dragDrop","drop",nt),R.declareSystemType(D,{name:"WebElement",transmit:{toExternal(e){return null==e?null:e instanceof HTMLElement?e:e["#element"]},fromExternal(e){return null!=e&&e instanceof HTMLElement?new D(e):null}}});class Ci extends f{constructor(e){super(),F(this,"#native",e)}getPropertyValue(e){return this["#native"].getPropertyValue(e)}setProperty(e,t){return this["#native"].setProperty(e,t)}removeProperty(e){return this["#native"].removeProperty(e)}}R.declareSystemType(Ci,{name:"WebCssStyleDeclaration"});class Ii extends O{constructor(){super(),F(this,"#pageElements",S())}get["#fullPath"](){var e=E.ProjectFilesUtil.getFileFullPathInProject("../"+this["#path"]);return F(this,"#fullPath",e),e}get isActived(){return null!=this["#window"]}get pageWindow(){return this.isActived?this["#window"]:null}get pageName(){var e=this["#fullPath"],t=e.split("/");return t.length<=1?e:t[t.length-1]}$loadWithWindow(e=globalThis){F(this,"#window",new Ei(e));for(var[t,i]of M(this["#pageElements"])){var n=i["el#id"],n=e.document.getElementById(n);i.$loadWithElement(n)}}generateScriptHtml(e){return E.generateScriptHtml(this,e)}main(e){this["#pageQueryParametersRaw"]=e,this["#pageQueryParameters"]=Ii.$$parseQueryParameters(e)}static open(e,n){if(e instanceof Ii){n=Ii.$$parseQueryParameters(n);let i=e["#fullPath"];if(0<n.length){i+="?";let e=0,t=n.length;for(var[r,s]of n)i=i+encodeURIComponent(r)+"="+encodeURIComponent(s),++e<t&&(i+="&")}return globalThis.open(i,"_blank")}}}R.declareSystemType(Ii,{name:"Page",domain:P.identity,static:{$getPagePath(e){return e["#path"]},$$setPagePathAndElements(i,e,t){F(i,"#path",e),O.$setBindTo(i,e);for(var[n,r]of M(t)){let e,t;r=new(t="string"==typeof r?(e=r,Ai):(e=r.id,R.getType(r.type)||Ai));F(r,{"#page":i,"el#id":e}),O.$setBindTo(r,e),F(i,n,r),i["#pageElements"][n]=r}},$$parseQueryParameters(e){return null!=e&&""!=e&&"string"==typeof e?(e=e.startsWith("?")?e.slice(1):e).split("&").map(e=>{var[e,t]=e.split("=");return[e,t]}):[]}}});class Ai extends O{get isActived(){return this["#page"].isActived}get bindingElement(){return this["#webelement"]}$loadWithElement(e){F(this,"#webelement",new D(e))}}R.declareSystemType(Ai,{name:"PageElement",domain:P.identity});class Di extends O{}R.declareSystemType(Di,{domain:P.identity,name:"Field"});const ki=globalThis.Byt={run(e){return E.run(e)},defineKu(e,t,i){return E.defineKu(e,t,i)},requireKu(e){return E.requireKu(e)},Char:r,Byte:J,Short:G,Int:X,Long:l,Float:Q,Double:Z,Decimal:c,DateTime:Se,Bool:Y,String:$,Void:ie,Object:f,Array:q,Identity:O,Enum:W,Orm:Te,Dialog:A,Manager:Ht,Ku:L,Table:V,Field:U,Row:H,Cell:o,Sql:u};Object.freeze(ki),L.$fillKu(L.$getSystemKu(),{enum:{DragDropEffects:{none:0,copy:1,move:2,copyMove:3,link:4,copyLink:5,linkMove:6,all:7},ImageSizeMode:{initial:0,strech:1,zoom:2},SceneType:{client:0,web:1,server:2,database:3},CursorStyle:{initial:0,hand:1,help:2,cross:3,wait:4,no:5,resizeAll:6,resizeNESW:7,resizeNS:8,resizeNWSE:9,resizeWE:10},DockStyle:{none:0,top:1,bottom:2,left:3,right:4,fill:5},DateTimeStyle:{dateTime:0,date:1,time:2},RegexMode:{none:0,multiline:1,ignoreCase:2,multiIgnoreCase:3},ToolBarItemDisplayStyle:{text:0,image:1,imageAndText:2},DayOfWeek:{sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},TableType:{system:0,data:1,config:2,const:3},Action:{insert:0,delete:1,update:2,select:3},MouseButton:{left:0,middle:1,right:2},DialogManagerMode:{dialog:0,manager:1,other:2}},identity:{Name:{type:class extends ki.Identity{},base:{inherit:Di}},ID:{type:class extends ki.Identity{},base:{inherit:Di}},Reference:{type:class extends ki.Identity{host(){var e=this.$to();return null==e?null:(e=V.$convert(e.refTable,L.$getSystemKu().identity.Table),ki.Identity(null==e?null:e))}isReference(e){var t=this.$to(),e=e.$to();if(null!=t&&null!=e){var i,n=t.refField;for(i of e.fields)if(n==i||i.refField==t)return!0}return!1}},base:{inherit:Di}},Table:{type:class extends ki.Identity{isReference(e){var t=this.$to(),i=e.$to();if(null!=t&&null!=i){for(var n of t.fields)if(null!=n.refTable&&n.refTable==i)return!0;for(var r of i.fields)if(null!=r.refTable&&r.refTable==t)return!0}return!1}},instance:{components:["iID"]}},Attribute:{type:class extends ki.Identity{},base:{inherit:Di}},NO:{type:class extends ki.Identity{},base:{inherit:Di}},Sys:{type:class extends ki.Identity{}},Menu:{type:class extends ki.Identity{static fillMenuTree(e,t){if(null!=e&&null!=t){e.clear();var i,n,r,s=new Ue;for(i of t){var l=i.i$access("iID"),a=(new Qt).$bindIdentity(ki.Identity(e));a.text=i.i$access("iName"),a.tag=i,s.add(l,a)}for(n of t)if(s.containsKey(n.i$access("iParent"))){if(n.i$access("iParent")==n.i$access("iID"))return r=L.$getSystemKu().identity.Table.$convert(n).$to().name,Ye.alert("树子项的父项不能为自身!请修改表:"+ki.String(r)+"中标记构件的列INO:"+ki.String(n.i$access("iID"))+"中的值,其不能与自身的父节点相同!");s.$get(n.i$access("iParent")).add(s.$get(n.i$access("iID")))}else e.add(s.$get(n.i$access("iID")))}}},base:{inherit:"by.identity.Table"},instance:{components:["iID","iName","iIco","iParent","iKuName","iDialogManagerMode","iNewIdentityName","iDialogName","iManagerName","iSingleton"]}},Role:{type:class extends ki.Identity{}}}})}